import{b8 as Ne,cp as Re,c as Oe,cq as De,j as t,l as ne,b3 as ee,a3 as he,bM as Pe,cr as xe,bG as Le,c2 as ye,aY as we,cj as Ke,u as oe,az as _e,g as Ue,r as y,bQ as Ve,h as u,F as te,am as ve,aG as fe,q as N,aZ as Ge,c8 as Me,b1 as Be,P as He,cs as le,aR as je}from"./index.7cbfb18a.js";import{u as Te,C as S}from"./index.esm.1e7ace95.js";import{K as C}from"./KeycloakTextInput.9afb01cd.js";import{L as ge}from"./ListEmptyState.fef0510e.js";import{R as We,u as ze}from"./RoutableTabs.58e36a71.js";import{T as Ze,m as $e,n as qe,K as be}from"./KeycloakDataTable.ae870e97.js";import{V as Je}from"./ViewHeader.083cd951.js";import{u as ke,F as Ce}from"./useFormatDate.88f4c3f1.js";import{L as Xe,ag as Se,aj as Qe}from"./Td.1e0c90e7.js";import{C as Ye,L as et}from"./CodeEditor.5b99e2f5.js";import{M as tt,a as at}from"./Modal.11970fe7.js";import{F as Fe,a as G}from"./FlexItem.ae9c1d3c.js";import{F as Ie,a as h,A as Ee}from"./FormGroup.60c77f60.js";import{S as ae,b as se,C as L,c as F,a as re}from"./Select.fbe867d5.js";import{D as M}from"./DatePicker.9e41d09c.js";import{T as st}from"./Trans.a8d0351e.js";import{W as rt}from"./warning-triangle-icon.0f1895c4.js";import{T as ie,a as ce}from"./Tabs.fae3d04f.js";import{D as nt,a as ot,b as lt,c as it}from"./DescriptionListTerm.d74f6911.js";import"./TableToolbar.51ae2a5f.js";import"./HelpItem.719382e8.js";import"./EmptyStateSecondaryActions.511adeb0.js";import"./EmptyStateBody.1533f3a6.js";import"./plus-circle-icon.aa8a939a.js";import"./Text.28ece842.js";import"./star-icon.a6efdd26.js";import"./check.51c67984.js";import"./grip-vertical-icon.7e109111.js";import"./Checkbox.7d63c785.js";import"./copy-icon.dbf95270.js";import"./plus-icon.f70ae4c8.js";import"./MenuList.22670a64.js";function Ae(e,o){if(e==null)return{};var l=Ne(Re(e),function(i){return[i]});return o=Oe(o),De(e,l,function(i,v){return o(i,v[0])})}const de=38,ct=({text:e,children:o})=>{const l=e||"",i=l.length>de,v=l.substring(0,de);return i?t(he,{content:e,children:o(v+"\u2026")}):o(l)},dt=e=>e.operationType==="DELETE"?!1:e.resourceType==="USER"||e.resourceType==="GROUP_MEMBERSHIP"||e.resourceType==="GROUP"||e.resourceType==="CLIENT"||e.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||e.resourceType==="CLIENT_SCOPE"||e.resourceType==="AUTH_FLOW"||e.resourcePath?.startsWith("roles-by-id"),ut=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),pt=(e,o)=>{const l=ut.exec(o.resourcePath);if(!l)return console.warn("event didn't contain a valid link",o),"";const i=l[1];return o.resourceType==="CLIENT"||o.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?Pe({realm:e,clientId:i,tab:o.resourceType==="CLIENT"?"settings":"authorization"}):o.resourceType==="GROUP"?xe({realm:e,id:i}):o.resourceType==="CLIENT_SCOPE"?Le({realm:e,id:i,tab:"settings"}):o.resourceType==="USER"||o.resourceType==="GROUP_MEMBERSHIP"?ye({realm:e,id:i,tab:"settings"}):o.resourceType==="AUTH_FLOW"?we({realm:e,id:i,usedBy:"-"}):o.resourcePath?.startsWith("roles-by-id")?Ke({realm:e,id:i,tab:"details"}):""},mt=({event:e})=>{const{realm:o}=ne();return t(ct,{text:e.resourcePath,children:l=>dt(e)?t(ee,{to:pt(o,e),children:l}):t("span",{children:l})})},ht=e=>t(mt,{event:e});const ue={resourceTypes:[],operationTypes:[],resourcePath:"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},pe=({titleKey:e,onClose:o,children:l})=>{const{t:i}=oe("events");return t(tt,{variant:at.medium,title:i(e),isOpen:!0,onClose:o,children:l})},yt=()=>{const{t:e}=oe("events"),{adminClient:o}=_e(),{realm:l}=ne(),i=Ue(),v=ke(),B=i.enums?.resourceType,H=i.enums?.operationType,[R,j]=y.exports.useState(0),[W,w]=y.exports.useState(!1),[z,I]=y.exports.useState(!1),[Z,$]=y.exports.useState(!1),[f,K]=y.exports.useState({}),[_,O]=y.exports.useState(),[T,U]=y.exports.useState(),q={resourceTypes:e("resourceTypes"),operationTypes:e("operationTypes"),resourcePath:e("resourcePath"),dateFrom:e("dateFrom"),dateTo:e("dateTo"),authClient:e("client"),authUser:e("userId"),authRealm:e("realm"),authIpAddress:e("ipAddress")},{getValues:E,register:g,reset:D,formState:{isDirty:V},control:A}=Te({mode:"onChange",defaultValues:ue});function J(a,r){return o.realms.findAdminEvents({...f,realm:l,first:a,max:r})}function X(){w(!1),k()}function b(){D(),k()}function Q(a){const r={...E()};delete r[a],D({...ue,...r}),k()}function Y(a,r){const d=E(),c=d[a],P=Array.isArray(c)?c.filter(x=>x!==r):c;D({...d,[a]:P}),k()}function k(){const a=Ae(E(),r=>r!==""||Array.isArray(r)&&r.length>0);K(a),j(R+1)}function s(){k()}const n=()=>u(Fe,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[u(G,{children:[t(ve,{id:"admin-events-search-select","data-testid":"AdminEventsSearchSelector",className:"pf-u-ml-md",toggle:t(fe,{"data-testid":"adminEventsSearchSelectorToggle",onToggle:a=>w(a),className:"keycloak__events_search_selector_dropdown__toggle",children:e("searchForAdminEvent")}),isOpen:W,children:u(Ie,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[t(h,{label:e("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:t(S,{name:"resourceTypes",control:A,render:({field:a})=>t(ae,{className:"keycloak__events_search__type_select",name:"resourceTypes","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:e("common:hide"),collapsedText:e("common:showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:r=>I(r),selections:a.value,onSelect:(r,d)=>{const c=d.toString(),P=a.value.includes(c)?a.value.filter(x=>x!==c):[...a.value,c];a.onChange(P)},onClear:r=>{r.stopPropagation(),a.onChange([])},isOpen:z,"aria-labelledby":"resourceTypes",chipGroupComponent:t(L,{children:a.value.map(r=>t(F,{onClick:d=>{d.stopPropagation(),a.onChange(a.value.filter(c=>c!==r))},children:r},r))}),children:B?.map(r=>t(re,{value:r},r))})})}),t(h,{label:e("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:t(S,{name:"operationTypes",control:A,render:({field:a})=>t(ae,{className:"keycloak__events_search__type_select",name:"operationTypes","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:e("common:hide"),collapsedText:e("common:showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:r=>$(r),selections:a.value,onSelect:(r,d)=>{const c=d.toString(),P=a.value.includes(c)?a.value.filter(x=>x!==c):[...a.value,c];a.onChange(P)},onClear:r=>{r.stopPropagation(),a.onChange([])},isOpen:Z,"aria-labelledby":"operationTypes",chipGroupComponent:t(L,{children:a.value.map(r=>t(F,{onClick:d=>{d.stopPropagation(),a.onChange(a.value.filter(c=>c!==r))},children:r},r))}),children:H?.map(r=>t(re,{value:r},r))})})}),t(h,{label:e("resourcePath"),fieldId:"kc-resourcePath",className:"keycloak__events_search__form_label",children:t(C,{id:"kc-resourcePath","data-testid":"resourcePath-searchField",...g("resourcePath")})}),t(h,{label:e("realm"),fieldId:"kc-realm",className:"keycloak__events_search__form_label",children:t(C,{id:"kc-realm","data-testid":"realm-searchField",...g("authRealm")})}),t(h,{label:e("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:t(C,{id:"kc-client","data-testid":"client-searchField",...g("authClient")})}),t(h,{label:e("user"),fieldId:"kc-user",className:"keycloak__events_search__form_label",children:t(C,{id:"kc-user","data-testid":"user-searchField",...g("authUser")})}),t(h,{label:e("ipAddress"),fieldId:"kc-ipAddress",className:"keycloak__events_search__form_label",children:t(C,{id:"kc-ipAddress","data-testid":"ipAddress-searchField",...g("authIpAddress")})}),t(h,{label:e("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:t(S,{name:"dateFrom",control:A,render:({field:a})=>t(M,{className:"pf-u-w-100",value:a.value,onChange:(r,d)=>a.onChange(d),inputProps:{id:"kc-dateFrom"}})})}),t(h,{label:e("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:t(S,{name:"dateTo",control:A,render:({field:a})=>t(M,{className:"pf-u-w-100",value:a.value,onChange:(r,d)=>a.onChange(d),inputProps:{id:"kc-dateTo"}})})}),u(Ee,{children:[t(N,{variant:"primary",onClick:X,"data-testid":"search-events-btn",isDisabled:!V,children:e("searchAdminEventsBtn")}),t(N,{variant:"secondary",onClick:b,isDisabled:!V,children:e("resetBtn")})]})]})}),t(N,{className:"pf-u-ml-md",onClick:s,"data-testid":"refresh-btn",children:e("refresh")})]}),t(G,{children:Object.entries(f).length>0&&t("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(f).map(a=>{const[r,d]=a;return t(L,{className:"pf-u-mt-md pf-u-mr-md",categoryName:q[r],isClosable:!0,onClick:()=>Q(r),children:typeof d=="string"?t(F,{isReadOnly:!0,children:d}):d.map(c=>t(F,{onClick:()=>Y(r,c),children:c},c))},r)})})})]}),p=[[e("realm"),_?.authDetails?.realmId],[e("client"),_?.authDetails?.clientId],[e("user"),_?.authDetails?.userId],[e("ipAddress"),_?.authDetails?.ipAddress]],m=y.exports.useMemo(()=>T?.representation?Ve(JSON.parse(T.representation)):"",[T?.representation]);return u(te,{children:[_&&t(pe,{titleKey:"auth",onClose:()=>O(void 0),children:u(Ze,{"aria-label":"authData","data-testid":"auth-dialog",variant:Xe.compact,cells:[e("attribute"),e("value")],rows:p,children:[t($e,{}),t(qe,{})]})}),T&&t(pe,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>U(void 0),children:t(Ye,{isLineNumbersVisible:!0,isReadOnly:!0,code:m,language:et.json,height:"8rem"})}),t(be,{loader:J,isPaginated:!0,ariaLabelKey:"events:adminEvents",toolbarItem:n(),actions:[{title:e("auth"),onRowClick:a=>O(a)},{title:e("representation"),onRowClick:a=>U(a)}],columns:[{name:"time",displayKey:"events:time",cellRenderer:a=>v(new Date(a.time),Ce)},{name:"resourcePath",displayKey:"events:resourcePath",cellRenderer:ht},{name:"resourceType",displayKey:"events:resourceType"},{name:"operationType",displayKey:"events:operationType",transforms:[Se(10)]},{name:"",displayKey:"events:user",cellRenderer:a=>a.authDetails?.userId}],emptyState:t(ge,{message:e("emptyEvents"),instructions:e("emptyEventsInstructions")}),isSearching:Object.keys(f).length>0},R)]})},me={client:"",dateFrom:"",dateTo:"",user:"",type:[]},_t=e=>e.error?t(he,{content:e.error,children:u("span",{children:[t(rt,{color:"orange"})," ",e.type]})}):u("span",{children:[t(je,{color:"green"})," ",e.type]}),vt=e=>t(nt,{isHorizontal:!0,className:"keycloak_eventsection_details",children:e.details&&Object.entries(e.details).map(([o,l])=>u(ot,{children:[t(lt,{children:o}),t(it,{children:l})]},o))});function Jt(){const{t:e}=oe("events"),{adminClient:o}=_e(),{realm:l}=ne(),i=ke(),[v,B]=y.exports.useState(0),[H,R]=y.exports.useState(!1),[j,W]=y.exports.useState(!1),[w,z]=y.exports.useState(),[I,Z]=y.exports.useState({}),$={client:e("client"),dateFrom:e("dateFrom"),dateTo:e("dateTo"),user:e("userId"),type:e("eventType")},{getValues:f,register:K,reset:_,formState:{isDirty:O},control:T,handleSubmit:U}=Te({mode:"onChange",defaultValues:me});Ge(()=>o.realms.getConfigEvents({realm:l}),s=>z(s),[]);function q(s,n){return o.realms.findEvents({...I,realm:l,first:s,max:n})}const E=s=>ze(le({realm:l,tab:s})),g=E("user-events"),D=E("admin-events");function V(){R(!1),b()}function A(){_(),b()}function J(s){const n={...f()};delete n[s],_({...me,...n}),b()}function X(s,n){const p=f(),m=p[s],a=Array.isArray(m)?m.filter(r=>r!==n):m;_({...p,[s]:a}),b()}function b(){const s=Ae(f(),n=>n!==""||Array.isArray(n)&&n.length>0);Z(s),B(v+1)}function Q(){b()}const Y=s=>u(te,{children:[s.userId&&t(ee,{to:ye({realm:l,id:s.userId,tab:"settings"}),children:s.userId},`link-${s.time}-${s.type}`),!s.userId&&e("noUserDetails")]}),k=()=>u(Fe,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[u(G,{children:[t(ve,{id:"user-events-search-select","data-testid":"UserEventsSearchSelector",className:"pf-u-ml-md",toggle:t(fe,{"data-testid":"userEventsSearchSelectorToggle",onToggle:s=>R(s),className:"keycloak__events_search_selector_dropdown__toggle",children:e("searchForUserEvent")}),isOpen:H,children:u(Ie,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:U(V),isHorizontal:!0,children:[t(h,{label:e("userId"),fieldId:"kc-userId",className:"keycloak__events_search__form_label",children:t(C,{id:"kc-userId","data-testid":"userId-searchField",...K("user")})}),t(h,{label:e("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:t(S,{name:"type",control:T,render:({field:s})=>t(ae,{className:"keycloak__events_search__type_select",name:"eventType","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:e("common:hide"),collapsedText:e("common:showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:n=>W(n),selections:s.value,onSelect:(n,p)=>{const m=p.toString(),a=s.value.includes(m)?s.value.filter(r=>r!==m):[...s.value,m];s.onChange(a)},onClear:n=>{n.stopPropagation(),s.onChange([])},isOpen:j,"aria-labelledby":"eventType",chipGroupComponent:t(L,{children:s.value.map(n=>t(F,{onClick:p=>{p.stopPropagation(),s.onChange(s.value.filter(m=>m!==n))},children:n},n))}),children:w?.enabledEventTypes?.map(n=>t(re,{value:n},n))})})}),t(h,{label:e("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:t(C,{id:"kc-client","data-testid":"client-searchField",...K("client")})}),t(h,{label:e("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:t(S,{name:"dateFrom",control:T,render:({field:s})=>t(M,{className:"pf-u-w-100",value:s.value,onChange:(n,p)=>s.onChange(p),inputProps:{id:"kc-dateFrom"}})})}),t(h,{label:e("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:t(S,{name:"dateTo",control:T,render:({field:s})=>t(M,{className:"pf-u-w-100",value:s.value,onChange:(n,p)=>s.onChange(p),inputProps:{id:"kc-dateTo"}})})}),u(Ee,{children:[t(N,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!O,children:e("searchUserEventsBtn")}),t(N,{variant:"secondary",onClick:A,isDisabled:!O,children:e("resetBtn")})]})]})}),t(N,{className:"pf-u-ml-md",onClick:Q,"data-testid":"refresh-btn",children:e("refresh")})]}),t(G,{children:Object.entries(I).length>0&&t("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(I).map(s=>{const[n,p]=s;return t(L,{className:"pf-u-mt-md pf-u-mr-md",categoryName:$[n],isClosable:!0,onClick:()=>J(n),children:typeof p=="string"?t(F,{isReadOnly:!0,children:p}):p.map(m=>t(F,{onClick:()=>X(n,m),children:m},m))},n)})})})]});return u(te,{children:[t(Je,{titleKey:"events:title",subKey:u(st,{i18nKey:"events:eventExplain",children:["If you want to configure user events, Admin events or Event listeners, please enter",t(ee,{to:Me({realm:l,tab:"events"}),children:e("eventConfig")}),"page realm settings to configure."]}),helpUrl:Be.eventsUrl,divider:!1}),t(He,{variant:"light",className:"pf-u-p-0",children:u(We,{isBox:!0,defaultLocation:le({realm:l,tab:"user-events"}),children:[t(ie,{title:t(ce,{children:e("userEvents")}),...g,children:t("div",{className:"keycloak__events_table",children:t(be,{loader:q,detailColumns:[{name:"details",enabled:s=>s.details!==void 0,cellRenderer:vt}],isPaginated:!0,ariaLabelKey:"events:title",toolbarItem:k(),columns:[{name:"time",displayKey:"events:time",cellFormatters:[Qe],cellRenderer:s=>i(new Date(s.time),Ce)},{name:"userId",displayKey:"events:user",cellRenderer:Y},{name:"type",displayKey:"events:eventType",cellRenderer:_t},{name:"ipAddress",displayKey:"events:ipAddress",transforms:[Se(10)]},{name:"clientId",displayKey:"events:client"}],emptyState:t(ge,{message:e("emptyEvents"),instructions:e("emptyEventsInstructions")}),isSearching:Object.keys(I).length>0},v)})}),t(ie,{title:t(ce,{children:e("adminEvents")}),"data-testid":"admin-events-tab",...D,children:t(yt,{})})]})})]})}export{Jt as default};
//# sourceMappingURL=EventsSection.18e5aaa1.js.map
