import{ax as q,l as z,u as G,az as X,R as fe,j as e,P as J,h as g,q as f,bE as k,bD as he,V as ye,r as T,g as ge,aA as ve,aZ as Ce,bK as j,cf as Ae,ad as $,aX as D,ao as I,K as we,F as ke,bM as H,cg as _,ch as Te,ci as De,cj as Ie,c4 as Ne,ck as Ke}from"./index.2ecf13ca.js";import{u as Fe,b as Q}from"./index.esm.68aaf060.js";import{u as Z}from"./ConfirmDialog.b43fd344.js";import{A as Se}from"./AttributeForm.417b4170.js";import{P as Ee}from"./PermissionTab.8539997c.js";import{R as xe}from"./RoleForm.3f8b0de9.js";import{A as Be,R as Pe}from"./AddRoleMappingModal.c7175fba.js";import{R as Me,u as Ve}from"./RoutableTabs.ce00f00c.js";import{V as Le}from"./ViewHeader.67577dd4.js";import{u as Y}from"./useParams.921239aa.js";import{L as Oe}from"./ListEmptyState.94d606ed.js";import{K as Ue}from"./KeycloakDataTable.5c9a6c7c.js";import{P as We}from"./HelpItem.49be9c4e.js";import{Q as je}from"./question-circle-icon.cdbe36b5.js";import{T as h,a as y}from"./Tabs.3b19dcd9.js";import"./Modal.2c72168d.js";import"./FormAccess.7ed5d8eb.js";import"./copy-icon.06155c15.js";import"./FormGroup.24d2e56a.js";import"./GridItem.a22d8cac.js";import"./KeyValueInput.8d334a75.js";import"./KeycloakTextInput.97e36976.js";import"./FlexItem.2ee8dfc9.js";import"./minus-circle-icon.e9e185f2.js";import"./ActionListItem.c90af00f.js";import"./plus-circle-icon.f1969120.js";import"./useLocaleSort.377bcdf5.js";import"./Trans.1ed7a62f.js";import"./Card.3271e4cd.js";import"./CardTitle.ab8f9378.js";import"./CardBody.8e0a3a4b.js";import"./Td.ff2a9f66.js";import"./star-icon.648ddb2a.js";import"./check.51c67984.js";import"./grip-vertical-icon.6efe1939.js";import"./Checkbox.56efba4a.js";import"./KeycloakTextArea.2947a089.js";import"./resource.09062762.js";import"./joinPath.69b856b1.js";import"./filter-icon.f568e30b.js";import"./Text.441b2f8e.js";import"./TableToolbar.f167c244.js";import"./EmptyStateSecondaryActions.3ed74a6a.js";import"./EmptyStateBody.25bf6e38.js";import"./plus-icon.a1ecd1af.js";import"./MenuList.32e086d6.js";const $e=()=>{const o=q(),{realm:n}=z(),{t:r}=G("roles"),{id:N,clientId:K}=Y(),{adminClient:d}=X(),i=async(c,v)=>{const l=await d.roles.findOneById({id:N});if(!l)throw new Error(r("common:notFound"));return l.clientRole?d.clients.findUsersWithRole({roleName:l.name,id:K,first:c,max:v}):d.roles.findUsersWithRole({name:l.name,first:c,max:v})},{enabled:a}=fe();return e(J,{"data-testid":"users-page",variant:"light",children:e(Ue,{isPaginated:!0,loader:i,ariaLabelKey:"roles:roleList",searchPlaceholderKey:"",toolbarItem:a&&e(We,{"aria-label":"Basic popover",position:"bottom",bodyContent:g("div",{children:[r("roles:whoWillAppearPopoverText"),e(f,{className:"kc-groups-link",variant:"link",onClick:()=>o(`/${n}/groups`),children:r("common:groups")}),r("or"),g(f,{className:"kc-users-link",variant:"link",onClick:()=>o(`/${n}/users`),children:[r("users"),"."]})]}),footerContent:r("roles:whoWillAppearPopoverFooterText"),children:e(f,{variant:"link",className:"kc-who-will-appear-button",icon:e(je,{}),children:r("roles:whoWillAppearLinkText")},"who-will-appear-button")}),emptyState:e(Oe,{hasIcon:!0,message:r("noDirectUsers"),instructions:g("div",{children:[r("noUsersEmptyStateDescription"),e(f,{className:"kc-groups-link-empty-state",variant:"link",onClick:()=>o(`/${n}/groups`),children:r("common:groups")}),r("or"),e(f,{className:"kc-users-link-empty-state",variant:"link",onClick:()=>o(`/${n}/users`),children:r("users")}),r("noUsersEmptyStateDescriptionContinued")]})}),columns:[{name:"username",displayKey:"roles:userName",cellFormatters:[k()]},{name:"email",displayKey:"roles:email",cellFormatters:[k()]},{name:"lastName",displayKey:"roles:lastName",cellFormatters:[k()]},{name:"firstName",displayKey:"roles:firstName",cellFormatters:[he(),k()]}]})})};function Mt(){const{t:o}=G("roles"),n=Fe({mode:"onChange"}),{control:r,reset:N,setValue:K}=n,d=q(),{adminClient:i}=X(),{id:a,clientId:c}=Y(),{pathname:v}=ye(),{realm:l}=z(),[S,ee]=T.exports.useState(0),[te,E]=T.exports.useState(),{profileInfo:oe}=ge(),x=()=>ee(S+1),{addAlert:C,addError:A}=ve(),[B,P]=T.exports.useState(!1),se=t=>{const{attributes:s,...p}=t;return{attributes:Ke(s),...p}},m=Q({control:r,defaultValue:void 0,name:"name"}),M=Q({control:r,defaultValue:!1,name:"composite"}),[F,re]=T.exports.useState();Ce(async()=>{const[t,s]=await Promise.all([i.realms.findOne({realm:l}),i.roles.findOneById({id:a})]);return{realm:t,role:s}},({realm:t,role:s})=>{if(!t||!s)throw new Error(o("common:notFound"));const p=se(s);N(p),E(p.attributes),re(t)},[S]);const V=async t=>{try{const{attributes:s,...p}=t,R=p;R.name=R.name?.trim(),R.attributes=Te(s),c?await i.clients.updateRole({id:c,roleName:t.name},R):await i.roles.updateById({id:a},R),E(s),C(o("roleSaveSuccess"),D.success)}catch(s){A("roles:roleSaveError",s)}},L=j(Ae.path),u=j(De.path),ae=()=>{if(L)return _({realm:l});if(u)return H({realm:l,clientId:u.params.clientId,tab:"roles"});throw new Error("Roles overview route could not be determined.")},w=t=>{if(L)return Ie({realm:l,id:a,tab:t});if(u)return Ne({realm:l,id:a,clientId:u.params.clientId,tab:t});throw new Error("Route could not be determined.")},b=t=>Ve(w(t)),le=b("details"),ie=b("associated-roles"),ne=b("attributes"),ce=b("users-in-role"),me=b("permissions"),[O,de]=Z({titleKey:"roles:roleDeleteConfirm",messageKey:o("roles:roleDeleteConfirmDialog",{selectedRoleName:m||o("createRole")}),continueButtonLabel:"common:delete",continueButtonVariant:$.danger,onConfirm:async()=>{try{c?await i.clients.delRole({id:c,roleName:m}):await i.roles.delById({id:a}),C(o("roleDeletedSuccess"),D.success),d(ae())}catch(t){A("roles:roleDeleteError",t)}}}),ue=v.includes("associated-roles")?[e(I,{component:"button",onClick:()=>pe(),children:o("roles:removeAllAssociatedRoles")},"delete-all-associated"),e(I,{component:"button",onClick:()=>{O()},children:o("deleteRole")},"delete-role")]:[e(I,{"data-testid":"add-roles",component:"button",onClick:()=>Re(),children:o("addAssociatedRolesText")},"toggle-modal"),e(I,{component:"button",onClick:()=>O(),children:o("deleteRole")},"delete-role")],[pe,be]=Z({titleKey:o("roles:removeAllAssociatedRoles")+"?",messageKey:o("roles:removeAllAssociatedRolesConfirmDialog",{name:m||o("createRole")}),continueButtonLabel:"common:delete",continueButtonVariant:$.danger,onConfirm:async()=>{try{const t=await i.roles.getCompositeRoles({id:a});await i.roles.delCompositeRoles({id:a},t),C(o("compositeRoleOff"),D.success,o("compositesRemovedAlertDescription")),d(w("details")),x()}catch(t){A("roles:roleDeleteError",t)}}}),Re=()=>{P(!B)},U=async t=>{try{await i.roles.createComposite({roleId:a,realm:F.realm},t),x(),d(w("associated-roles")),C(o("addAssociatedRolesSuccess"),D.success)}catch(s){A("roles:addAssociatedRolesError",s)}},W=t=>F?.defaultRole.name===t;return F?g(ke,{children:[e(de,{}),e(be,{}),B&&e(Be,{id:a,type:"roles",name:m,onAssign:t=>U(t.map(s=>s.role)),onClose:()=>P(!1)}),e(Le,{titleKey:m,badges:[{id:"composite-role-badge",text:M?o("composite"):"",readonly:!0}],actionsDropdownId:"roles-actions-dropdown",dropdownItems:ue,divider:!1}),e(J,{variant:"light",className:"pf-u-p-0",children:g(Me,{isBox:!0,mountOnEnter:!0,defaultLocation:w("details"),children:[e(h,{title:e(y,{children:o("common:details")}),...le,children:e(xe,{form:n,onSubmit:V,role:u?"manage-clients":"manage-realm",cancelLink:u?H({realm:l,clientId:c,tab:"roles"}):_({realm:l}),editMode:!0})}),M&&e(h,{"data-testid":"associatedRolesTab",title:e(y,{children:o("associatedRolesText")}),...ie,children:e(Pe,{name:m,id:a,type:"roles",isManager:!0,save:t=>U(t.map(s=>s.role))})}),!W(m)&&e(h,{"data-testid":"attributesTab",className:"kc-attributes-tab",title:e(y,{children:o("common:attributes")}),...ne,children:e(Se,{form:n,save:V,reset:()=>K("attributes",te,{shouldDirty:!1})})}),!W(m)&&e(h,{title:e(y,{children:o("usersInRole")}),...ce,children:e($e,{"data-cy":"users-in-role-tab"})}),!oe?.disabledFeatures?.includes("ADMIN_FINE_GRAINED_AUTHZ")&&e(h,{title:e(y,{children:o("common:permissions")}),...me,children:e(Ee,{id:a,type:"roles"})})]})})]}):e(we,{})}export{Mt as default};
//# sourceMappingURL=RealmRoleTabs.8dba6bf1.js.map
