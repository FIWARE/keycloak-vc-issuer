{"version":3,"file":"TimeSelector.3864b0c1.js","sources":["../../src/components/time-selector/TimeSelector.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  DropdownProps,\n  Select,\n  SelectOption,\n  SelectVariant,\n  Split,\n  SplitItem,\n  TextInput,\n  TextInputProps,\n} from \"@patternfly/react-core\";\n\nexport type Unit = \"second\" | \"minute\" | \"hour\" | \"day\";\n\ntype TimeUnit = { unit: Unit; label: string; multiplier: number };\n\nconst allTimes: TimeUnit[] = [\n  { unit: \"second\", label: \"times.seconds\", multiplier: 1 },\n  { unit: \"minute\", label: \"times.minutes\", multiplier: 60 },\n  { unit: \"hour\", label: \"times.hours\", multiplier: 3600 },\n  { unit: \"day\", label: \"times.days\", multiplier: 86400 },\n];\n\nexport type TimeSelectorProps = TextInputProps &\n  Pick<DropdownProps, \"menuAppendTo\"> & {\n    value: number;\n    units?: Unit[];\n    onChange: (time: number | string) => void;\n    className?: string;\n  };\n\nexport const getTimeUnit = (value: number) =>\n  allTimes.reduce(\n    (v, time) =>\n      value % time.multiplier === 0 && v.multiplier < time.multiplier\n        ? time\n        : v,\n    allTimes[0]\n  );\n\nexport const toHumanFormat = (value: number, locale: string) => {\n  const timeUnit = getTimeUnit(value);\n  const formatter = new Intl.NumberFormat(locale, {\n    style: \"unit\",\n    unit: timeUnit.unit,\n    unitDisplay: \"long\",\n  });\n  return formatter.format(value / timeUnit.multiplier);\n};\n\nexport const TimeSelector = ({\n  value,\n  units = [\"second\", \"minute\", \"hour\", \"day\"],\n  onChange,\n  className,\n  min,\n  menuAppendTo,\n  ...rest\n}: TimeSelectorProps) => {\n  const { t } = useTranslation(\"common\");\n\n  const times = useMemo(\n    () => units.map((unit) => allTimes.find((time) => time.unit === unit)!),\n    [units]\n  );\n\n  const defaultMultiplier = useMemo(\n    () => allTimes.find((time) => time.unit === units[0])?.multiplier,\n    [units]\n  );\n\n  const [timeValue, setTimeValue] = useState<\"\" | number>(\"\");\n  const [multiplier, setMultiplier] = useState(defaultMultiplier);\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    const multiplier = getTimeUnit(value).multiplier;\n\n    if (value) {\n      setMultiplier(multiplier);\n      setTimeValue(value / multiplier);\n    } else {\n      setTimeValue(value);\n      setMultiplier(defaultMultiplier);\n    }\n  }, [value]);\n\n  const updateTimeout = (\n    timeout: \"\" | number,\n    times: number | undefined = multiplier\n  ) => {\n    if (timeout !== \"\") {\n      onChange(timeout * (times || 1));\n      setTimeValue(timeout);\n    } else {\n      onChange(\"\");\n    }\n  };\n\n  return (\n    <Split hasGutter className={className}>\n      <SplitItem>\n        <TextInput\n          {...rest}\n          type=\"number\"\n          aria-label=\"kc-time\"\n          min={min || 0}\n          value={timeValue}\n          className={`${className}-input`}\n          onChange={(value) => {\n            updateTimeout(\"\" === value ? value : parseInt(value));\n          }}\n        />\n      </SplitItem>\n      <SplitItem id={`${className}-select-menu`}>\n        <Select\n          variant={SelectVariant.single}\n          aria-label={t(\"unitLabel\")}\n          className={`${className}-select`}\n          onSelect={(_, value) => {\n            setMultiplier(value as number);\n            updateTimeout(timeValue, value as number);\n            setOpen(false);\n          }}\n          menuAppendTo={menuAppendTo}\n          selections={[multiplier]}\n          onToggle={() => {\n            setOpen(!open);\n          }}\n          isOpen={open}\n          isDisabled={rest.isDisabled}\n        >\n          {times.map((time) => (\n            <SelectOption\n              id={time.label}\n              key={time.label}\n              value={time.multiplier}\n            >\n              {t(time.label)}\n            </SelectOption>\n          ))}\n        </Select>\n      </SplitItem>\n    </Split>\n  );\n};\n"],"names":["allTimes","unit","label","multiplier","getTimeUnit","value","reduce","v","time","toHumanFormat","locale","timeUnit","Intl","NumberFormat","style","unitDisplay","format","TimeSelector","units","onChange","className","min","menuAppendTo","rest","t","useTranslation","times","useMemo","map","find","defaultMultiplier","timeValue","setTimeValue","useState","setMultiplier","open","setOpen","useEffect","updateTimeout","timeout","Split","_jsx","SplitItem","TextInput","parseInt","Select","SelectVariant","single","_","isDisabled","SelectOption"],"mappings":"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"}