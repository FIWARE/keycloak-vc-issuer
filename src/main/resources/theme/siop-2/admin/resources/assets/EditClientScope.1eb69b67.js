import{u as j,ax as k,l as B,az as L,aA as N,r as y,aZ as U,ad as z,aX as l,j as t,K as G,h as C,F as H,ao as X,P as b,bF as T,bG as Z,aD as _}from"./index.2ecf13ca.js";import{c as q,C as w,A as J}from"./ClientScopeTypes.021d7604.js";import{u as Q}from"./ConfirmDialog.b43fd344.js";import{R as W}from"./AddRoleMappingModal.c7175fba.js";import{R as Y,u as $}from"./RoutableTabs.ce00f00c.js";import{V as ee}from"./ViewHeader.67577dd4.js";import{u as te}from"./useParams.921239aa.js";import{M as oe}from"./MapperList.edc4ba6e.js";import{S as ae}from"./ScopeForm.f2b285db.js";import{T as S,a as f}from"./Tabs.3b19dcd9.js";import"./Select.5d6f6214.js";import"./FormGroup.24d2e56a.js";import"./check.51c67984.js";import"./star-icon.648ddb2a.js";import"./Modal.2c72168d.js";import"./KeycloakDataTable.5c9a6c7c.js";import"./ListEmptyState.94d606ed.js";import"./TableToolbar.f167c244.js";import"./HelpItem.49be9c4e.js";import"./EmptyStateSecondaryActions.3ed74a6a.js";import"./EmptyStateBody.25bf6e38.js";import"./plus-circle-icon.f1969120.js";import"./Td.ff2a9f66.js";import"./grip-vertical-icon.6efe1939.js";import"./Checkbox.56efba4a.js";import"./useLocaleSort.377bcdf5.js";import"./resource.09062762.js";import"./joinPath.69b856b1.js";import"./filter-icon.f568e30b.js";import"./Text.441b2f8e.js";import"./DataListItemRow.7402b99a.js";import"./data-list.f7ff2ea7.js";import"./index.esm.68aaf060.js";import"./utils.988d95db.js";import"./FormAccess.7ed5d8eb.js";import"./copy-icon.06155c15.js";import"./GridItem.a22d8cac.js";import"./KeycloakTextArea.2947a089.js";import"./KeycloakTextInput.97e36976.js";import"./plus-icon.a1ecd1af.js";import"./MenuList.32e086d6.js";function _e(){const{t:i}=j("client-scopes"),D=k(),{realm:m}=B(),{adminClient:r}=L(),{id:n}=te(),{addAlert:c,addError:p}=N(),[a,M]=y.exports.useState(),[g,v]=y.exports.useState(0),h=()=>v(g+1);U(async()=>{const e=await r.clientScopes.findOne({id:n});if(!e)throw new Error(i("common:notFound"));return{...e,type:await A(e)}},e=>{M(e)},[g,n]);async function A(e){return(await r.clientScopes.listDefaultClientScopes()).find(u=>u.name===e.name)?w.default:(await r.clientScopes.listDefaultOptionalClientScopes()).find(u=>u.name===e.name)?w.optional:J.none}const d=e=>$(Z({realm:m,id:n,tab:e})),x=d("settings"),R=d("mappers"),E=d("scope"),F=async e=>{const o=_({...e,name:e.name?.trim().replace(/ /g,"_")});try{await r.clientScopes.update({id:n},o),await q(r,{...o,id:n},o.type),c(i("updateSuccess"),l.success)}catch(s){p("client-scopes:updateError",s)}},[K,P]=Q({titleKey:i("deleteClientScope",{count:1,name:a?.name}),messageKey:"client-scopes:deleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{await r.clientScopes.del({id:n}),c(i("deletedSuccess"),l.success)}catch(e){p("client-scopes:deleteError",e)}}}),V=async e=>{try{const o=e.filter(s=>s.client===void 0).map(s=>s.role).flat();await r.clientScopes.addRealmScopeMappings({id:n},o),await Promise.all(e.filter(s=>s.client!==void 0).map(s=>r.clientScopes.addClientScopeMappings({id:n,client:s.client.id},[s.role]))),c(i("roleMappingUpdatedSuccess"),l.success)}catch(o){p("client-scopes:roleMappingUpdatedError",o)}},I=async e=>{if(Array.isArray(e))try{await r.clientScopes.addMultipleProtocolMappers({id:a.id},e),h(),c(i("common:mappingCreatedSuccess"),l.success)}catch(o){p("common:mappingCreatedError",o)}else{const o=e;D(T({realm:m,id:a.id,mapperId:o.id}))}},O=async e=>{try{await r.clientScopes.delProtocolMapper({id:a.id,mapperId:e.id}),c(i("common:mappingDeletedSuccess"),l.success),h()}catch(o){p("common:mappingDeletedError",o)}return!0};return a?C(H,{children:[t(P,{}),t(ee,{titleKey:a.name,dropdownItems:[t(X,{onClick:K,children:i("common:delete")},"delete")],badges:[{text:a.protocol}],divider:!1}),t(b,{variant:"light",className:"pf-u-p-0",children:C(Y,{isBox:!0,children:[t(S,{id:"settings","data-testid":"settings",title:t(f,{children:i("common:settings")}),...x,children:t(b,{variant:"light",children:t(ae,{save:F,clientScope:a})})}),t(S,{id:"mappers","data-testid":"mappers",title:t(f,{children:i("common:mappers")}),...R,children:t(oe,{model:a,onAdd:I,onDelete:O,detailLink:e=>T({realm:m,id:a.id,mapperId:e})})}),t(S,{id:"scope","data-testid":"scopeTab",title:t(f,{children:i("scope")}),...E,children:t(W,{id:a.id,name:a.name,type:"clientScopes",save:V})})]})})]}):t(G,{})}export{_e as default};
//# sourceMappingURL=EditClientScope.1eb69b67.js.map
