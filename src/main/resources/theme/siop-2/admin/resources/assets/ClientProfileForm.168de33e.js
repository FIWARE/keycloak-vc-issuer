import{u as Q,ax as U,aA as W,az as _,r as u,g as ee,aZ as te,ad as ie,aX as v,cO as w,cL as y,j as e,K as re,h as o,F as h,L as ae,ao as oe,P as le,aw as F,q as d,b3 as P,cY as se,cZ as ne,G as ce}from"./index.7cbfb18a.js";import{u as de,c as me}from"./index.esm.1e7ace95.js";import{u as ue}from"./ConfirmDialog.4dc691c5.js";import{F as fe}from"./FormAccess.3a7ea209.js";import{H as L}from"./HelpItem.719382e8.js";import{K as pe}from"./KeycloakTextArea.d98120cb.js";import{K as xe}from"./KeycloakTextInput.9afb01cd.js";import{V as he}from"./ViewHeader.083cd951.js";import{u as Pe}from"./useParams.3f76335e.js";/* empty css                               */import{a as S,A as ge}from"./FormGroup.60c77f60.js";import{F as Ce,a as A}from"./FlexItem.ae9c1d3c.js";import{T as K,a as V}from"./Text.28ece842.js";import{P as be}from"./plus-circle-icon.aa8a939a.js";import{e as ke,D as Te,a as ve,c as ye,d as Ee}from"./DataListItemRow.df3ed5f3.js";import{T as Ie}from"./trash-icon.f61a79f3.js";import"./Modal.11970fe7.js";import"./copy-icon.dbf95270.js";import"./GridItem.63e5e367.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.7e109111.js";const De={name:"",description:"",executors:[]};function Je(){const{t}=Q("realm-settings"),g=U(),{handleSubmit:H,setValue:C,getValues:G,register:E,formState:{isDirty:I,errors:R},control:q}=de({defaultValues:De,mode:"onChange"}),{fields:b,remove:B}=me({name:"executors",control:q}),{addAlert:k,addError:T}=W(),{adminClient:x}=_(),[m,O]=u.exports.useState(),[a,j]=u.exports.useState(!1),{realm:n,profileName:l}=Pe(),z=ee(),M=u.exports.useMemo(()=>z.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[f,Z]=u.exports.useState(),c=!!l,[D,X]=u.exports.useState(0),Y=()=>X(D+1);te(()=>x.clientPolicies.listProfiles({includeGlobalProfiles:!0}),i=>{O({globalProfiles:i.globalProfiles,profiles:i.profiles?.filter(p=>p.name!==l)});const s=i.globalProfiles?.find(p=>p.name===l),r=i.profiles?.find(p=>p.name===l);j(s!==void 0),C("name",s?.name??r?.name??""),C("description",s?.description??r?.description??""),C("executors",s?.executors??r?.executors??[])},[D]);const $=async i=>{const s=i;try{await x.clientPolicies.createProfiles({...m,profiles:[...m?.profiles||[],s]}),k(t(c?"realm-settings:updateClientProfileSuccess":"realm-settings:createClientProfileSuccess"),v.success),g(w({realm:n,profileName:i.name}))}catch(r){T(c?"realm-settings:updateClientProfileError":"realm-settings:createClientProfileError",r)}},[N,J]=ue({titleKey:f?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:f?.name?t("deleteExecutorProfileConfirm",{executorName:f.name}):t("deleteClientProfileConfirm",{profileName:l}),continueButtonLabel:t("delete"),continueButtonVariant:ie.danger,onConfirm:async()=>{if(f?.name){B(f.idx);try{await x.clientPolicies.createProfiles({...m,profiles:[...m.profiles||[],G()]}),k(t("deleteExecutorSuccess"),v.success),g(w({realm:n,profileName:l}))}catch(i){T(t("deleteExecutorError"),i)}}else try{await x.clientPolicies.createProfiles(m),k(t("deleteClientSuccess"),v.success),g(y({realm:n,tab:"profiles"}))}catch(i){T(t("deleteClientError"),i)}}});return m?o(h,{children:[e(J,{}),e(he,{titleKey:c?l:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:a?e(ae,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:c&&!a?[e(oe,{value:"delete",onClick:N,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e(le,{variant:"light",children:o(fe,{isHorizontal:!0,role:"view-realm",className:"pf-u-mt-lg",children:[e(S,{label:t("newClientProfileName"),fieldId:"kc-name",helperText:t("createClientProfileNameHelperText"),isRequired:!0,helperTextInvalid:t("common:required"),validated:R.name?F.error:F.default,children:e(xe,{id:"kc-name","data-testid":"client-profile-name",isReadOnly:a,...E("name",{required:!0})})}),e(S,{label:t("common:description"),fieldId:"kc-description",children:e(pe,{id:"kc-description","data-testid":"client-profile-description",isReadOnly:a,...E("description")})}),o(ge,{children:[!a&&e(d,{variant:"primary",onClick:()=>H($)(),"data-testid":"saveCreateProfile",isDisabled:!I,children:t("common:save")}),c&&!a&&e(d,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!I,onClick:Y,children:t("realm-settings:reload")}),!c&&!a&&e(d,{id:"cancelCreateProfile",variant:"link",component:i=>e(P,{...i,to:y({realm:n,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("common:cancel")})]}),c&&o(h,{children:[o(Ce,{children:[e(A,{children:o(K,{className:"kc-executors",component:V.h1,children:[t("executors"),e(L,{helpText:"realm-settings:executorsHelpText",fieldLabelId:"realm-settings:executors"})]})}),!a&&e(A,{align:{default:"alignRight"},children:e(d,{id:"addExecutor",component:i=>e(P,{...i,to:se({realm:n,profileName:l})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e(be,{}),children:t("realm-settings:addExecutor")})})]}),b.length>0&&o(h,{children:[e(ke,{"aria-label":t("executors"),isCompact:!0,children:b.map((i,s)=>e(Te,{"aria-labelledby":"executors-list-item",id:i.executor,children:e(ve,{"data-testid":"executors-list-row",children:e(ye,{dataListCells:[o(Ee,{"data-testid":"executor-type",children:[i.configuration?e(d,{component:r=>e(P,{...r,to:ne({realm:n,profileName:l,executorName:i.executor})}),variant:"link","data-testid":"editExecutor",children:i.executor}):e("span",{className:"kc-unclickable-executor",children:i.executor}),M?.filter(r=>r.id===i.executor).map(r=>o(u.exports.Fragment,{children:[e(L,{helpText:r.helpText,fieldLabelId:"realm-settings:executorTypeTextHelpText"},r.id),!a&&e(d,{variant:"link",isInline:!0,icon:e(Ie,{className:"kc-executor-trash-icon","data-testid":"deleteExecutor"},`executorType-trash-icon-${r.id}`),onClick:()=>{N(),Z({idx:s,name:r.id})}})]},r.id))]},"executor")]})})},i.executor))}),a&&e(d,{id:"backToClientPolicies",component:i=>e(P,{...i,to:y({realm:n,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("realm-settings:back")})]}),b.length===0&&o(h,{children:[e(ce,{}),e(K,{className:"kc-emptyExecutors",component:V.h6,children:t("realm-settings:emptyExecutors")})]})]})]})})]}):e(re,{})}export{Je as default};
//# sourceMappingURL=ClientProfileForm.168de33e.js.map
