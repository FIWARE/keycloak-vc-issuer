import{_ as ke,j as e,p as Le,u as E,az as O,aA as D,ax as Oe,l as K,r as R,q as _,ad as H,aX as V,aY as Ae,aZ as ge,K as Pe,aB as G,a_ as Q,aw as k,h as P,a$ as Ve,b0 as de,g as we,P as j,F as M,G as Me,R as $e,T as ve,aC as Ue,aD as De,aR as Ke,b1 as qe,b2 as ue,b3 as he,b4 as He,b5 as Be,b6 as ze,b7 as Ge,L as je}from"./index.2ecf13ca.js";import{K as Ie}from"./KeycloakDataTable.5c9a6c7c.js";import{L as Ye}from"./ListEmptyState.94d606ed.js";import{V as We}from"./ViewHeader.67577dd4.js";import{u as Qe}from"./ConfirmDialog.b43fd344.js";import{u as Y}from"./useToggle.97c716af.js";import{u as W,F as oe,a as Ce,C as N,b as Xe}from"./index.esm.68aaf060.js";import{N as Ze}from"./NameDescription.36fe4b4b.js";import{M as le,a as Se}from"./Modal.2c72168d.js";import{F as Te,a as C,A as re}from"./FormGroup.24d2e56a.js";import{D as Je}from"./DraggableTable.12d5d25c.js";import{F as se}from"./FormAccess.7ed5d8eb.js";import{H as T,a as et,b as tt,c as Re,T as at,P as _e}from"./HelpItem.49be9c4e.js";import{K as ae}from"./KeycloakTextInput.97e36976.js";import{N as ne}from"./NumberInput.71354005.js";import{M as nt}from"./minus-circle-icon.e9e185f2.js";import{s as it,E as ot,a as lt}from"./EmptyStateBody.25bf6e38.js";import{E as rt}from"./EmptyStateSecondaryActions.3ed74a6a.js";import{P as st}from"./plus-circle-icon.f1969120.js";import{S as Z,a as J,b as X,C as ct,c as dt}from"./Select.5d6f6214.js";import{T as Ee}from"./TimeSelector.ba2ee1d5.js";import{u as Ne,m as ut}from"./useLocaleSort.377bcdf5.js";import{R as me}from"./Radio.9cf26071.js";import{M as ht}from"./MultiLineInput.7867bd1a.js";import{Q as mt}from"./question-circle-icon.cdbe36b5.js";import{T as ie,a as pt}from"./Text.441b2f8e.js";import{b as bt,T as $,a as U}from"./Tabs.3b19dcd9.js";import{f as yt}from"./resource.09062762.js";import{R as ft,u as At}from"./RoutableTabs.ce00f00c.js";import{T as gt}from"./Trans.1ed7a62f.js";const Fe=t=>{var{children:n,className:a=""}=t,i=ke(t,["children","className"]);return e("div",{...Object.assign({className:Le(it.emptyStatePrimary,a)},i),children:n})};Fe.displayName="EmptyStatePrimary";const Pt=({name:t,description:n,toggleDialog:a,onComplete:i})=>{const{t:c}=E("authentication"),l=W({mode:"onChange"}),{setValue:p,getValues:b,handleSubmit:h}=l,{adminClient:d}=O(),{addAlert:f,addError:g}=D(),o=Oe(),{realm:s}=K();R.exports.useEffect(()=>{p("alias",c("copyOf",{name:t})),p("description",n)},[t,n]);const m=async()=>{const v=b();try{await d.authenticationManagement.copyFlow({flow:t,newName:v.alias});const y=(await d.authenticationManagement.getFlows()).find(S=>S.alias===v.alias);v.description!==n&&(y.description=v.description,await d.authenticationManagement.updateFlow({flowId:y.id},y)),f(c("copyFlowSuccess"),V.success),o(Ae({realm:s,id:y.id,usedBy:"notInUse",builtIn:y.builtIn?"builtIn":void 0}))}catch(y){g("authentication:copyFlowError",y)}i()};return e(le,{title:c("duplicateFlow"),onClose:a,variant:Se.small,actions:[e(_,{"data-testid":"confirm",type:"submit",form:"duplicate-flow-form",children:c("duplicate")},"confirm"),e(_,{"data-testid":"cancel",variant:H.link,onClick:a,children:c("common:cancel")},"cancel")],isOpen:!0,children:e(oe,{...l,children:e(Te,{id:"duplicate-flow-form",onSubmit:h(m),isHorizontal:!0,children:e(Ze,{})})})})},wt=()=>{const{t}=E("authentication"),{adminClient:n}=O(),{addAlert:a,addError:i}=D(),[c,l]=R.exports.useState(),[p,b]=R.exports.useState(0),h=()=>b(p+1);ge(async()=>{const[o,s]=await Promise.all([n.authenticationManagement.getRequiredActions(),n.authenticationManagement.getUnregisteredRequiredActions()]);return[...o.map(m=>({name:m.name,enabled:m.enabled,defaultAction:m.defaultAction,data:m})),...s.map(m=>({name:m.name,enabled:!1,defaultAction:!1,data:m}))]},o=>l(o),[p]);const d=o=>!("alias"in o),f=async(o,s)=>{try{s in o?(o[s]=!o[s],await n.authenticationManagement.updateRequiredAction({alias:o.alias},o)):d(o)&&await n.authenticationManagement.registerRequiredAction({name:o.name,providerId:o.providerId}),h(),a(t("updatedRequiredActionSuccess"),V.success)}catch(m){i("authentication:updatedRequiredActionError",m)}},g=async(o,s)=>{try{const m=o.alias;for(let v=0;v<Math.abs(s);v++)s>0?await n.authenticationManagement.lowerRequiredActionPriority({alias:m}):await n.authenticationManagement.raiseRequiredActionPriority({alias:m});h(),a(t("updatedRequiredActionSuccess"),V.success)}catch(m){i("authentication:updatedRequiredActionError",m)}};return c?e(Je,{keyField:"name",onDragFinish:async(o,s)=>{const m=c.map(w=>w.name),v=s.indexOf(o),y=m.indexOf(o),S=c[y].data;if(!S.alias)return;const I=v-y;g(S,I)},columns:[{name:"name",displayKey:"authentication:requiredActions"},{name:"enabled",displayKey:"common:enabled",cellRenderer:o=>e(G,{id:`enable-${Q(o.name)}`,label:t("common:on"),labelOff:t("common:off"),isChecked:o.enabled,onChange:()=>{f(o.data,"enabled")},"aria-label":Q(o.name)})},{name:"default",displayKey:"authentication:setAsDefaultAction",cellRenderer:o=>e(G,{id:`default-${Q(o.name)}`,label:t("common:on"),isDisabled:!o.enabled,labelOff:o.enabled?t("common:off"):t("disabledOff"),isChecked:o.defaultAction,onChange:()=>{f(o.data,"defaultAction")},"aria-label":Q(o.name)})}],data:c}):e(Pe,{})};const vt=({policy:{id:t,configType:n,defaultValue:a,displayName:i},onRemove:c})=>{const{t:l}=E("authentication"),{control:p,register:b,formState:{errors:h}}=Ce();return e(C,{label:i,fieldId:t,isRequired:!0,helperTextInvalid:l("common:required"),validated:h[t]?k.error:k.default,labelIcon:e(T,{helpText:`authentication-help:passwordPolicies.${t}`,fieldLabelId:`authentication:${t}`}),children:P(Ve,{children:[P(de,{isFilled:!0,children:[n&&n!=="int"&&e(ae,{id:t,"data-testid":t,...b(t,{required:!0}),defaultValue:a,validated:h[t]?k.error:k.default}),n==="int"&&e(N,{name:t,defaultValue:Number.parseInt(a||"0"),control:p,render:({field:d})=>{const g=s=>d.onChange(Math.max(s,0)),o=Number(d.value);return e(ne,{id:t,value:o,min:0,onPlus:()=>g(o+1),onMinus:()=>g(o-1),onChange:s=>{const m=Number(s.currentTarget.value);g(isNaN(m)?0:m)},className:"keycloak__policies_authentication__number-field"})}}),!n&&e(G,{id:t,label:l("common:on"),labelOff:l("common:off"),isChecked:!0,isDisabled:!0,"aria-label":i})]}),e(de,{children:e(_,{"data-testid":`remove-${t}`,variant:"link",className:"keycloak__policies_authentication__minus-icon",onClick:()=>c(t),"aria-label":l("common:remove"),children:e(nt,{})})})]})})},xe=" and ",It=(t,n)=>t.map(a=>`${a.id}(${n[a.id]})`).join(xe),Ct=(t,n)=>t.split(xe).map(St).reduce((a,{id:i,value:c})=>{const l=n.find(p=>p.id===i);return l?a.concat({...l,value:c}):a},[]);function St(t){const n=t.indexOf("(");if(n===-1)return{id:t.trim()};const a=t.substring(0,n).trim(),i=t.lastIndexOf(")");if(i===-1)return{id:a};const c=t.substring(n+1,i).trim();return{id:a,value:c}}const pe=({onSelect:t,selectedPolicies:n})=>{const{t:a}=E("authentication"),{passwordPolicies:i}=we(),[c,l]=R.exports.useState(!1),p=R.exports.useMemo(()=>i?.filter(b=>n.find(h=>h.id===b.id)===void 0),[n]);return e(Z,{width:300,onSelect:(b,h)=>{t(h),l(!1)},onToggle:b=>l(b),isOpen:c,selections:a("addPolicy"),isDisabled:p?.length===0,children:p?.map(b=>e(J,{value:b,children:b.displayName},b.id))})},Tt=({realm:t,realmUpdated:n})=>{const{t:a}=E("authentication"),{passwordPolicies:i}=we(),{adminClient:c}=O(),{addAlert:l,addError:p}=D(),{realm:b}=K(),[h,d]=R.exports.useState([]),f=I=>{d([...h,I]),s(I.id,I.defaultValue,{shouldDirty:!0})},g=W({defaultValues:{}}),{handleSubmit:o,setValue:s,reset:m,formState:{isDirty:v}}=g,y=I=>{m();const w=Ct(I.passwordPolicy||"",i);w.forEach(r=>{s(r.id,r.value)}),d(w)};R.exports.useEffect(()=>y(t),[]);const S=async I=>{const w={...t,passwordPolicy:It(h,I)};try{await c.realms.update({realm:b},w),n(w),y(w),l(a("updatePasswordPolicySuccess"),V.success)}catch(r){p("authentication:updatePasswordPolicyError",r)}};return P(j,{variant:"light",className:"pf-u-p-0",children:[(h.length!==0||t.passwordPolicy)&&P(M,{children:[e(et,{children:e(tt,{children:e(Re,{children:e(pe,{onSelect:f,selectedPolicies:h})})})}),e(Me,{}),e(j,{variant:"light",children:e(oe,{...g,children:P(se,{className:"keycloak__policies_authentication__form",role:"manage-realm",isHorizontal:!0,onSubmit:o(S),children:[h.map((I,w)=>e(vt,{policy:I,onRemove:r=>{d(h.filter(u=>u.id!==r)),s(I.id,"",{shouldDirty:!0})}},`${I.id}-${w}`)),P(re,{children:[e(_,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!v,children:a("common:save")}),e(_,{"data-testid":"reload",variant:H.link,onClick:()=>y(t),children:a("common:reload")})]})]})})})]}),!h.length&&!t.passwordPolicy&&P(ot,{"data-testid":"empty-state",variant:"large",children:[e(rt,{icon:st}),e(at,{headingLevel:"h1",size:"lg",children:a("noPasswordPolicies")}),e(lt,{children:a("noPasswordPoliciesInstructions")}),e(Fe,{children:e(pe,{onSelect:f,selectedPolicies:[]})})]})]})};const q=["totp","hotp"],be=["SHA1","SHA256","SHA512"],ye=[6,8],Rt=({realm:t,realmUpdated:n})=>{const{t:a}=E("authentication"),{control:i,reset:c,handleSubmit:l,formState:{isValid:p,isDirty:b,errors:h}}=W({mode:"onChange",defaultValues:t}),{adminClient:d}=O(),{realm:f}=K(),{addAlert:g,addError:o}=D(),s=Ne(),[m,v]=Y(),y=Xe({name:"otpPolicyType",control:i,defaultValue:q[0]}),S=r=>c(r);R.exports.useEffect(()=>S(t),[]);const I=R.exports.useMemo(()=>{const r=(t.otpSupportedApplications??[]).map(u=>a(`otpSupportedApplications.${u}`));return s(r,u=>u)},[t.otpSupportedApplications]);return e(j,{variant:"light",children:P(se,{role:"manage-realm",isHorizontal:!0,onSubmit:l(async r=>{try{await d.realms.update({realm:f},r);const u=await d.realms.findOne({realm:f});n(u),S(u),g(a("updateOtpSuccess"),V.success)}catch(u){o("authentication:updateOtpError",u)}}),className:"keycloak__otp_policies_authentication__form",children:[e(C,{label:a("otpType"),labelIcon:e(T,{helpText:"authentication-help:otpType",fieldLabelId:"authentication:otpType"}),hasNoPaddingTop:!0,children:e(N,{name:"otpPolicyType","data-testid":"otpPolicyType",defaultValue:q[0],control:i,render:({field:r})=>e(M,{children:q.map(u=>e(me,{id:u,"data-testid":u,isChecked:r.value===u,name:"otpPolicyType",onChange:()=>r.onChange(u),label:a(`policyType.${u}`),className:"keycloak__otp_policies_authentication__policy-type"},u))})})}),e(C,{label:a("otpHashAlgorithm"),labelIcon:e(T,{helpText:"authentication-help:otpHashAlgorithm",fieldLabelId:"authentication:otpHashAlgorithm"}),fieldId:"otpHashAlgorithm",children:e(N,{name:"otpPolicyAlgorithm",defaultValue:`Hmac${be[0]}`,control:i,render:({field:r})=>e(Z,{toggleId:"otpHashAlgorithm",onToggle:v,onSelect:(u,F)=>{r.onChange(F.toString()),v()},selections:r.value,variant:X.single,isOpen:m,children:be.map(u=>e(J,{selected:`Hmac${u}`===r.value,value:`Hmac${u}`,children:u},u))})})}),e(C,{label:a("otpPolicyDigits"),labelIcon:e(T,{helpText:"authentication-help:otpPolicyDigits",fieldLabelId:"authentication:otpPolicyDigits"}),hasNoPaddingTop:!0,children:e(N,{name:"otpPolicyDigits","data-testid":"otpPolicyDigits",defaultValue:ye[0],control:i,render:({field:r})=>e(M,{children:ye.map(u=>e(me,{id:`digit-${u}`,"data-testid":`digit-${u}`,isChecked:r.value===u,name:"otpPolicyDigits",onChange:()=>r.onChange(u),label:u,className:"keycloak__otp_policies_authentication__number-of-digits"},u))})})}),e(C,{label:a("lookAhead"),labelIcon:e(T,{helpText:"authentication-help:lookAhead",fieldLabelId:"authentication:lookAhead"}),fieldId:"lookAhead",children:e(N,{name:"otpPolicyLookAheadWindow",defaultValue:1,control:i,render:({field:r})=>{const F=r.value??1,L=A=>r.onChange(Math.max(A,0));return e(ne,{id:"lookAhead",value:F,min:0,onPlus:()=>L(F+1),onMinus:()=>L(F-1),onChange:A=>{const x=Number(A.currentTarget.value);L(isNaN(x)?0:x)}})}})}),y===q[0]&&e(C,{label:a("otpPolicyPeriod"),fieldId:"otpPolicyPeriod",helperTextInvalid:a("otpPolicyPeriodErrorHint"),validated:h.otpPolicyPeriod?k.error:k.default,labelIcon:e(T,{helpText:"authentication-help:otpPolicyPeriod",fieldLabelId:"authentication:otpPolicyPeriod"}),children:e(N,{name:"otpPolicyPeriod",defaultValue:30,control:i,rules:{min:1,max:120},render:({field:r})=>{const u=r.value??30;return e(Ee,{id:"otpPolicyPeriod","data-testid":"otpPolicyPeriod",value:u,onChange:r.onChange,units:["second","minute"],validated:h.otpPolicyPeriod?k.error:k.default})}})}),y===q[1]&&e(C,{label:a("initialCounter"),fieldId:"initialCounter",helperTextInvalid:a("initialCounterErrorHint"),validated:h.otpPolicyInitialCounter?k.error:k.default,labelIcon:e(T,{helpText:"authentication-help:initialCounter",fieldLabelId:"authentication:initialCounter"}),children:e(N,{name:"otpPolicyInitialCounter",defaultValue:30,control:i,rules:{min:1,max:120},render:({field:r})=>{const F=r.value??30,L=A=>r.onChange(Math.max(A,1));return e(ne,{id:"initialCounter",value:F,min:1,onPlus:()=>L(F+1),onMinus:()=>L(F-1),onChange:A=>{const x=Number(A.currentTarget.value);L(isNaN(x)?30:x)}})}})}),e(C,{label:a("supportedApplications"),labelIcon:e(T,{helpText:"authentication-help:supportedApplications",fieldLabelId:"authentication:supportedApplications"}),children:e(ct,{"data-testid":"supportedApplications",children:I.map(r=>e(dt,{isReadOnly:!0,children:r},r))})}),y===q[0]&&e(C,{label:a("otpPolicyCodeReusable"),fieldId:"otpPolicyCodeReusable",labelIcon:e(T,{helpText:"authentication-help:otpPolicyCodeReusable",fieldLabelId:"authentication:otpPolicyCodeReusable"}),children:e(N,{name:"otpPolicyCodeReusable",defaultValue:!0,control:i,render:({field:r})=>e(G,{id:"otpPolicyCodeReusable",label:a("common:on"),labelOff:a("common:off"),isChecked:r.value,onChange:r.onChange})})}),P(re,{children:[e(_,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!p||!b,children:a("common:save")}),e(_,{"data-testid":"reload",variant:H.link,onClick:()=>c({...t}),children:a("common:reload")})]})]})})};const _t=["ES256","ES384","ES512","RS256","RS384","RS512","RS1"],Et=["not specified","none","indirect","direct"],Nt=["not specified","platform","cross-platform"],Ft=["not specified","Yes","No"],xt=["not specified","required","preferred","discouraged"],B=({name:t,label:n,options:a,labelPrefix:i,isMultiSelect:c=!1})=>{const{t:l}=E("authentication"),{control:p}=Ce(),[b,h]=R.exports.useState(!1);return e(C,{label:l(n),labelIcon:e(T,{helpText:`authentication-help:${n}`,fieldLabelId:`authentication:${n}`}),fieldId:t,children:e(N,{name:t,defaultValue:a[0],control:p,render:({field:d})=>e(Z,{toggleId:t,onToggle:h,onSelect:(f,g)=>{if(c){const o=d.value.find(s=>s===g)?d.value.filter(s=>s!==g):[...d.value,g];d.onChange(o)}else d.onChange(g.toString()),h(!1)},selections:i?l(`${i}.${d.value}`):d.value,variant:c?X.typeaheadMulti:X.single,"aria-label":l(t),typeAheadAriaLabel:l(t),isOpen:b,children:a.map(f=>e(J,{selected:f===d.value,value:f,children:i?l(`${i}.${f}`):f},f))})})})},fe=({realm:t,realmUpdated:n,isPasswordLess:a=!1})=>{const{t:i}=E("authentication"),{adminClient:c}=O(),{addAlert:l,addError:p}=D(),{realm:b}=K(),{enabled:h}=$e(),d=W({mode:"onChange"}),{control:f,register:g,setValue:o,handleSubmit:s,formState:{isDirty:m,errors:v}}=d,y=a?"webAuthnPolicyPasswordless":"webAuthnPolicy",S=w=>Ue(w,o);R.exports.useEffect(()=>S(t),[]);const I=async w=>{const r=De(w);try{await c.realms.update({realm:b},r),n(r),S(r),l(i("webAuthnUpdateSuccess"),V.success)}catch(u){p("authentication:webAuthnUpdateError",u)}};return P(j,{variant:"light",children:[h&&e(_e,{bodyContent:i(`authentication-help:${y}FormHelp`),children:e(ve,{className:"keycloak__section_intro__help",children:P(ie,{children:[e(mt,{})," ",i("authentication-help:webauthnIntro")]})})}),P(se,{role:"manage-realm",isHorizontal:!0,onSubmit:s(I),className:"keycloak__webauthn_policies_authentication__form",children:[e(C,{label:i("webAuthnPolicyRpEntityName"),fieldId:"webAuthnPolicyRpEntityName",helperTextInvalid:i("common:required"),validated:v.webAuthnPolicyRpEntityName?"error":"default",isRequired:!0,labelIcon:e(T,{helpText:"authentication-help:webAuthnPolicyRpEntityName",fieldLabelId:"authentication:webAuthnPolicyRpEntityName"}),children:e(ae,{id:"webAuthnPolicyRpEntityName","data-testid":"webAuthnPolicyRpEntityName",validated:v.webAuthnPolicyRpEntityName?"error":"default",...g(`${y}RpEntityName`,{required:!0})})}),P(oe,{...d,children:[e(B,{name:`${y}SignatureAlgorithms`,label:"webAuthnPolicySignatureAlgorithms",options:_t,isMultiSelect:!0}),e(C,{label:i("webAuthnPolicyRpId"),labelIcon:e(T,{helpText:"authentication-help:webAuthnPolicyRpId",fieldLabelId:"authentication:webAuthnPolicyRpId"}),fieldId:"webAuthnPolicyRpId",children:e(ae,{id:"webAuthnPolicyRpId","data-testid":"webAuthnPolicyRpId",...g(`${y}RpId`)})}),e(B,{name:`${y}AttestationConveyancePreference`,label:"webAuthnPolicyAttestationConveyancePreference",options:Et,labelPrefix:"attestationPreference"}),e(B,{name:`${y}AuthenticatorAttachment`,label:"webAuthnPolicyAuthenticatorAttachment",options:Nt,labelPrefix:"authenticatorAttachment"}),e(B,{name:`${y}RequireResidentKey`,label:"webAuthnPolicyRequireResidentKey",options:Ft,labelPrefix:"residentKey"}),e(B,{name:`${y}UserVerificationRequirement`,label:"webAuthnPolicyUserVerificationRequirement",options:xt,labelPrefix:"userVerify"}),e(C,{label:i("webAuthnPolicyCreateTimeout"),fieldId:"webAuthnPolicyCreateTimeout",helperTextInvalid:i("webAuthnPolicyCreateTimeoutHint"),validated:v.webAuthnPolicyCreateTimeout?"error":"default",labelIcon:e(T,{helpText:"authentication-help:webAuthnPolicyCreateTimeout",fieldLabelId:"authentication:webAuthnPolicyCreateTimeout"}),children:e(N,{name:`${y}CreateTimeout`,defaultValue:0,control:f,rules:{min:0,max:31536},render:({field:w})=>e(Ee,{"data-testid":"webAuthnPolicyCreateTimeout","aria-label":i("webAuthnPolicyCreateTimeout"),value:w.value,onChange:w.onChange,units:["second","minute","hour"],validated:v.webAuthnPolicyCreateTimeout?"error":"default"})})}),e(C,{label:i("webAuthnPolicyAvoidSameAuthenticatorRegister"),fieldId:"webAuthnPolicyAvoidSameAuthenticatorRegister",labelIcon:e(T,{helpText:"authentication-help:webAuthnPolicyAvoidSameAuthenticatorRegister",fieldLabelId:"authentication:webAuthnPolicyAvoidSameAuthenticatorRegister"}),children:e(N,{name:`${y}AvoidSameAuthenticatorRegister`,defaultValue:!1,control:f,render:({field:w})=>e(G,{id:"webAuthnPolicyAvoidSameAuthenticatorRegister",label:i("common:on"),labelOff:i("common:off"),isChecked:w.value,onChange:w.onChange,"aria-label":i("webAuthnPolicyAvoidSameAuthenticatorRegister")})})}),e(C,{label:i("webAuthnPolicyAcceptableAaguids"),fieldId:"webAuthnPolicyAcceptableAaguids",labelIcon:e(T,{helpText:"authentication-help:webAuthnPolicyAcceptableAaguids",fieldLabelId:"authentication:webAuthnPolicyAcceptableAaguids"}),children:e(ht,{name:`${y}AcceptableAaguids`,"aria-label":i("webAuthnPolicyAcceptableAaguids"),addButtonLabel:"authentication:addAaguids"})})]}),P(re,{children:[e(_,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!m,children:i("common:save")}),e(_,{"data-testid":"reload",variant:H.link,onClick:()=>S(t),children:i("common:reload")})]})]})]})},kt=()=>{const{t}=E("authentication"),[n,a]=R.exports.useState(1),{adminClient:i}=O(),{realm:c}=K(),[l,p]=R.exports.useState();return ge(async()=>{const b=await i.realms.findOne({realm:c});if(!b)throw new Error(t("common:notFound"));return b},b=>{p(b)},[]),l?P(bt,{activeKey:n,onSelect:(b,h)=>a(h),mountOnEnter:!0,unmountOnExit:!0,children:[e($,{id:"passwordPolicy",eventKey:1,title:e(U,{children:t("passwordPolicy")}),children:e(Tt,{realm:l,realmUpdated:p})}),e($,{id:"otpPolicy",eventKey:2,title:e(U,{children:t("otpPolicy")}),children:e(Rt,{realm:l,realmUpdated:p})}),e($,{id:"webauthnPolicy",eventKey:3,title:e(U,{children:t("webauthnPolicy")}),children:e(fe,{realm:l,realmUpdated:p})}),e($,{id:"webauthnPasswordlessPolicy",eventKey:4,title:e(U,{children:t("webauthnPasswordlessPolicy")}),children:e(fe,{realm:l,realmUpdated:p,isPasswordLess:!0})})]}):e(Pe,{})},Lt=({flowAlias:t,onClose:n})=>{const{t:a}=E("authentication"),{control:i,handleSubmit:c}=W(),{adminClient:l}=O(),{addAlert:p,addError:b}=D(),{realm:h}=K(),[d,f]=Y(),g=async({bindingType:o})=>{const s=await l.realms.findOne({realm:h});try{await l.realms.update({realm:h},{...s,[o]:t}),p(a("updateFlowSuccess"),V.success)}catch(m){b("authentication:updateFlowError",m)}n()};return e(le,{title:a("bindFlow"),variant:"small",onClose:n,actions:[e(_,{"data-testid":"save",type:"submit",form:"bind-form",children:a("common:save")},"confirm"),e(_,{"data-testid":"cancel",variant:H.link,onClick:n,children:a("common:cancel")},"cancel")],isOpen:!0,children:e(Te,{id:"bind-form",isHorizontal:!0,onSubmit:c(g),children:e(C,{label:a("chooseBindingType"),fieldId:"chooseBindingType",children:e(N,{name:"bindingType",defaultValue:"browserFlow",control:i,render:({field:o})=>e(Z,{toggleId:"chooseBindingType",onToggle:f,onSelect:(s,m)=>{o.onChange(m.toString()),f()},selections:o.value,variant:X.single,isOpen:d,menuAppendTo:"parent",children:[...z.keys()].filter(s=>s!=="dockerAuthenticationFlow").map(s=>{const m=z.get(s);return e(J,{selected:s===z.get(s),value:s,children:a(`flow.${m}`)},s)})})})})})})};const te=({label:t})=>P(M,{children:[e(Ke,{className:"keycloak_authentication-section__usedby"})," ",t]}),Ot=({id:t,isSpecificClient:n,onClose:a})=>{const{t:i}=E("authentication"),{adminClient:c}=O(),l=async(p,b,h)=>(await yt({adminClient:c,id:t,type:n?"clients":"idp",first:p||0,max:b||10,search:h})).map(f=>({name:f}));return e(le,{header:P(ve,{children:[e(ie,{component:pt.h1,children:i("flowUsedBy")}),e(ie,{children:i("flowUsedByDescription",{value:i(n?"clients":"identiyProviders")})})]}),variant:Se.medium,isOpen:!0,onClose:a,actions:[e(_,{"data-testid":"cancel",id:"modal-cancel",onClick:a,children:i("common:close")},"cancel")],children:e(Ie,{loader:l,isPaginated:!0,ariaLabelKey:"authentication:usedBy",searchPlaceholderKey:"common:search",columns:[{name:"name"}]})})},Vt=({authType:{id:t,usedBy:n}})=>{const{t:a}=E("authentication"),[i,c]=Y();return P(M,{children:[i&&e(Ot,{id:t,onClose:c,isSpecificClient:n?.type==="SPECIFIC_CLIENTS"}),(n?.type==="SPECIFIC_PROVIDERS"||n?.type==="SPECIFIC_CLIENTS")&&(n.values.length<=8?e(_e,{"aria-label":a("usedBy"),bodyContent:P("div",{children:[a("appliedBy"+(n.type==="SPECIFIC_CLIENTS"?"Clients":"Providers"))," ",n.values.map((l,p)=>P(M,{children:[e("strong",{children:l}),p<n.values.length-1?", ":""]}))]},`usedBy-${t}-${n.values}`),children:e(_,{variant:"link",className:"keycloak__used-by__popover-button",children:e(te,{label:a(`used.${n.type}`)})})},t):e(_,{variant:"link",className:"keycloak__used-by__popover-button",onClick:c,children:e(te,{label:a(`used.${n.type}`)})})),n?.type==="DEFAULT"&&e(te,{label:a([...z.values()].includes(n.values[0])?`flow.${n.values[0]}`:n.values[0])}),!n?.type&&a("used.notInUse")]})};const z=new Map([["browserFlow","browser"],["registrationFlow","registration"],["directGrantFlow","direct grant"],["resetCredentialsFlow","reset credentials"],["clientAuthenticationFlow","clients"],["dockerAuthenticationFlow","docker auth"]]);function Mt(){const{t}=E("authentication"),{adminClient:n}=O(),{realm:a}=K(),[i,c]=R.exports.useState(0),l=()=>c(i+1),{addAlert:p,addError:b}=D(),h=Ne(),[d,f]=R.exports.useState(),[g,o]=Y(),[s,m]=Y(),v=async()=>{const x=await(await fetch(`${Be(n.baseUrl)}admin/realms/${a}/ui-ext/authentication-management/flows`,{method:"GET",headers:ze(await n.getAccessToken())})).json();return x?Ge(h(x,ut("alias")),ee=>ee.usedBy?.type):[]},y=A=>At(ue({realm:a,tab:A})),S=y("flows"),I=y("required-actions"),w=y("policies"),[r,u]=Qe({titleKey:"authentication:deleteConfirmFlow",children:P(gt,{i18nKey:"authentication:deleteConfirmFlowMessage",children:[" ",e("strong",{children:{flow:d?d.alias:""}}),"."]}),continueButtonLabel:"common:delete",continueButtonVariant:H.danger,onConfirm:async()=>{try{await n.authenticationManagement.deleteFlow({flowId:d.id}),l(),p(t("deleteFlowSuccess"),V.success)}catch(A){b("authentication:deleteFlowError",A)}}}),F=A=>e(Vt,{authType:A}),L=({id:A,alias:x,usedBy:ee,builtIn:ce})=>P(M,{children:[e(he,{to:Ae({realm:a,id:A,usedBy:ee?.type||"notInUse",builtIn:ce?"builtIn":void 0}),children:x},`link-${A}`)," ",ce&&e(je,{children:t("buildIn")},`label-${A}`)]});return P(M,{children:[e(u,{}),g&&e(Pt,{name:d?d.alias:"",description:d?.description,toggleDialog:o,onComplete:()=>{l(),o()}}),s&&e(Lt,{onClose:()=>{m(),l()},flowAlias:d?.alias}),e(We,{titleKey:"authentication:title",subKey:"authentication:authenticationExplain",helpUrl:qe.authenticationUrl,divider:!1}),e(j,{variant:"light",className:"pf-u-p-0",children:P(ft,{isBox:!0,defaultLocation:ue({realm:a,tab:"flows"}),children:[e($,{"data-testid":"flows",title:e(U,{children:t("flows")}),...S,children:e(Ie,{loader:v,ariaLabelKey:"authentication:title",searchPlaceholderKey:"authentication:searchForFlow",toolbarItem:e(Re,{children:e(_,{component:A=>e(he,{...A,to:He({realm:a})}),children:t("createFlow")})}),actionResolver:({data:A})=>[{title:t("duplicate"),onClick:()=>{o(),f(A)}},...A.usedBy?.type!=="DEFAULT"?[{title:t("bindFlow"),onClick:()=>{m(),f(A)}}]:[],...!A.builtIn&&!A.usedBy?[{title:t("common:delete"),onClick:()=>{f(A),r()}}]:[]],columns:[{name:"alias",displayKey:"authentication:flowName",cellRenderer:L},{name:"usedBy",displayKey:"authentication:usedBy",cellRenderer:F},{name:"description",displayKey:"common:description"}],emptyState:e(Ye,{message:t("emptyEvents"),instructions:t("emptyEventsInstructions")})},i)}),e($,{"data-testid":"requiredActions",title:e(U,{children:t("requiredActions")}),...I,children:e(wt,{})}),e($,{"data-testid":"policies",title:e(U,{children:t("policies")}),...w,children:e(kt,{})})]})})]})}const pa=Object.freeze(Object.defineProperty({__proto__:null,REALM_FLOWS:z,default:Mt},Symbol.toStringTag,{value:"Module"}));export{pa as A,Lt as B,Pt as D};
//# sourceMappingURL=AuthenticationSection.b1161a6e.js.map
