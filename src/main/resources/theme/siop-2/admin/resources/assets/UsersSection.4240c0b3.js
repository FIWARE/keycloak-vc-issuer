import{u as re,az as ae,aA as oe,l as ne,ax as ie,r as o,g as le,aE as ce,aZ as de,ad as g,aX as I,j as s,K as me,h as r,F as n,q as U,am as ue,al as pe,ao as R,b1 as he,P as fe,de as v,af as be,ac as ye,ae as ge,T as Ue,bE as k,b3 as ke,c2 as Te,L as w,aU as Se,a3 as Ce,aS as Ke,df as xe}from"./index.2ecf13ca.js";import{u as N}from"./ConfirmDialog.b43fd344.js";import{L as De}from"./ListEmptyState.94d606ed.js";import{K as Ae}from"./KeycloakDataTable.5c9a6c7c.js";import{V as Ee}from"./ViewHeader.67577dd4.js";import{P as Fe}from"./PermissionTab.8539997c.js";import{R as Ie,u as Re}from"./RoutableTabs.ce00f00c.js";import{c as ve}from"./resource.09062762.js";/* empty css                     */import{c as u,a as we,b as Ne}from"./HelpItem.49be9c4e.js";import{T as P,a as L}from"./Tabs.3b19dcd9.js";import{E as Pe}from"./EmptyStateBody.25bf6e38.js";import{T as Le}from"./Text.441b2f8e.js";import{W as Ve}from"./warning-triangle-icon.c5d2ae8e.js";import"./Modal.2c72168d.js";import"./TableToolbar.f167c244.js";import"./FormGroup.24d2e56a.js";import"./EmptyStateSecondaryActions.3ed74a6a.js";import"./plus-circle-icon.f1969120.js";import"./Td.ff2a9f66.js";import"./star-icon.648ddb2a.js";import"./check.51c67984.js";import"./grip-vertical-icon.6efe1939.js";import"./Checkbox.56efba4a.js";import"./useLocaleSort.377bcdf5.js";import"./Trans.1ed7a62f.js";import"./Card.3271e4cd.js";import"./CardTitle.ab8f9378.js";import"./CardBody.8e0a3a4b.js";import"./joinPath.69b856b1.js";import"./plus-icon.a1ecd1af.js";import"./MenuList.32e086d6.js";function bs(){const{t}=re("users"),{adminClient:i}=ae(),{addAlert:T,addError:c}=oe(),{realm:l}=ne(),V=ie(),[p,_]=o.exports.useState(),[B,O]=o.exports.useState(),[S,j]=o.exports.useState(),[q,h]=o.exports.useState(!1),[d,f]=o.exports.useState([]),{profileInfo:G}=le(),[C,H]=o.exports.useState(0),m=()=>H(C+1),{hasAccess:M}=ce(),W=M("query-users");de(async()=>{const e={type:"org.keycloak.storage.UserStorageProvider"};try{return await Promise.all([i.components.find(e),i.realms.findOne({realm:l})])}catch{return[[],{}]}},([e,a])=>{_(e),j(a)},[]);const K=e=>Re(v({realm:l,tab:e})),Z=K("list"),z=K("permissions"),X=e=>s(ke,{to:Te({realm:l,id:e.id,tab:"settings"}),children:e.username},e.username),$=async(e,a,te)=>{const E={first:e,max:a},y=te||B||"";if(y&&(E.search=y),!D&&!y)return[];try{return await ve({adminClient:i,briefRepresentation:!0,...E})}catch(F){return p?.length?c("users:noUsersFoundErrorStorage",F):c("users:noUsersFoundError",F),[]}},[J,Q]=N({titleKey:"users:unlockAllUsers",messageKey:"users:unlockUsersConfirm",continueButtonLabel:"users:unlock",onConfirm:async()=>{try{await i.attackDetection.delAll(),m(),T(t("unlockUsersSuccess"),I.success)}catch(e){c("users:unlockUsersError",e)}}}),[b,Y]=N({titleKey:"users:deleteConfirm",messageKey:t("deleteConfirmDialog",{count:d.length}),continueButtonLabel:"delete",continueButtonVariant:g.danger,onConfirm:async()=>{try{for(const e of d)await i.users.del({id:e.id});f([]),m(),T(t("userDeletedSuccess"),I.success)}catch(e){c("users:userDeletedError",e)}}}),ee=e=>r(n,{children:[!e.enabled&&s(w,{color:"red",icon:s(Se,{}),children:t("disabled")},e.id),e.bruteForceStatus?.disabled&&s(w,{color:"orange",icon:s(Ve,{}),children:t("temporaryLocked")},e.id),e.enabled&&!e.bruteForceStatus?.disabled&&"\u2014"]}),se=e=>r(n,{children:[!e.emailVerified&&s(Ce,{content:s(n,{children:t("notVerified")}),children:s(Ke,{className:"keycloak__user-section__email-verified"})},`email-verified-${e.id}`)," ",k()(e.email)]}),x=()=>V(xe({realm:l}));if(!p||!S)return s(me,{});const D=!(p.length>0),A=r(n,{children:[s(u,{children:s(U,{"data-testid":"add-user",onClick:x,children:t("addUser")})}),S.bruteForceProtected?s(u,{children:s(ue,{toggle:s(pe,{onToggle:e=>h(e)}),isOpen:q,isPlain:!0,dropdownItems:[s(R,{component:"button",isDisabled:d.length===0,onClick:()=>{b(),h(!1)},children:t("deleteUser")},"deleteUser"),s(R,{component:"button",onClick:()=>{J(),h(!1)},children:t("unlockAllUsers")},"unlock")]})}):s(u,{children:s(U,{variant:g.link,onClick:b,"data-testid":"delete-user-btn",isDisabled:d.length===0,children:t("deleteUser")})})]});return r(n,{children:[s(Y,{}),s(Q,{}),s(Ee,{titleKey:"users:title",subKey:"users:usersExplain",helpUrl:he.usersUrl,divider:!1}),s(fe,{"data-testid":"users-page",variant:"light",className:"pf-u-p-0",children:r(Ie,{"data-testid":"user-tabs",defaultLocation:v({realm:l,tab:"list"}),isBox:!0,mountOnEnter:!0,children:[s(P,{id:"list","data-testid":"listTab",title:s(L,{children:t("userList")}),...Z,children:s(Ae,{loader:$,isPaginated:!0,ariaLabelKey:"users:title",searchPlaceholderKey:"users:searchForUser",canSelectAll:!0,onSelect:e=>f([...e]),emptyState:D?s(De,{message:t("noUsersFound"),instructions:t("emptyInstructions"),primaryActionText:t("createNewUser"),onPrimaryAction:x}):r(n,{children:[s(we,{children:r(Ne,{children:[s(u,{children:r(be,{children:[s(ye,{name:"search-input",type:"search","aria-label":t("search"),placeholder:t("users:searchForUser"),onChange:e=>{O(e)},onKeyDown:e=>{e.key==="Enter"&&m()}}),s(U,{variant:g.control,"aria-label":t("common:search"),onClick:m,children:s(ge,{})})]})}),A]})}),s(Pe,{"data-testid":"empty-state",variant:"large",children:s(Ue,{className:"kc-search-users-text",children:s(Le,{children:t("searchForUserDescription")})})})]}),toolbarItem:W?A:void 0,actionResolver:e=>{const a=e.data;return a.access?.manage?[{title:t("common:delete"),onClick:()=>{f([a]),b()}}]:[]},columns:[{name:"username",displayKey:"users:username",cellRenderer:X},{name:"email",displayKey:"users:email",cellRenderer:se},{name:"lastName",displayKey:"users:lastName",cellFormatters:[k()]},{name:"firstName",displayKey:"users:firstName",cellFormatters:[k()]},{name:"status",displayKey:"users:status",cellRenderer:ee}]},C)}),!G?.disabledFeatures?.includes("ADMIN_FINE_GRAINED_AUTHZ")&&s(P,{id:"permissions","data-testid":"permissionsTab",title:s(L,{children:t("common:permissions")}),...z,children:s(Fe,{type:"users"})})]})})]})}export{bs as default};
//# sourceMappingURL=UsersSection.4240c0b3.js.map
