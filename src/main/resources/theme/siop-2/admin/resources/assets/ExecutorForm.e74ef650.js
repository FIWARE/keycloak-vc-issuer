import{u as X,ax as Z,aA as _,r as l,g as J,az as Q,aZ as U,h as u,F as W,j as t,P as Y,q as h,b3 as F,cO as P,aX as $}from"./index.7cbfb18a.js";import{u as ee,C as te,F as oe}from"./index.esm.1e7ace95.js";import{D as re}from"./DynamicComponents.7f569784.js";import{F as se}from"./FormAccess.3a7ea209.js";import{H as V}from"./HelpItem.719382e8.js";import{V as ie}from"./ViewHeader.083cd951.js";import{u as k}from"./useParams.3f76335e.js";import{a as ae,A as ce}from"./FormGroup.60c77f60.js";import{S as ne,b as le,a as me}from"./Select.fbe867d5.js";import"./ClientSelect.2d31aa2e.js";import"./FileUpload.c211f5c1.js";import"./CodeEditor.5b99e2f5.js";import"./copy-icon.dbf95270.js";import"./EmptyStateBody.1533f3a6.js";import"./EmptyStateSecondaryActions.511adeb0.js";import"./GroupPickerDialog.174f65c8.js";import"./ListEmptyState.fef0510e.js";import"./TableToolbar.51ae2a5f.js";import"./plus-circle-icon.aa8a939a.js";import"./DataListItemRow.df3ed5f3.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.7e109111.js";import"./Modal.11970fe7.js";import"./ActionListItem.65cb5d9a.js";import"./FlexItem.ae9c1d3c.js";import"./minus-circle-icon.c093f419.js";import"./MultiLineInput.091fd21a.js";import"./PasswordInput.aa539188.js";import"./KeycloakTextInput.9afb01cd.js";import"./useToggle.461e82f2.js";import"./AddRoleMappingModal.c8e6830c.js";import"./KeycloakDataTable.ae870e97.js";import"./Td.1e0c90e7.js";import"./star-icon.a6efdd26.js";import"./check.51c67984.js";import"./Checkbox.7d63c785.js";import"./useLocaleSort.b8a659bb.js";import"./resource.2cd5a37e.js";import"./joinPath.69b856b1.js";import"./filter-icon.a9b0a5f3.js";import"./ConfirmDialog.4dc691c5.js";import"./KeycloakTextArea.d98120cb.js";import"./GridItem.63e5e367.js";import"./Text.28ece842.js";const A={config:{},executor:""};function tt(){const{t:i}=X("realm-settings"),C=Z(),{realm:p,profileName:c}=k(),{executorName:n}=k(),{addAlert:I,addError:H}=_(),[O,T]=l.exports.useState(!1),N=J(),{adminClient:v}=Q(),d=N.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[x,D]=l.exports.useState([]),[G,j]=l.exports.useState([]),[y,B]=l.exports.useState([]),[L,w]=l.exports.useState([]),f=ee({defaultValues:A}),{control:z,reset:E,handleSubmit:q}=f,r=!!n,b=e=>{const o=e.find(a=>a.name===c)?.executors?.find(a=>a.executor===n);o&&E({config:o.configuration})};U(()=>v.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{B(e.globalProfiles),w(e.profiles),b(e.profiles),b(e.globalProfiles)},[]);const K=async()=>{const e=f.getValues(),s=L.map(o=>{if(o.name!==c)return o;const a=(o.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(r){const m=o.executors.find(R=>R.executor===n);m.configuration={...m.configuration,...e.config}}return r?o:{...o,executors:a}});try{await v.clientPolicies.createProfiles({profiles:s,globalProfiles:y}),I(i(r?"realm-settings:updateExecutorSuccess":"realm-settings:addExecutorSuccess"),$.success),C(P({realm:p,profileName:c}))}catch(o){H(r?"realm-settings:updateExecutorError":"realm-settings:addExecutorError",o)}},g=y.find(e=>e.name===c),S=d?.find(e=>e.id===n),M=S?.properties.map(e=>{const s=r?e.defaultValue:"";return{...e,defaultValue:s}});return u(W,{children:[t(ie,{titleKey:r?n:i("addExecutor"),divider:!0}),u(Y,{variant:"light",children:[u(se,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",isReadOnly:!!g,children:[t(ae,{label:i("executorType"),fieldId:"kc-executorType",labelIcon:x.length>0&&x[0].helpText!==""?t(V,{helpText:x[0].helpText,fieldLabelId:"realm-settings:executorTypeHelpText"}):r?t(V,{helpText:S?.helpText,fieldLabelId:"realm-settings:executorTypeHelpText"}):void 0,children:t(te,{name:"executor",defaultValue:"",control:z,render:({field:e})=>t(ne,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:s=>T(s),onSelect:(s,o)=>{E({...A,executor:o.toString()});const a=d?.filter(m=>m.id===o);D(a??[]),j(a?.[0].properties??[]),T(!1)},selections:r?n:e.value,variant:le.single,"data-testid":"executorType-select","aria-label":i("executorType"),isOpen:O,maxHeight:580,isDisabled:r,children:d?.map(s=>t(me,{selected:s.id===e.value,value:s.id,description:s.helpText},s.id))})})}),t(oe,{...f,children:t(re,{properties:r?M:G})}),!g&&u(ce,{children:[t(h,{variant:"primary",onClick:()=>q(K)(),"data-testid":"addExecutor-saveBtn",children:i(r?"common:save":"common:add")}),t(h,{variant:"link",component:e=>t(F,{...e,to:P({realm:p,profileName:c})}),"data-testid":"addExecutor-cancelBtn",children:i("common:cancel")})]})]}),r&&g&&t("div",{className:"kc-backToProfile",children:t(h,{component:e=>t(F,{...e,to:P({realm:p,profileName:c})}),variant:"primary",children:i("realm-settings:back")})})]})]})}export{tt as default};
//# sourceMappingURL=ExecutorForm.e74ef650.js.map
