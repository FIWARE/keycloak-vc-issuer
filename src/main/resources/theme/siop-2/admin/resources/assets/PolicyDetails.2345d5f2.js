import{r as C,z as L,_ as Xe,v as Je,j as e,ac as Ze,p as J,bp as Qe,h as I,af as et,y as tt,ca as nt,cb as pe,cc as it,ab as st,u as P,az as K,aZ as z,F as M,q as E,ad as ee,am as se,aq as ot,aG as oe,ag as be,ao as ue,aw as w,a$ as Le,b0 as j,ax as rt,aA as at,K as lt,P as ct,b3 as dt,c6 as $e,bT as pt,aX as Oe}from"./index.7cbfb18a.js";import{a as N,C as A,u as ut,F as mt}from"./index.esm.1e7ace95.js";import{u as ht}from"./ConfirmDialog.4dc691c5.js";import{F as ft}from"./FormAccess.3a7ea209.js";import{V as gt}from"./ViewHeader.083cd951.js";import{u as Ee}from"./useParams.3f76335e.js";import{H as k}from"./HelpItem.719382e8.js";import{a as D,A as St}from"./FormGroup.60c77f60.js";import{R as te}from"./Radio.7ee3497e.js";import{R as It}from"./ResourcesPolicySelect.b32d6a9a.js";import{b as W,S as fe,a as B,d as Tt}from"./Select.fbe867d5.js";import{h as xt}from"./ClientScopeTypes.f384adfd.js";import{K as vt}from"./KeycloakDataTable.ae870e97.js";import{L as Ct}from"./ListEmptyState.fef0510e.js";import{g as yt}from"./utils.988d95db.js";import{u as me}from"./useToggle.461e82f2.js";import{M as bt,a as $t}from"./Modal.11970fe7.js";import{F as ke}from"./filter-icon.a9b0a5f3.js";import{u as Ot,m as kt}from"./useLocaleSort.b8a659bb.js";import{T as ge,a as Se,b as G,c as H,d as Ie,e as U}from"./Td.1e0c90e7.js";import{C as Te}from"./Checkbox.7d63c785.js";import{M as xe}from"./minus-circle-icon.c093f419.js";import{G as Dt}from"./GroupPickerDialog.174f65c8.js";import{K as ne}from"./KeycloakTextInput.9afb01cd.js";import{C as Rt,L as Pt}from"./CodeEditor.5b99e2f5.js";import{K as Mt}from"./KeycloakTextArea.d98120cb.js";import{A as At,S as Nt}from"./AddRoleMappingModal.c8e6830c.js";import{d as Z,D as wt}from"./DatePicker.9e41d09c.js";import{m as re,a as Lt,b as Et,c as Vt,M as _t}from"./MenuList.22670a64.js";import{F as Ft,a as De}from"./FlexItem.ae9c1d3c.js";import{N as qt}from"./NumberInput.619d2bbb.js";const F=" AM",q=" PM",Ht=(t,s,o,r,p,c)=>{const d=[],u=new Date(new Date().setHours(0,0,0,0)),f=u.getDay();for(;u.getDay()===f;){let m=u.getHours(),n=F;s&&(m===0?m=12:m>=12&&(n=q),m>12&&(m%=12)),m=s?m.toString():m.toString().padStart(2,"0");const l=u.getMinutes().toString().padStart(2,"0"),a=`${m}${o}${l}${s?n:""}`;_e(r,p,a,o,c)&&d.push(a),u.setMinutes(u.getMinutes()+t)}return d},_=(t,s,o,r,p)=>{const c=new Date(t);if(!isNaN(c.getDate())&&(t instanceof Date||t.includes("T"))){const d=r?`${c.getHours()>12?c.getHours()-12:c.getHours()}`:`${c.getHours()}`.padStart(2,"0"),u=`${c.getMinutes()}`.padStart(2,"0"),f=p?`${c.getSeconds()}`.padStart(2,"0"):"",m=f?`${o}${f}`:"";let n="";return r&&c.getHours()>11?n=q:r&&(n=F),`${d}${o}${u}${m}${n}`}else if(typeof t=="string"&&(t=t.trim(),t!==""&&Ve(t,s,o,r))){const[,d,u,f,m=""]=s.exec(t),n=p?`${o}${f??"00"}`:"";let l="";if(r){const a=m.toUpperCase();a===F.toUpperCase().trim()?l=F:a===q.toUpperCase().trim()?l=q:l=new Date().getHours()>11?q:F}return`${d}${o}${u}${n}${l}`}return t.toString()},Ve=(t,s,o,r)=>{const p=new Date(t);if(!isNaN(p.getDate())&&t.includes("T"))return!0;const c=parseInt(t.split(o)[0]),d=c>=(r?1:0)&&c<=(r?12:23);return t===""||s.test(t)&&d},Ut=(t,s)=>{const o=t.match(s);return o&&o.length?/pm/i.test(o[4])?parseInt(o[1])===12?parseInt(o[1]):parseInt(o[1])+12:/am/i.test(o[4])&&parseInt(o[1])===12?0:parseInt(o[1]):null},Gt=(t,s)=>{const o=t.match(s);return o&&o.length?parseInt(o[2]):null},Kt=(t,s)=>{var o;const r=(o=t.match(s))===null||o===void 0?void 0:o[3];return r?parseInt(r):null},_e=(t,s,o,r,p)=>{if(o.trim()==="")return!0;const c=ae(t,r,p),d=ae(o,r,p),u=ae(s,r,p);return c<=d&&d<=u},ae=(t,s,o)=>{const p=new RegExp(`^\\s*(\\d\\d?)${s}([0-5]\\d)${s}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(t);if(!p||!p.length)return;let c=p[1].padStart(2,"0");const d=p[2];let u=p[3]?`${s}${p[3]}`:"";!u&&o&&(u=`${s}00`);const f=p[4]||"";return f.toUpperCase()==="PM"&&c!=="12"?c=`${parseInt(c)+12}`:f.toUpperCase()==="AM"&&c==="12"&&(c="00"),`${c}${s}${d}${u}`};class ve extends C.exports.Component{constructor(s){super(s),this.baseComponentRef=C.exports.createRef(),this.toggleRef=C.exports.createRef(),this.inputRef=C.exports.createRef(),this.menuRef=C.exports.createRef(),this.onDocClick=n=>{var l,a,i,h;const g=(a=(l=this.toggleRef)===null||l===void 0?void 0:l.current)===null||a===void 0?void 0:a.contains(n.target),S=(h=(i=this.menuRef)===null||i===void 0?void 0:i.current)===null||h===void 0?void 0:h.contains(n.target);this.state.isTimeOptionsOpen&&!(g||S)&&this.onToggle(!1)},this.handleGlobalKeys=n=>{var l,a,i,h;const{isTimeOptionsOpen:g,focusedIndex:S,scrollIndex:y}=this.state;!((a=(l=this.inputRef)===null||l===void 0?void 0:l.current)===null||a===void 0)&&a.contains(n.target)?!g&&n.key!==L.Tab&&n.key!==L.Escape?this.onToggle(!0):g&&(n.key===L.Escape||n.key===L.Tab?this.onToggle(!1):n.key===L.Enter?S!==null?(this.focusSelection(S),n.stopPropagation()):this.onToggle(!1):(n.key===L.ArrowDown||n.key===L.ArrowUp)&&(this.focusSelection(y),this.updateFocusedIndex(0),n.preventDefault())):!((h=(i=this.menuRef)===null||i===void 0?void 0:i.current)===null||h===void 0)&&h.contains(n.target)&&(n.key===L.ArrowDown?(this.updateFocusedIndex(1),n.preventDefault()):n.key===L.ArrowUp?(this.updateFocusedIndex(-1),n.preventDefault()):(n.key===L.Escape||n.key===L.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=n=>{this.setState(l=>{const a=this.getOptions().length-1;let i=l.focusedIndex!==null?l.focusedIndex+n:l.scrollIndex+n;return i<0?i=a:i>a&&(i=0),this.scrollToIndex(i),{focusedIndex:i}})},this.getIndexToScroll=n=>this.props.menuAppendTo==="inline"?n>0?n-1:0:n,this.scrollToIndex=n=>{this.getOptions()[n].closest(`.${re.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(n)].offsetTop},this.focusSelection=n=>{var l;const a=n!==-1?n:0;!((l=this.menuRef)===null||l===void 0)&&l.current&&this.getOptions()[a].querySelector(`.${re.menuItem}`).focus()},this.scrollToSelection=n=>{const{delimiter:l,is24Hour:a}=this.props;let i=n.split(this.props.delimiter),h=null;if(i.length<2?(n=`${n}${l}00`,i=n.split(l)):i.length>2&&(n=_(n,this.state.timeRegex,l,!a,!1),i=n.split(l)),!a&&i.length>1&&i[1].length<2){const S=i[1].length===0?"00":i[1]+"0";n=`${i[0]}${l}${S}${new Date().getHours()>11?q:F}`}else!a&&i.length>1&&i[1].length===2&&!n.toUpperCase().includes(F.toUpperCase().trim())&&!n.toUpperCase().includes(q.toUpperCase().trim())&&(n=`${n}${new Date().getHours()>11?q:F}`);let g=this.getOptions().findIndex(S=>S.textContent===n);if(g!==-1)this.scrollToIndex(g),h=g;else if(i.length===2){let S="";a||(i[1].toUpperCase().includes("P")?S=q:i[1].toUpperCase().includes("A")&&(S=F)),n=`${i[0]}${l}00${S}`,g=this.getOptions().findIndex(y=>y.textContent===n),g!==-1&&this.scrollToIndex(g)}this.setState({focusedIndex:h,scrollIndex:g})},this.getRegExp=(n=!0)=>{const{is24Hour:l,delimiter:a}=this.props;let i=`\\s*(\\d\\d?)${a}([0-5]\\d)`;return n&&(i+=`${a}?([0-5]\\d)?`),new RegExp(`^${i}${l?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var n;return!((n=this.menuRef)===null||n===void 0)&&n.current?Array.from(this.menuRef.current.querySelectorAll(`.${re.menuListItem}`)):[]},this.isValidFormat=n=>{if(this.props.validateTime)return this.props.validateTime(n);const{delimiter:l,is24Hour:a,includeSeconds:i}=this.props;return Ve(n,this.getRegExp(i),l,!a)},this.isValidTime=n=>{const{delimiter:l,includeSeconds:a}=this.props,{minTimeState:i,maxTimeState:h}=this.state;return _e(i,h,n,l,a)},this.isValid=n=>this.isValidFormat(n)&&this.isValidTime(n),this.onToggle=n=>{this.setState(l=>{const{timeRegex:a,isInvalid:i}=l,{delimiter:h,is24Hour:g,includeSeconds:S}=this.props,y=_(l.timeState,a,h,!g,S);return{isTimeOptionsOpen:n,timeState:y,isInvalid:n?i:!this.isValid(y)}}),this.props.setIsOpen(n),n||this.inputRef.current.focus()},this.onSelect=n=>{const{timeRegex:l,timeState:a}=this.state,{delimiter:i,is24Hour:h,includeSeconds:g,setIsOpen:S}=this.props,y=_(n.target.textContent,l,i,!h,g);y!==a&&this.onInputChange(y,n),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),S(!1)},this.onInputClick=n=>{this.state.isTimeOptionsOpen||this.onToggle(!0),n.stopPropagation()},this.onInputChange=(n,l)=>{const{onChange:a}=this.props,{timeRegex:i}=this.state;a&&a(l,n,Ut(n,i),Gt(n,i),Kt(n,i),this.isValid(n)),this.scrollToSelection(n),this.setState({timeState:n})};const{is24Hour:o,delimiter:r,time:p,includeSeconds:c,isOpen:d}=this.props;let{minTime:u,maxTime:f}=this.props;if(u===""){const n=c?`${r}00`:"";u=o?`00${r}00${n}`:`12${r}00${n} AM`}if(f===""){const n=c?`${r}59`:"";f=o?`23${r}59${n}`:`11${r}59${n} PM`}const m=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:d,timeState:_(p,m,r,!o,c),focusedIndex:null,scrollIndex:0,timeRegex:m,minTimeState:_(u,m,r,!o,c),maxTimeState:_(f,m,r,!o,c)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys),this.setState({isInvalid:!this.isValid(this.state.timeState)})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(s,o){const{timeState:r,isTimeOptionsOpen:p,isInvalid:c,timeRegex:d}=this.state,{time:u,is24Hour:f,delimiter:m,includeSeconds:n,isOpen:l,minTime:a,maxTime:i}=this.props;if(s.isOpen!==l&&this.onToggle(l),p&&!o.isTimeOptionsOpen&&r&&!c&&this.scrollToSelection(r),m!==s.delimiter&&this.setState({timeRegex:this.getRegExp()}),u!==""&&u!==s.time){const h=_(u,d,m,!f,n);this.setState({timeState:h,isInvalid:!this.isValid(h)})}a!==""&&a!==s.minTime&&this.setState({minTimeState:_(a,d,m,!f,n)}),i!==""&&i!==s.maxTime&&this.setState({maxTimeState:_(i,d,m,!f,n)})}render(){const s=this.props,{"aria-label":o,isDisabled:r,className:p,placeholder:c,id:d,menuAppendTo:u,is24Hour:f,invalidFormatErrorMessage:m,invalidMinMaxErrorMessage:n,stepMinutes:l,width:a,delimiter:i,inputProps:h,onChange:g,setIsOpen:S,isOpen:y,time:x,validateTime:b,minTime:$,maxTime:O,includeSeconds:v,removeFindDomNode:R,zIndex:T}=s,V=Xe(s,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","removeFindDomNode","zIndex"]),{timeState:Y,isTimeOptionsOpen:qe,isInvalid:Ce,minTimeState:He,maxTimeState:Ue}=this.state,Ge={"--pf-c-date-picker__input--c-form-control--Width":a},Ke=Ht(l,!f,i,He,Ue,v),ze=this.isValidFormat(Y),ie=d||Je("time-picker"),je=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,We=e(Lt,{ref:this.menuRef,isScrollable:!0,children:e(Et,{maxMenuHeight:"200px",children:e(Vt,{"aria-label":o,children:Ke.map((ye,Ye)=>e(_t,{onClick:this.onSelect,id:`${ie}-option-${Ye}`,children:ye},ye))})})}),Be=e(Ze,{...Object.assign({"aria-haspopup":"menu",className:J(Qe.formControl),id:`${ie}-input`,"aria-label":o,validated:Ce?"error":"default",placeholder:c,value:Y||"",type:"text",iconVariant:"clock",onClick:this.onInputClick,onChange:this.onInputChange,autoComplete:"off",isDisabled:r,ref:this.inputRef},h)});let X;switch(u){case"inline":X=()=>this.toggleRef.current;break;case"parent":X=je;break;default:X=u}return e("div",{ref:this.baseComponentRef,className:J(Z.datePicker,p),children:I("div",{...Object.assign({className:J(Z.datePickerInput),style:Ge},V),children:[e(et,{children:e("div",{id:ie,children:e("div",{ref:this.toggleRef,style:{paddingLeft:"0"},children:e(tt,{appendTo:X,trigger:Be,popper:We,isVisible:qe,removeFindDomNode:R,zIndex:T})})})}),Ce&&e("div",{className:J(Z.datePickerHelperText,Z.modifiers.error),children:ze?n:m})]})})}}ve.displayName="TimePicker";ve.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},removeFindDomNode:!1,zIndex:9999};var zt=/\s/;function jt(t){for(var s=t.length;s--&&zt.test(t.charAt(s)););return s}var Wt=/^\s+/;function Bt(t){return t&&t.slice(0,jt(t)+1).replace(Wt,"")}var Re=0/0,Yt=/^[-+]0x[0-9a-f]+$/i,Xt=/^0b[01]+$/i,Jt=/^0o[0-7]+$/i,Zt=parseInt;function Pe(t){if(typeof t=="number")return t;if(nt(t))return Re;if(pe(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=pe(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=Bt(t);var o=Xt.test(t);return o||Jt.test(t)?Zt(t.slice(2),o?2:8):Yt.test(t)?Re:+t}var Qt=function(){return it.Date.now()};const le=Qt;var en="Expected a function",tn=Math.max,nn=Math.min;function sn(t,s,o){var r,p,c,d,u,f,m=0,n=!1,l=!1,a=!0;if(typeof t!="function")throw new TypeError(en);s=Pe(s)||0,pe(o)&&(n=!!o.leading,l="maxWait"in o,c=l?tn(Pe(o.maxWait)||0,s):c,a="trailing"in o?!!o.trailing:a);function i(v){var R=r,T=p;return r=p=void 0,m=v,d=t.apply(T,R),d}function h(v){return m=v,u=setTimeout(y,s),n?i(v):d}function g(v){var R=v-f,T=v-m,V=s-R;return l?nn(V,c-T):V}function S(v){var R=v-f,T=v-m;return f===void 0||R>=s||R<0||l&&T>=c}function y(){var v=le();if(S(v))return x(v);u=setTimeout(y,g(v))}function x(v){return u=void 0,a&&r?i(v):(r=p=void 0,d)}function b(){u!==void 0&&clearTimeout(u),m=0,r=f=p=u=void 0}function $(){return u===void 0?d:x(le())}function O(){var v=le(),R=S(v);if(r=arguments,p=this,f=v,R){if(u===void 0)return h(f);if(l)return clearTimeout(u),u=setTimeout(y,s),i(f)}return u===void 0&&(u=setTimeout(y,s)),d}return O.cancel=b,O.flush=$,O}const on={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},rn=st(on),an=({name:t,label:s,helpText:o,defaultValue:r,isRequired:p,variant:c=W.typeaheadMulti})=>{const{t:d}=P("clients"),{control:u,getValues:f,formState:{errors:m}}=N(),n=f(t),[l,a]=me(),[i,h]=C.exports.useState([]),[g,S]=C.exports.useState(""),{adminClient:y}=K(),x=C.exports.useCallback(sn(S,1e3),[]);z(()=>{const $={max:20};return g&&($.username=g),n?.length&&!g?Promise.all(n.map(O=>y.users.findOne({id:O}))):y.users.find($)},h,[g]);const b=$=>$.filter(O=>O!==void 0).map(O=>e(B,{value:O.id,selected:n?.includes(O.id),children:O.username},O.id));return e(D,{label:d(s),isRequired:p,labelIcon:e(k,{helpText:o,fieldLabelId:`clients:${s}`}),fieldId:t,validated:m[t]?"error":"default",helperTextInvalid:d("common:required"),children:e(A,{name:t,defaultValue:r,control:u,rules:p&&c===W.typeaheadMulti?{validate:$=>$.length>0}:p?{required:!0}:{},render:({field:$})=>e(fe,{toggleId:t,variant:c,placeholderText:d("selectAUser"),onToggle:a,isOpen:l,selections:$.value,onFilter:(O,v)=>(x(v),b(i)),onSelect:(O,v)=>{const R=v.toString();c!==W.typeaheadMulti?$.onChange([R]):$.value.includes(R)?$.onChange($.value.filter(T=>T!==R)):$.onChange([...$.value,R]),a()},"aria-label":d(t),children:b(i)})})})},ce=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],ln=({helpLabel:t,isLimited:s=!1})=>{const{t:o}=P("clients"),{control:r}=N();return e(D,{label:o("decisionStrategy"),labelIcon:e(k,{helpText:`clients-help:${t||"decisionStrategy"}`,fieldLabelId:"clients:decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(A,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:ce[0],control:r,render:({field:p})=>e(M,{children:(s?ce.slice(0,2):ce).map(c=>e(te,{id:c,"data-testid":c,isChecked:p.value===c,name:"decisionStrategy",onChange:()=>p.onChange(c),label:o(`decisionStrategies.${c}`),className:"pf-u-mb-md"},c))})})})},cn=()=>{const{t}=P("clients"),{id:s}=Ee();return I(M,{children:[e(D,{label:t("applyPolicy"),fieldId:"policies",labelIcon:e(k,{helpText:"clients-help:applyPolicy",fieldLabelId:"clients:policies"}),children:e(It,{name:"policies",clientId:s})}),e(ln,{helpLabel:"policyDecisionStagey"})]})},dn=()=>{const{t}=P("clients"),{control:s,getValues:o,formState:{errors:r}}=N(),p=o("clients"),[c,d]=C.exports.useState(!1),[u,f]=C.exports.useState([]),[m,n]=C.exports.useState(""),{adminClient:l}=K();z(async()=>{const i={max:20};return m&&(i.clientId=m,i.search=!0),p?.length&&!m?await Promise.all(p.map(h=>l.clients.findOne({id:h}))):await l.clients.find(i)},f,[m]);const a=i=>i.map(h=>e(B,{value:h.id,selected:p?.includes(h.id),children:h.clientId},h.id));return e(D,{label:t("clients"),labelIcon:e(k,{helpText:"clients-help:policyClient",fieldLabelId:"clients:client"}),fieldId:"clients",helperTextInvalid:t("requiredClient"),validated:r.clients?"error":"default",isRequired:!0,children:e(A,{name:"clients",defaultValue:[],control:s,rules:{validate:i=>i.length>0},render:({field:i})=>e(fe,{toggleId:"clients",variant:W.typeaheadMulti,onToggle:h=>d(h),isOpen:c,selections:i.value,onFilter:(h,g)=>(n(g),a(u)),onSelect:(h,g)=>{const S=g.toString();i.value.includes(S)?i.onChange(i.value.filter(y=>y!==S)):i.onChange([...i.value,S]),d(!1)},"aria-label":t("clients"),children:a(u)})})})};const pn=({clientScopes:t,clientName:s,open:o,toggleDialog:r,onAdd:p,isClientScopesConditionType:c})=>{const{t:d}=P("clients"),[u,f]=C.exports.useState(!1),[m,n]=C.exports.useState([]),[l,a]=C.exports.useState("Name"),[i,h]=C.exports.useState("All"),[g,S]=me(),[y,x]=me(!1),b=C.exports.useMemo(()=>i==="OpenID Connect"?t.filter(T=>T.protocol==="openid-connect"):i==="SAML"?t.filter(T=>T.protocol==="saml"):t,[t,l,i]),$=T=>{const V=m.map(Y=>({scope:Y,type:T}));p(V),f(!1),r()},O=T=>{T==="Name"?a("Protocol"):T==="Protocol"&&(a("Name"),h("All")),S()},v=T=>{T==="SAML"?h("SAML"):T==="OpenID Connect"?h("OpenID Connect"):T==="All"&&h("All"),x()},R=[e(B,{value:"SAML",children:d("protocolTypes.saml")},1),e(B,{value:"OpenID Connect",children:d("protocolTypes.openIdConnect")},2),e(B,{value:"All",isPlaceholder:!0,children:d("protocolTypes.all")},3)];return e(bt,{variant:$t.medium,title:c?d("addClientScope"):d("addClientScopesTo",{clientName:s}),isOpen:o,onClose:r,actions:c?[e(E,{id:"modal-add","data-testid":"confirm",variant:ee.primary,onClick:()=>{const T=m.map(V=>({scope:V}));p(T),r()},isDisabled:m.length===0,children:d("common:add")},"add"),e(E,{id:"modal-cancel","data-testid":"cancel",variant:ee.link,onClick:()=>{n([]),r()},children:d("common:cancel")},"cancel")]:[e(se,{className:"keycloak__client-scopes-add__add-dropdown",id:"add-dropdown",direction:ot.up,isOpen:u,toggle:e(oe,{isDisabled:m.length===0,onToggle:()=>f(!u),isPrimary:!0,toggleIndicator:rn,id:"add-scope-toggle",children:d("common:add")}),dropdownItems:xt(d,$)},"add-dropdown"),e(E,{id:"modal-cancel",variant:ee.link,onClick:()=>{n([]),r()},children:d("common:cancel")},"cancel")],children:e(vt,{loader:b,ariaLabelKey:"client-scopes:chooseAMapperType",searchPlaceholderKey:l==="Name"?"client-scopes:searchFor":void 0,isSearching:l!=="Name",searchTypeComponent:e(se,{onSelect:()=>{O(l)},"data-testid":"filter-type-dropdown",toggle:e(oe,{id:"toggle-id-9",onToggle:S,toggleIndicator:be,icon:e(ke,{}),children:l}),isOpen:g,dropdownItems:[e(ue,{"data-testid":"filter-type-dropdown-item",children:d(l==="Name"?"protocol":"common:name")},"filter-type")]}),toolbarItem:l==="Protocol"&&I(M,{children:[e(se,{onSelect:()=>{O(l)},"data-testid":"filter-type-dropdown",toggle:e(oe,{id:"toggle-id-9",onToggle:S,toggleIndicator:be,icon:e(ke,{}),children:l}),isOpen:g,dropdownItems:[e(ue,{"data-testid":"filter-type-dropdown-item",children:d("common:name")},"filter-type")]}),e(fe,{variant:W.single,className:"kc-protocolType-select","aria-label":"Select Input",onToggle:x,onSelect:(T,V)=>v(V.toString()),selections:i,isOpen:y,direction:Tt.down,children:R})]}),canSelectAll:!0,onSelect:T=>n(T),columns:[{name:"name"},{name:"protocol",displayKey:"clients:protocol",cellRenderer:T=>yt(d,T.protocol??"openid-connect")},{name:"description"}],emptyState:e(Ct,{message:d("emptyAddClientScopes"),instructions:d("emptyAddClientScopesInstructions")})})})},un=()=>{const{t}=P("clients"),{control:s,getValues:o,setValue:r,formState:{errors:p}}=N(),[c,d]=C.exports.useState(!1),[u,f]=C.exports.useState([]),[m,n]=C.exports.useState([]),{adminClient:l}=K(),a=Ot();return z(()=>l.clientScopes.find(),i=>{n(o("clientScopes").map(h=>i.find(g=>g.id===h.id))),f(a(i,kt("name")))},[]),I(D,{label:t("clientScopes"),labelIcon:e(k,{helpText:"clients-help:clientScopes",fieldLabelId:"clients:clientScopes"}),fieldId:"clientScopes",helperTextInvalid:t("requiredClientScope"),validated:p.clientScopes?"error":"default",isRequired:!0,children:[e(A,{name:"clientScopes",control:s,defaultValue:[],rules:{validate:i=>i.filter(h=>h.id).length>0},render:({field:i})=>I(M,{children:[c&&e(pn,{clientScopes:u.filter(h=>!i.value.map(g=>g.id).includes(h.id)),isClientScopesConditionType:!0,open:c,toggleDialog:()=>d(!c),onAdd:h=>{n([...m,...h.map(g=>g.scope)]),i.onChange([...i.value,...h.map(g=>g.scope).map(g=>({id:g.id,required:!1}))])}}),e(E,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{d(!0)},children:t("addClientScopes")})]})}),m.length>0&&I(ge,{variant:"compact",children:[e(Se,{children:I(G,{children:[e(H,{children:t("clientScope")}),e(H,{children:t("required")}),e(H,{})]})}),e(Ie,{children:m.map((i,h)=>I(G,{children:[e(U,{children:i.name}),e(U,{children:e(A,{name:`clientScopes.${h}.required`,defaultValue:!1,control:s,render:({field:g})=>e(Te,{id:"required","data-testid":"standard",name:"required",isChecked:g.value,onChange:g.onChange})})}),e(U,{children:e(E,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(xe,{}),onClick:()=>{r("clientScopes",[...o("clientScopes").filter(g=>g.id!==i.id)]),n([...m.filter(g=>g.id!==i.id)])}})})]},i.id))})]})]})},mn=()=>{const{t}=P("clients"),{control:s,register:o,getValues:r,setValue:p,formState:{errors:c}}=N(),d=r("groups"),[u,f]=C.exports.useState(!1),[m,n]=C.exports.useState([]),{adminClient:l}=K();return z(()=>d&&d.length>0?Promise.all(d.map(a=>l.groups.findOne({id:a.id}))):Promise.resolve([]),a=>{const i=a.filter(h=>h);n(i)},[]),I(M,{children:[e(D,{label:t("groupsClaim"),labelIcon:e(k,{helpText:"clients-help:groupsClaim",fieldLabelId:"clients:groupsClaim"}),fieldId:"groups",children:e(ne,{type:"text",id:"groupsClaim","data-testid":"groupsClaim",...o("groupsClaim")})}),I(D,{label:t("groups"),labelIcon:e(k,{helpText:"clients-help:policyGroups",fieldLabelId:"clients:groups"}),fieldId:"groups",helperTextInvalid:t("requiredGroups"),validated:c.groups?"error":"default",isRequired:!0,children:[e(A,{name:"groups",control:s,defaultValue:[],rules:{validate:a=>a&&a.filter(({id:i})=>i).length>0},render:({field:a})=>I(M,{children:[u&&e(Dt,{type:"selectMany",text:{title:"clients:addGroupsToGroupPolicy",ok:"common:add"},onConfirm:i=>{a.onChange([...a.value||[],...(i||[]).map(({id:h})=>({id:h}))]),n([...m,...i||[]]),f(!1)},onClose:()=>{f(!1)},filterGroups:m}),e(E,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{f(!0)},children:t("addGroups")})]})}),m.length>0&&I(ge,{variant:"compact",children:[e(Se,{children:I(G,{children:[e(H,{children:t("groups")}),e(H,{children:t("extendToChildren")}),e(H,{})]})}),e(Ie,{children:m.map((a,i)=>I(G,{children:[e(U,{children:a.path}),e(U,{children:e(A,{name:`groups.${i}.extendChildren`,defaultValue:!1,control:s,render:({field:h})=>e(Te,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:h.value,onChange:h.onChange,isDisabled:a.subGroups?.length===0})})}),e(U,{children:e(E,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(xe,{}),onClick:()=>{p("groups",[...(d||[]).filter(({id:h})=>h!==a.id)]),n([...m.filter(({id:h})=>h!==a.id)])}})})]},a.id))})]})]})]})},hn=()=>{const{t}=P("clients"),{control:s}=N();return e(D,{label:t("code"),labelIcon:e(k,{helpText:"clients-help:policyCode",fieldLabelId:"clients:code"}),fieldId:"code",isRequired:!0,children:e(A,{name:"code",defaultValue:"",control:s,render:({field:o})=>e(Rt,{id:"code","data-testid":"code",onChange:o.onChange,code:o.value,height:"600px",language:Pt.javascript})})})},Me=["POSITIVE","NEGATIVE"],fn=()=>{const{t}=P("clients"),{control:s}=N();return e(D,{label:t("logic"),labelIcon:e(k,{helpText:"clients-help:logic",fieldLabelId:"clients:logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e(A,{name:"logic","data-testid":"logic",defaultValue:Me[0],control:s,render:({field:o})=>e(M,{children:Me.map(r=>e(te,{id:r,"data-testid":r,isChecked:o.value===r,name:"logic",onChange:()=>o.onChange(r),label:t(`logicType.${r.toLowerCase()}`),className:"pf-u-mb-md"},r))})})})},gn=({prefix:t})=>{const{t:s}=P("clients"),{register:o,formState:{errors:r}}=N();return I(M,{children:[e(D,{label:s("common:name"),fieldId:"kc-name",helperTextInvalid:s("common:required"),validated:r.name?w.error:w.default,isRequired:!0,labelIcon:e(k,{helpText:`clients-help:${t}-name`,fieldLabelId:"name"}),children:e(ne,{id:"kc-name","data-testid":"name",validated:r.name?w.error:w.default,...o("name",{required:!0})})}),e(D,{label:s("common:description"),fieldId:"kc-description",labelIcon:e(k,{helpText:`clients-help:${t}-description`,fieldLabelId:"description"}),validated:r.description?w.error:w.default,helperTextInvalid:r.description?.message,children:e(Mt,{id:"kc-description","data-testid":"description",validated:r.description?w.error:w.default,...o("description",{maxLength:{value:255,message:s("common:maxLength",{length:255})}})})})]})},Sn=()=>{const{t}=P("clients"),{register:s,formState:{errors:o}}=N();return I(M,{children:[e(D,{label:t("targetClaim"),fieldId:"targetClaim",helperTextInvalid:t("common:required"),validated:o.targetClaim?"error":"default",isRequired:!0,labelIcon:e(k,{helpText:"clients-help:targetClaim",fieldLabelId:"clients:targetClaim"}),children:e(ne,{id:"targetClaim","data-testid":"targetClaim",validated:o.targetClaim?"error":"default",...s("targetClaim",{required:!0})})}),e(D,{label:t("regexPattern"),fieldId:"pattern",labelIcon:e(k,{helpText:"clients-help:regexPattern",fieldLabelId:"clients:regexPattern"}),isRequired:!0,validated:o.pattern?"error":"default",helperTextInvalid:t("common:required"),children:e(ne,{id:"pattern","data-testid":"regexPattern",validated:o.pattern?"error":"default",...s("pattern",{required:!0})})})]})},In=()=>{const{t}=P("clients"),{control:s,getValues:o,setValue:r,formState:{errors:p}}=N(),c=o("roles"),[d,u]=C.exports.useState(!1),[f,m]=C.exports.useState([]),{adminClient:n}=K();return z(async()=>{if(c&&c.length>0){const l=await Promise.all(c.map(a=>n.roles.findOneById({id:a.id})));return Promise.all(l.map(async a=>({role:a,client:a.clientRole?await n.clients.findOne({id:a?.containerId}):void 0})))}return Promise.resolve([])},m,[]),I(D,{label:t("roles"),labelIcon:e(k,{helpText:"clients-help:policyRoles",fieldLabelId:"clients:roles"}),fieldId:"roles",helperTextInvalid:t("requiredRoles"),validated:p.roles?"error":"default",isRequired:!0,children:[e(A,{name:"roles",control:s,defaultValue:[],rules:{validate:l=>l&&l.filter(a=>a.id).length>0},render:({field:l})=>I(M,{children:[d&&e(At,{id:"role",type:"roles",onAssign:a=>{l.onChange([...l.value||[],...a.map(i=>({id:i.role.id}))]),m([...f,...a]),u(!1)},onClose:()=>{u(!1)},isLDAPmapper:!0}),e(E,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>{u(!0)},children:t("addRoles")})]})}),f.length>0&&I(ge,{variant:"compact",children:[e(Se,{children:I(G,{children:[e(H,{children:t("roles")}),e(H,{children:t("required")}),e(H,{})]})}),e(Ie,{children:f.map((l,a)=>I(G,{children:[e(U,{children:e(Nt,{role:l.role,client:l.client})}),e(U,{children:e(A,{name:`roles.${a}.required`,defaultValue:!1,control:s,render:({field:i})=>e(Te,{id:"required","data-testid":"standard",name:"required",isChecked:i.value,onChange:i.onChange})})}),e(U,{children:e(E,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(xe,{}),onClick:()=>{r("roles",[...(c||[]).filter(i=>i.id!==l.role.id)]),m([...f.filter(i=>i.role.id!==l.role.id)])}})})]},l.role.id))})]})]})},de=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,Ae=t=>t.toString().padStart(2,"0"),Ne=({name:t})=>{const{control:s}=N(),o=(p,c)=>{if(!c)return p;const d=p.match(de);return`${[c.getFullYear(),Ae(c.getMonth()+1),Ae(c.getDate())].join("-")} ${d?d[2]:"00"}:${d?d[3]:"00"}:00`},r=(p,c,d)=>{const u=p.match(de);return d!=null?`${u?u[1]:""} ${c}:${d<10?`0${d}`:d}:00`:p};return e(A,{name:t,defaultValue:"",control:s,rules:{required:!0},render:({field:p})=>{const c=p.value.match(de)||["","","0","00"];return I(Le,{hasGutter:!0,id:t,children:[e(j,{children:e(wt,{value:c[1],onChange:(d,u,f)=>{p.onChange(o(p.value,f))}})}),e(j,{children:e(ve,{time:`${c[2]}:${c[3]}`,onChange:(d,u,f,m)=>p.onChange(r(p.value,f,m)),is24Hour:!0})})]})}})},we=({name:t,min:s,max:o})=>{const{control:r}=N(),p=c=>Math.min(c,o);return e(A,{name:t,defaultValue:"",control:r,render:({field:c})=>e(qt,{id:t,value:c.value,min:s,max:o,onPlus:()=>c.onChange(Number(c.value)+1),onMinus:()=>c.onChange(Number(c.value)-1),onChange:d=>{const u=Number(d.currentTarget.value);c.onChange(p(isNaN(u)?0:u))}})})},Q=({name:t,...s})=>{const{t:o}=P("clients");return e(D,{label:o(t),fieldId:t,labelIcon:e(k,{helpText:`clients-help:${t}`,fieldLabelId:`clients:${t}`}),children:I(Le,{hasGutter:!0,children:[e(j,{children:e(we,{name:t,...s})}),e(j,{children:o("common:to")}),e(j,{children:e(we,{name:`${t}End`,...s})})]})})},Tn=()=>{const{t}=P("clients"),{getValues:s,formState:{errors:o}}=N(),[r,p]=C.exports.useState(s("month"));return I(M,{children:[e(D,{label:t("repeat"),fieldId:"repeat",labelIcon:e(k,{helpText:"clients-help:repeat",fieldLabelId:"clients:repeat"}),children:I(Ft,{children:[e(De,{children:e(te,{id:"notRepeat","data-testid":"notRepeat",isChecked:!r,name:"repeat",onChange:()=>p(!1),label:t("notRepeat"),className:"pf-u-mb-md"})}),e(De,{children:e(te,{id:"repeat","data-testid":"repeat",isChecked:r,name:"repeat",onChange:()=>p(!0),label:t("repeat"),className:"pf-u-mb-md"})})]})}),r&&I(M,{children:[e(Q,{name:"month",min:1,max:12}),e(Q,{name:"dayMonth",min:1,max:31}),e(Q,{name:"hour",min:0,max:23}),e(Q,{name:"minute",min:0,max:59})]}),e(D,{label:t("startTime"),fieldId:"notBefore",labelIcon:e(k,{helpText:"clients-help:startTime",fieldLabelId:"clients:startTime"}),isRequired:!0,helperTextInvalid:t("common:required"),validated:o.notBefore?w.error:w.default,children:e(Ne,{name:"notBefore"})}),e(D,{label:t("expireTime"),fieldId:"notOnOrAfter",labelIcon:e(k,{helpText:"clients-help:expireTime",fieldLabelId:"clients:expireTime"}),isRequired:!0,helperTextInvalid:t("common:required"),validated:o.notOnOrAfter?w.error:w.default,children:e(Ne,{name:"notOnOrAfter"})})]})},xn=()=>e(an,{name:"users",label:"users",helpText:"clients-help:policyUsers",defaultValue:[],isRequired:!0});const he={aggregate:cn,client:dn,user:xn,"client-scope":un,group:mn,regex:Sn,role:In,time:Tn,js:hn},Fe=t=>t in he;function vn(){const{t}=P("clients"),{id:s,realm:o,policyId:r,policyType:p}=Ee(),c=rt(),d=ut(),{reset:u,handleSubmit:f}=d,{adminClient:m}=K(),{addAlert:n,addError:l}=at(),[a,i]=C.exports.useState();z(async()=>{if(r){const x=await Promise.all([m.clients.findOnePolicy({id:s,type:p,policyId:r}),m.clients.getAssociatedPolicies({id:s,permissionId:r})]);if(!x[0])throw new Error(t("common:notFound"));return{policy:x[0],policies:x[1].map(b=>b.id)}}return{}},({policy:x,policies:b})=>{u({...x,policies:b}),i(x)},[]);const h=async x=>{x.groups=x.groups?.filter(b=>b.id),x.clientScopes=x.clientScopes?.filter(b=>b.id),x.roles=x.roles?.filter(b=>b.id).map(b=>({...b,required:b.required||!1}));try{if(r)await m.clients.updatePolicy({id:s,type:p,policyId:r},x);else{const b=await m.clients.createPolicy({id:s,type:p},x);c(pt({realm:o,id:s,policyType:p,policyId:b.id}))}n(t((r?"update":"create")+"PolicySuccess"),Oe.success)}catch(b){l("clients:policySaveError",b)}},[g,S]=ht({titleKey:"clients:deletePolicy",messageKey:"clients:deletePolicyConfirm",continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await m.clients.delPolicy({id:s,policyId:r}),n(t("policyDeletedSuccess"),Oe.success),c($e({realm:o,clientId:s,tab:"policies"}))}catch(x){l("clients:policyDeletedError",x)}}});if(r&&!a)return e(lt,{});const y=Fe(p)?he[p]:he.js;return I(M,{children:[e(S,{}),e(gt,{titleKey:r?a?.name:t("clients:createPolicyOfType",{policyType:p}),dropdownItems:r?[e(ue,{"data-testid":"delete-policy",onClick:()=>g(),children:t("common:delete")},"delete")]:void 0}),e(ct,{variant:"light",children:I(ft,{isHorizontal:!0,onSubmit:f(h),role:"view-clients",children:[I(mt,{...d,children:[e(gn,{prefix:"policy"}),e(y,{}),e(fn,{})]}),e(St,{children:I("div",{className:"pf-u-mt-md",children:[e(E,{variant:ee.primary,className:"pf-u-mr-md",type:"submit","data-testid":"save",children:t("common:save")}),e(E,{variant:"link","data-testid":"cancel",component:x=>e(dt,{...x,to:$e({realm:o,clientId:s,tab:"policies"})}),children:t("common:cancel")})]})})]})})]})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,isValidComponentType:Fe,default:vn},Symbol.toStringTag,{value:"Module"}));export{pn as A,ln as D,Qn as P,an as U,Fe as i};
//# sourceMappingURL=PolicyDetails.2345d5f2.js.map
