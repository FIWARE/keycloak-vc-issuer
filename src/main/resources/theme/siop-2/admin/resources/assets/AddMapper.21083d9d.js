import{u as K,r as T,h,F as L,j as e,aw as m,aA as N,ax as z,l as R,az as G,ad as _,aX as O,cx as V,aZ as $,K as X,P as Z,ao as J,q as w,b3 as Q,aD as W,cz as Y,aC as ee}from"./index.7cbfb18a.js";import{C as A,u as re,F as te}from"./index.esm.1e7ace95.js";import{u as ae}from"./ConfirmDialog.4dc691c5.js";import{D as ie}from"./DynamicComponents.7f569784.js";import{F as oe}from"./FormAccess.3a7ea209.js";import{K as E}from"./KeycloakTextInput.9afb01cd.js";import{V as se}from"./ViewHeader.083cd951.js";import{u as ne,m as de}from"./useLocaleSort.b8a659bb.js";import{u as pe}from"./useParams.3f76335e.js";import{H as F}from"./HelpItem.719382e8.js";import{a as P,A as le}from"./FormGroup.60c77f60.js";import{S as D,b as k,a as q}from"./Select.fbe867d5.js";import"./Modal.11970fe7.js";import"./ClientSelect.2d31aa2e.js";import"./FileUpload.c211f5c1.js";import"./CodeEditor.5b99e2f5.js";import"./copy-icon.dbf95270.js";import"./EmptyStateBody.1533f3a6.js";import"./EmptyStateSecondaryActions.511adeb0.js";import"./GroupPickerDialog.174f65c8.js";import"./ListEmptyState.fef0510e.js";import"./TableToolbar.51ae2a5f.js";import"./plus-circle-icon.aa8a939a.js";import"./DataListItemRow.df3ed5f3.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.7e109111.js";import"./ActionListItem.65cb5d9a.js";import"./FlexItem.ae9c1d3c.js";import"./minus-circle-icon.c093f419.js";import"./MultiLineInput.091fd21a.js";import"./PasswordInput.aa539188.js";import"./useToggle.461e82f2.js";import"./AddRoleMappingModal.c8e6830c.js";import"./KeycloakDataTable.ae870e97.js";import"./Td.1e0c90e7.js";import"./star-icon.a6efdd26.js";import"./check.51c67984.js";import"./Checkbox.7d63c785.js";import"./resource.2cd5a37e.js";import"./joinPath.69b856b1.js";import"./filter-icon.a9b0a5f3.js";import"./KeycloakTextArea.d98120cb.js";import"./GridItem.63e5e367.js";import"./Text.28ece842.js";const me=({mapperTypes:r,mapperType:c,form:x,id:g,updateMapperType:b})=>{const{t:i}=K("identity-providers"),{control:y,register:I,formState:{errors:S}}=x,[v,l]=T.exports.useState(!1),a=["inherit","import","legacy","force"],[d,o]=T.exports.useState(!1);return h(L,{children:[e(P,{label:i("common:name"),labelIcon:e(F,{helpText:"identity-providers-help:addIdpMapperName",fieldLabelId:"name"}),fieldId:"kc-name",isRequired:!0,validated:S.name?m.error:m.default,helperTextInvalid:i("common:required"),children:e(E,{id:"kc-name",isDisabled:!!g,validated:S.name?m.error:m.default,...I("name",{required:!0})})}),e(P,{label:i("syncModeOverride"),isRequired:!0,labelIcon:e(F,{helpText:"identity-providers-help:syncModeOverride",fieldLabelId:"identity-providers:syncModeOverride"}),fieldId:"syncMode",children:e(A,{name:"config.syncMode",defaultValue:a[0].toUpperCase(),control:y,render:({field:p})=>e(D,{toggleId:"syncMode","datatest-id":"syncmode-select",required:!0,direction:"down",onToggle:()=>o(!d),onSelect:(t,s)=>{p.onChange(s.toString().toUpperCase()),o(!1)},selections:i(`syncModes.${p.value.toLowerCase()}`),variant:k.single,"aria-label":i("syncMode"),isOpen:d,children:a.map(t=>e(q,{selected:t===p.value,"data-testid":t,value:t.toUpperCase(),children:i(`syncModes.${t}`)},t))})})}),e(P,{label:i("mapperType"),labelIcon:e(F,{helpText:c.helpText,fieldLabelId:"identity-providers:mapperType"}),fieldId:"identityProviderMapper",children:e(A,{name:"identityProviderMapper",defaultValue:r[0].id,control:y,render:({field:p})=>e(D,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!g,required:!0,onToggle:()=>l(!v),onSelect:(t,s)=>{const f=s;b(f),p.onChange(f.id),l(!1)},selections:c.name,variant:k.single,"aria-label":i("mapperType"),isOpen:v,children:r.map(t=>e(q,{selected:t===p.value,"datatest-id":t.id,value:t,children:t.name},t.name))})})})]})};function tr(){const{t:r}=K("identity-providers"),c=re(),{handleSubmit:x,register:g,formState:{errors:b}}=c,{addAlert:i,addError:y}=N(),I=z(),S=ne(),{realm:v}=R(),{adminClient:l}=G(),{id:a,providerId:d,alias:o}=pe(),[p,t]=T.exports.useState(),[s,f]=T.exports.useState(),j=async n=>{const C=W(n),M={...C,config:{...C.config},identityProviderAlias:o};if(a)try{await l.identityProviders.updateMapper({id:a,alias:o},{...M,name:s?.name}),i(r("mapperSaveSuccess"),O.success)}catch(u){y(r("mapperSaveError"),u)}else try{const u=await l.identityProviders.createMapper({identityProviderMapper:M,alias:o});i(r("mapperCreateSuccess"),O.success),I(Y({realm:v,alias:o,providerId:d,id:u.id}))}catch(u){y(r("mapperCreateError"),u)}},[B,U]=ae({titleKey:"identity-providers:deleteProviderMapper",messageKey:r("identity-providers:deleteMapperConfirm",{mapper:s?.name}),continueButtonLabel:"common:delete",continueButtonVariant:_.danger,onConfirm:async()=>{try{await l.identityProviders.delMapper({alias:o,id:a}),i(r("deleteMapperSuccess"),O.success),I(V({providerId:d,alias:o,tab:"mappers",realm:v}))}catch(n){y("identity-providers:deleteErrorError",n)}}});$(()=>Promise.all([a?l.identityProviders.findOneMapper({alias:o,id:a}):null,l.identityProviders.findMapperTypes({alias:o})]),([n,C])=>{const M=S(Object.values(C),de("name"));n?(f(M.find(({id:u})=>u===n.identityProviderMapper)),H(n)):f(M[0]),t(M)},[]);const H=n=>{ee(n,c.setValue)};return!p||!s?e(X,{}):h(Z,{variant:"light",children:[e(U,{}),e(se,{className:"kc-add-mapper-title",titleKey:a?r("editIdPMapper",{providerId:d[0].toUpperCase()+d.substring(1)}):r("addIdPMapper",{providerId:d[0].toUpperCase()+d.substring(1)}),dropdownItems:a?[e(J,{onClick:B,children:r("common:delete")},"delete")]:void 0,divider:!0}),h(oe,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:x(j),className:"pf-u-mt-lg",children:[a&&e(P,{label:r("common:id"),fieldId:"kc-name",validated:b.name?m.error:m.default,helperTextInvalid:r("common:required"),children:e(E,{value:s.id,id:"kc-name",isDisabled:!!a,validated:b.name?m.error:m.default,...g("name")})}),s.properties&&h(L,{children:[e(me,{form:c,id:a,mapperTypes:p,updateMapperType:f,mapperType:s}),e(te,{...c,children:e(ie,{properties:s.properties})})]}),h(le,{children:[e(w,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:r("common:save")}),e(w,{"data-testid":"new-mapper-cancel-button",variant:"link",component:n=>e(Q,{...n,to:V({realm:v,providerId:d,alias:o,tab:"mappers"})}),children:r("common:cancel")})]})]})]})}export{tr as default};
//# sourceMappingURL=AddMapper.21083d9d.js.map
