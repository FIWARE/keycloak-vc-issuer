import{u as j,ax as k,l as B,az as L,aA as N,r as y,aZ as U,ad as z,aX as l,j as t,K as G,h as C,F as H,ao as X,P as b,bF as T,bG as Z,aD as _}from"./index.7cbfb18a.js";import{c as q,C as w,A as J}from"./ClientScopeTypes.f384adfd.js";import{u as Q}from"./ConfirmDialog.4dc691c5.js";import{R as W}from"./AddRoleMappingModal.c8e6830c.js";import{R as Y,u as $}from"./RoutableTabs.58e36a71.js";import{V as ee}from"./ViewHeader.083cd951.js";import{u as te}from"./useParams.3f76335e.js";import{M as oe}from"./MapperList.69f09839.js";import{S as ae}from"./ScopeForm.b8398ae2.js";import{T as S,a as f}from"./Tabs.fae3d04f.js";import"./Select.fbe867d5.js";import"./FormGroup.60c77f60.js";import"./check.51c67984.js";import"./star-icon.a6efdd26.js";import"./Modal.11970fe7.js";import"./KeycloakDataTable.ae870e97.js";import"./ListEmptyState.fef0510e.js";import"./TableToolbar.51ae2a5f.js";import"./HelpItem.719382e8.js";import"./EmptyStateSecondaryActions.511adeb0.js";import"./EmptyStateBody.1533f3a6.js";import"./plus-circle-icon.aa8a939a.js";import"./Td.1e0c90e7.js";import"./grip-vertical-icon.7e109111.js";import"./Checkbox.7d63c785.js";import"./useLocaleSort.b8a659bb.js";import"./resource.2cd5a37e.js";import"./joinPath.69b856b1.js";import"./filter-icon.a9b0a5f3.js";import"./Text.28ece842.js";import"./DataListItemRow.df3ed5f3.js";import"./data-list.f7ff2ea7.js";import"./index.esm.1e7ace95.js";import"./utils.988d95db.js";import"./FormAccess.3a7ea209.js";import"./copy-icon.dbf95270.js";import"./GridItem.63e5e367.js";import"./KeycloakTextArea.d98120cb.js";import"./KeycloakTextInput.9afb01cd.js";import"./plus-icon.f70ae4c8.js";import"./MenuList.22670a64.js";function _e(){const{t:i}=j("client-scopes"),D=k(),{realm:m}=B(),{adminClient:r}=L(),{id:n}=te(),{addAlert:c,addError:p}=N(),[a,M]=y.exports.useState(),[g,v]=y.exports.useState(0),h=()=>v(g+1);U(async()=>{const e=await r.clientScopes.findOne({id:n});if(!e)throw new Error(i("common:notFound"));return{...e,type:await A(e)}},e=>{M(e)},[g,n]);async function A(e){return(await r.clientScopes.listDefaultClientScopes()).find(u=>u.name===e.name)?w.default:(await r.clientScopes.listDefaultOptionalClientScopes()).find(u=>u.name===e.name)?w.optional:J.none}const d=e=>$(Z({realm:m,id:n,tab:e})),x=d("settings"),R=d("mappers"),E=d("scope"),F=async e=>{const o=_({...e,name:e.name?.trim().replace(/ /g,"_")});try{await r.clientScopes.update({id:n},o),await q(r,{...o,id:n},o.type),c(i("updateSuccess"),l.success)}catch(s){p("client-scopes:updateError",s)}},[K,P]=Q({titleKey:i("deleteClientScope",{count:1,name:a?.name}),messageKey:"client-scopes:deleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{await r.clientScopes.del({id:n}),c(i("deletedSuccess"),l.success)}catch(e){p("client-scopes:deleteError",e)}}}),V=async e=>{try{const o=e.filter(s=>s.client===void 0).map(s=>s.role).flat();await r.clientScopes.addRealmScopeMappings({id:n},o),await Promise.all(e.filter(s=>s.client!==void 0).map(s=>r.clientScopes.addClientScopeMappings({id:n,client:s.client.id},[s.role]))),c(i("roleMappingUpdatedSuccess"),l.success)}catch(o){p("client-scopes:roleMappingUpdatedError",o)}},I=async e=>{if(Array.isArray(e))try{await r.clientScopes.addMultipleProtocolMappers({id:a.id},e),h(),c(i("common:mappingCreatedSuccess"),l.success)}catch(o){p("common:mappingCreatedError",o)}else{const o=e;D(T({realm:m,id:a.id,mapperId:o.id}))}},O=async e=>{try{await r.clientScopes.delProtocolMapper({id:a.id,mapperId:e.id}),c(i("common:mappingDeletedSuccess"),l.success),h()}catch(o){p("common:mappingDeletedError",o)}return!0};return a?C(H,{children:[t(P,{}),t(ee,{titleKey:a.name,dropdownItems:[t(X,{onClick:K,children:i("common:delete")},"delete")],badges:[{text:a.protocol}],divider:!1}),t(b,{variant:"light",className:"pf-u-p-0",children:C(Y,{isBox:!0,children:[t(S,{id:"settings","data-testid":"settings",title:t(f,{children:i("common:settings")}),...x,children:t(b,{variant:"light",children:t(ae,{save:F,clientScope:a})})}),t(S,{id:"mappers","data-testid":"mappers",title:t(f,{children:i("common:mappers")}),...R,children:t(oe,{model:a,onAdd:I,onDelete:O,detailLink:e=>T({realm:m,id:a.id,mapperId:e})})}),t(S,{id:"scope","data-testid":"scopeTab",title:t(f,{children:i("scope")}),...E,children:t(W,{id:a.id,name:a.name,type:"clientScopes",save:V})})]})})]}):t(G,{})}export{_e as default};
//# sourceMappingURL=EditClientScope.03ea81ec.js.map
