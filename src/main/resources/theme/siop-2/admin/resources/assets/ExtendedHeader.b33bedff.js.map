{"version":3,"file":"ExtendedHeader.b33bedff.js","sources":["../../src/user-federation/shared/ExtendedHeader.tsx"],"sourcesContent":["import { useParams } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  AlertVariant,\n  DropdownItem,\n  DropdownSeparator,\n} from \"@patternfly/react-core\";\n\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\nimport { useAdminClient } from \"../../context/auth/AdminClient\";\nimport { Header } from \"./Header\";\nimport { useFormContext, useWatch } from \"react-hook-form\";\n\ntype ExtendedHeaderProps = {\n  provider: string;\n  editMode?: string | string[];\n  save: () => void;\n  noDivider?: boolean;\n};\n\nexport const ExtendedHeader = ({\n  provider,\n  editMode,\n  save,\n  noDivider = false,\n}: ExtendedHeaderProps) => {\n  const { t } = useTranslation(\"user-federation\");\n  const { id } = useParams<{ id: string }>();\n  const { adminClient } = useAdminClient();\n  const { addAlert, addError } = useAlerts();\n\n  const { control } = useFormContext();\n  const hasImportUsers = useWatch({\n    name: \"config.importEnabled\",\n    control,\n    defaultValue: [\"true\"],\n  })[0];\n\n  const [toggleUnlinkUsersDialog, UnlinkUsersDialog] = useConfirmDialog({\n    titleKey: \"user-federation:userFedUnlinkUsersConfirmTitle\",\n    messageKey: \"user-federation:userFedUnlinkUsersConfirm\",\n    continueButtonLabel: \"user-federation:unlinkUsers\",\n    onConfirm: () => unlinkUsers(),\n  });\n\n  const [toggleRemoveUsersDialog, RemoveUsersConfirm] = useConfirmDialog({\n    titleKey: t(\"removeImportedUsers\"),\n    messageKey: t(\"removeImportedUsersMessage\"),\n    continueButtonLabel: \"common:remove\",\n    onConfirm: async () => {\n      try {\n        removeImportedUsers();\n        addAlert(t(\"removeImportedUsersSuccess\"), AlertVariant.success);\n      } catch (error) {\n        addError(\"user-federation:removeImportedUsersError\", error);\n      }\n    },\n  });\n\n  const removeImportedUsers = async () => {\n    try {\n      if (id) {\n        await adminClient.userStorageProvider.removeImportedUsers({ id });\n      }\n      addAlert(t(\"removeImportedUsersSuccess\"), AlertVariant.success);\n    } catch (error) {\n      addError(\"user-federation:removeImportedUsersError\", error);\n    }\n  };\n\n  const syncChangedUsers = async () => {\n    try {\n      if (id) {\n        const response = await adminClient.userStorageProvider.sync({\n          id: id,\n          action: \"triggerChangedUsersSync\",\n        });\n        if (response.ignored) {\n          addAlert(`${response.status}.`, AlertVariant.warning);\n        } else {\n          addAlert(\n            t(\"syncUsersSuccess\") +\n              `${response.added} users added, ${response.updated} users updated, ${response.removed} users removed, ${response.failed} users failed.`,\n            AlertVariant.success\n          );\n        }\n      }\n    } catch (error) {\n      addError(\"user-federation:syncUsersError\", error);\n    }\n  };\n\n  const syncAllUsers = async () => {\n    try {\n      if (id) {\n        const response = await adminClient.userStorageProvider.sync({\n          id: id,\n          action: \"triggerFullSync\",\n        });\n        if (response.ignored) {\n          addAlert(`${response.status}.`, AlertVariant.warning);\n        } else {\n          addAlert(\n            t(\"syncUsersSuccess\") +\n              `${response.added} users added, ${response.updated} users updated, ${response.removed} users removed, ${response.failed} users failed.`,\n            AlertVariant.success\n          );\n        }\n      }\n    } catch (error) {\n      addError(\"user-federation:syncUsersError\", error);\n    }\n  };\n\n  const unlinkUsers = async () => {\n    try {\n      if (id) {\n        await adminClient.userStorageProvider.unlinkUsers({ id });\n      }\n      addAlert(t(\"unlinkUsersSuccess\"), AlertVariant.success);\n    } catch (error) {\n      addError(\"user-federation:unlinkUsersError\", error);\n    }\n  };\n\n  return (\n    <>\n      <UnlinkUsersDialog />\n      <RemoveUsersConfirm />\n      <Header\n        provider={provider}\n        noDivider={noDivider}\n        save={save}\n        dropdownItems={[\n          <DropdownItem\n            key=\"sync\"\n            onClick={syncChangedUsers}\n            isDisabled={hasImportUsers === \"false\"}\n          >\n            {t(\"syncChangedUsers\")}\n          </DropdownItem>,\n          <DropdownItem\n            key=\"syncall\"\n            onClick={syncAllUsers}\n            isDisabled={hasImportUsers === \"false\"}\n          >\n            {t(\"syncAllUsers\")}\n          </DropdownItem>,\n          <DropdownItem\n            key=\"unlink\"\n            isDisabled={editMode ? !editMode.includes(\"UNSYNCED\") : false}\n            onClick={toggleUnlinkUsersDialog}\n          >\n            {t(\"unlinkUsers\")}\n          </DropdownItem>,\n          <DropdownItem key=\"remove\" onClick={toggleRemoveUsersDialog}>\n            {t(\"removeImported\")}\n          </DropdownItem>,\n          <DropdownSeparator key=\"separator\" />,\n        ]}\n      />\n    </>\n  );\n};\n"],"names":["ExtendedHeader","provider","editMode","save","noDivider","t","useTranslation","id","useParams","adminClient","useAdminClient","addAlert","addError","useAlerts","control","useFormContext","hasImportUsers","useWatch","name","defaultValue","toggleUnlinkUsersDialog","UnlinkUsersDialog","useConfirmDialog","titleKey","messageKey","continueButtonLabel","onConfirm","unlinkUsers","toggleRemoveUsersDialog","RemoveUsersConfirm","removeImportedUsers","AlertVariant","success","error","userStorageProvider","syncChangedUsers","response","sync","action","ignored","status","warning","added","updated","removed","failed","syncAllUsers","_Fragment","_jsx","Header","DropdownItem","includes","DropdownSeparator"],"mappings":"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"}