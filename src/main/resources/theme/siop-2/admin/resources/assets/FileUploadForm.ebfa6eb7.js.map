{"version":3,"file":"FileUploadForm.ebfa6eb7.js","sources":["../../src/components/json-file-upload/FileUploadForm.tsx"],"sourcesContent":["import {\n  ChangeEvent,\n  DragEvent as ReactDragEvent,\n  MouseEvent as ReactMouseEvent,\n  useState,\n} from \"react\";\nimport { FormGroup, Modal, ModalVariant, Button } from \"@patternfly/react-core\";\nimport { DropEvent } from \"react-dropzone\";\nimport { useTranslation } from \"react-i18next\";\nimport { CodeEditor, Language } from \"@patternfly/react-code-editor\";\n\nimport { FileUpload, FileUploadProps } from \"./patternfly/FileUpload\";\n\ntype FileUploadType = {\n  value: string;\n  filename: string;\n  isLoading: boolean;\n  modal: boolean;\n};\n\nexport type FileUploadEvent =\n  | ReactDragEvent<HTMLElement> // User dragged/dropped a file\n  | ChangeEvent<HTMLTextAreaElement> // User typed in the TextArea\n  | ReactMouseEvent<HTMLButtonElement, MouseEvent>; // User clicked Clear button\n\nexport type FileUploadFormProps = Omit<FileUploadProps, \"onChange\"> & {\n  id: string;\n  extension: string;\n  onChange: (value: string) => void;\n  helpText?: string;\n  unWrap?: boolean;\n  language?: Language;\n};\n\nexport const FileUploadForm = ({\n  id,\n  onChange,\n  helpText = \"common-help:helpFileUpload\",\n  unWrap = false,\n  language,\n  extension,\n  ...rest\n}: FileUploadFormProps) => {\n  const { t } = useTranslation();\n  const defaultUpload: FileUploadType = {\n    value: \"\",\n    filename: \"\",\n    isLoading: false,\n    modal: false,\n  };\n  const [fileUpload, setFileUpload] = useState<FileUploadType>(defaultUpload);\n  const removeDialog = () => setFileUpload({ ...fileUpload, modal: false });\n\n  const handleFileInputChange = (_event: DropEvent, file: File) => {\n    setFileUpload({ ...fileUpload, filename: file.name });\n  };\n\n  const handleTextOrDataChange = (value: string) => {\n    setFileUpload({ ...fileUpload, value });\n    onChange(value);\n  };\n\n  const handleClear = () => {\n    setFileUpload({ ...fileUpload, modal: true });\n  };\n\n  return (\n    <>\n      {fileUpload.modal && (\n        <Modal\n          variant={ModalVariant.small}\n          title={t(\"clearFile\")}\n          isOpen\n          onClose={removeDialog}\n          actions={[\n            <Button\n              key=\"confirm\"\n              variant=\"primary\"\n              data-testid=\"clear-button\"\n              onClick={() => {\n                setFileUpload(defaultUpload);\n                onChange(\"\");\n              }}\n            >\n              {t(\"clear\")}\n            </Button>,\n            <Button\n              data-testid=\"cancel\"\n              key=\"cancel\"\n              variant=\"link\"\n              onClick={removeDialog}\n            >\n              {t(\"cancel\")}\n            </Button>,\n          ]}\n        >\n          {t(\"clearFileExplain\")}\n        </Modal>\n      )}\n      {unWrap && (\n        <FileUpload\n          id={id}\n          {...rest}\n          type=\"text\"\n          value={fileUpload.value}\n          filename={fileUpload.filename}\n          onFileInputChange={handleFileInputChange}\n          onDataChange={handleTextOrDataChange}\n          onTextChange={handleTextOrDataChange}\n          onClearClick={handleClear}\n          onReadStarted={() =>\n            setFileUpload({ ...fileUpload, isLoading: true })\n          }\n          onReadFinished={() =>\n            setFileUpload({ ...fileUpload, isLoading: false })\n          }\n          isLoading={fileUpload.isLoading}\n          dropzoneProps={{\n            accept: { \"application/text\": [extension] },\n          }}\n        />\n      )}\n      {!unWrap && (\n        <FormGroup\n          label={t(\"resourceFile\")}\n          fieldId={id}\n          helperText={t(helpText)}\n        >\n          <FileUpload\n            data-testid={id}\n            id={id}\n            {...rest}\n            type=\"text\"\n            value={fileUpload.value}\n            filename={fileUpload.filename}\n            onFileInputChange={handleFileInputChange}\n            onDataChange={handleTextOrDataChange}\n            onTextChange={handleTextOrDataChange}\n            onClearClick={handleClear}\n            onReadStarted={() =>\n              setFileUpload({ ...fileUpload, isLoading: true })\n            }\n            onReadFinished={() =>\n              setFileUpload({ ...fileUpload, isLoading: false })\n            }\n            isLoading={fileUpload.isLoading}\n            hideDefaultPreview\n          >\n            {!rest.hideDefaultPreview && (\n              <CodeEditor\n                isLineNumbersVisible\n                code={fileUpload.value}\n                language={language}\n                height=\"128px\"\n                onChange={handleTextOrDataChange}\n                isReadOnly={!rest.allowEditingUploadedText}\n              />\n            )}\n          </FileUpload>\n        </FormGroup>\n      )}\n    </>\n  );\n};\n"],"names":["FileUploadForm","id","onChange","helpText","unWrap","language","extension","rest","t","useTranslation","defaultUpload","value","filename","isLoading","modal","fileUpload","setFileUpload","useState","removeDialog","handleFileInputChange","_event","file","name","handleTextOrDataChange","handleClear","_Fragment","Modal","ModalVariant","small","_jsx","Button","FileUpload","accept","FormGroup","hideDefaultPreview","CodeEditor","allowEditingUploadedText"],"mappings":"gQAkCO,MAAMA,EAAiB,CAAC,CAC7BC,GAAAA,EACAC,SAAAA,EACAC,SAAAA,EAAW,6BACXC,OAAAA,EAAS,GACTC,SAAAA,EACAC,UAAAA,KACGC,CACgB,IAAM,CACnB,KAAA,CAAEC,EAAAA,GAAMC,EAAgB,EACxBC,EAAgC,CACpCC,MAAO,GACPC,SAAU,GACVC,UAAW,GACXC,MAAO,EAAA,EAEH,CAACC,EAAYC,CAAa,EAAIC,mBAAyBP,CAAa,EACpEQ,EAAe,IAAMF,EAAc,CAAE,GAAGD,EAAYD,MAAO,EAAA,CAAO,EAElEK,EAAwB,CAACC,EAAmBC,IAAe,CACjDL,EAAA,CAAE,GAAGD,EAAYH,SAAUS,EAAKC,IAAAA,CAAM,CAAA,EAGhDC,EAA0BZ,GAAkB,CAClCK,EAAA,CAAE,GAAGD,EAAYJ,MAAAA,CAAAA,CAAO,EACtCT,EAASS,CAAK,CAAA,EAGVa,EAAc,IAAM,CACVR,EAAA,CAAE,GAAGD,EAAYD,MAAO,EAAA,CAAM,CAAA,EAG9C,SACEW,EAAA,CAAA,SAAA,CACGV,EAAWD,SACTY,EAAK,CACJ,QAASC,EAAaC,MACtB,MAAOpB,EAAE,WAAW,EACpB,OAAM,GACN,QAASU,EACT,QAAS,CACPW,EAACC,EAAM,CAEL,QAAQ,UACR,cAAY,eACZ,QAAS,IAAM,CACbd,EAAcN,CAAa,EAC3BR,EAAS,EAAE,CACb,EAAE,SAEDM,EAAE,OAAO,CAAA,EARN,SAAS,EAUfqB,EAACC,EAAM,CACL,cAAY,SAEZ,QAAQ,OACR,QAASZ,EAAa,SAErBV,EAAE,QAAQ,CAAC,EAJR,QAAQ,CAKL,EACT,SAEDA,EAAE,kBAAkB,CAAA,CAAC,EAGzBJ,GACCyB,EAACE,EAAU,CACT,GAAA9B,EAAO,GACHM,EACJ,KAAK,OACL,MAAOQ,EAAWJ,MAClB,SAAUI,EAAWH,SACrB,kBAAmBO,EACnB,aAAcI,EACd,aAAcA,EACd,aAAcC,EACd,cAAe,IACbR,EAAc,CAAE,GAAGD,EAAYF,UAAW,EAAA,CAAM,EAElD,eAAgB,IACdG,EAAc,CAAE,GAAGD,EAAYF,UAAW,EAAA,CAAO,EAEnD,UAAWE,EAAWF,UACtB,cAAe,CACbmB,OAAQ,CAAE,mBAAoB,CAAC1B,CAAS,CAAE,CAC5C,CAAE,CAAA,EAGL,CAACF,KACC6B,EAAS,CACR,MAAOzB,EAAE,cAAc,EACvB,QAASP,EACT,WAAYO,EAAEL,CAAQ,EAAE,WAEvB4B,EAAU,CACT,cAAa9B,EACb,GAAAA,EAAO,GACHM,EACJ,KAAK,OACL,MAAOQ,EAAWJ,MAClB,SAAUI,EAAWH,SACrB,kBAAmBO,EACnB,aAAcI,EACd,aAAcA,EACd,aAAcC,EACd,cAAe,IACbR,EAAc,CAAE,GAAGD,EAAYF,UAAW,EAAA,CAAM,EAElD,eAAgB,IACdG,EAAc,CAAE,GAAGD,EAAYF,UAAW,EAAA,CAAO,EAEnD,UAAWE,EAAWF,UACtB,mBAAkB,GAAA,SAEjB,CAACN,EAAK2B,sBACJC,EAAU,CACT,qBAAoB,GACpB,KAAMpB,EAAWJ,MACjB,SAAAN,EACA,OAAO,QACP,SAAUkB,EACV,WAAY,CAAChB,EAAK6B,wBAAAA,CAAyB,CAAA,CAE9C,CAAA,CAGN,CAAA,CAAA,CACA,CAEP"}