{"version":3,"file":"PermissionTab.8539997c.js","sources":["../../src/components/permission-tab/PermissionTab.tsx"],"sourcesContent":["import { useState } from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { Trans, useTranslation } from \"react-i18next\";\nimport {\n  Card,\n  CardBody,\n  CardTitle,\n  Form,\n  FormGroup,\n  PageSection,\n  Switch,\n} from \"@patternfly/react-core\";\nimport {\n  ActionsColumn,\n  TableComposable,\n  Tbody,\n  Td,\n  Th,\n  Thead,\n  Tr,\n} from \"@patternfly/react-table\";\n\nimport type { ManagementPermissionReference } from \"@keycloak/keycloak-admin-client/lib/defs/managementPermissionReference\";\nimport { useAdminClient, useFetch } from \"../../context/auth/AdminClient\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport { toPermissionDetails } from \"../../clients/routes/PermissionDetails\";\nimport { KeycloakSpinner } from \"../../components/keycloak-spinner/KeycloakSpinner\";\nimport { HelpItem } from \"../../components/help-enabler/HelpItem\";\nimport useLocaleSort from \"../../utils/useLocaleSort\";\nimport { useConfirmDialog } from \"../confirm-dialog/ConfirmDialog\";\n\nimport \"./permissions-tab.css\";\n\ntype PermissionScreenType =\n  | \"clients\"\n  | \"users\"\n  | \"groups\"\n  | \"roles\"\n  | \"identityProviders\";\n\ntype PermissionsTabProps = {\n  id?: string;\n  type: PermissionScreenType;\n};\n\nexport const PermissionsTab = ({ id, type }: PermissionsTabProps) => {\n  const { t } = useTranslation(\"common\");\n  const navigate = useNavigate();\n  const { adminClient } = useAdminClient();\n  const { realm } = useRealm();\n  const [realmId, setRealmId] = useState(\"\");\n  const [permission, setPermission] = useState<ManagementPermissionReference>();\n  const localeSort = useLocaleSort();\n\n  const togglePermissionEnabled = (enabled: boolean) => {\n    switch (type) {\n      case \"clients\":\n        return adminClient.clients.updateFineGrainPermission(\n          { id: id! },\n          { enabled }\n        );\n      case \"users\":\n        return adminClient.realms.updateUsersManagementPermissions({\n          realm,\n          enabled,\n        });\n      case \"groups\":\n        return adminClient.groups.updatePermission({ id: id! }, { enabled });\n      case \"roles\":\n        return adminClient.roles.updatePermission({ id: id! }, { enabled });\n      case \"identityProviders\":\n        return adminClient.identityProviders.updatePermission(\n          { alias: id! },\n          { enabled }\n        );\n    }\n  };\n\n  useFetch(\n    () =>\n      Promise.all([\n        adminClient.clients.find({\n          search: true,\n          clientId: realm === \"master\" ? \"master-realm\" : \"realm-management\",\n        }),\n        (() => {\n          switch (type) {\n            case \"clients\":\n              return adminClient.clients.listFineGrainPermissions({ id: id! });\n            case \"users\":\n              return adminClient.realms.getUsersManagementPermissions({\n                realm,\n              });\n            case \"groups\":\n              return adminClient.groups.listPermissions({ id: id! });\n            case \"roles\":\n              return adminClient.roles.listPermissions({ id: id! });\n            case \"identityProviders\":\n              return adminClient.identityProviders.listPermissions({\n                alias: id!,\n              });\n          }\n        })(),\n      ]),\n    ([clients, permission]) => {\n      setRealmId(clients[0]?.id!);\n      setPermission(permission);\n    },\n    []\n  );\n\n  const [toggleDisableDialog, DisableConfirm] = useConfirmDialog({\n    titleKey: \"common:permissionsDisable\",\n    messageKey: \"common:permissionsDisableConfirm\",\n    continueButtonLabel: \"common:confirm\",\n    onConfirm: async () => {\n      const permission = await togglePermissionEnabled(false);\n      setPermission(permission);\n    },\n  });\n\n  if (!permission) {\n    return <KeycloakSpinner />;\n  }\n\n  return (\n    <PageSection variant=\"light\">\n      <DisableConfirm />\n      <Card isFlat>\n        <CardTitle>{t(\"permissions\")}</CardTitle>\n        <CardBody>\n          {t(`${type}PermissionsHint`)}\n          <Form isHorizontal className=\"pf-u-pt-md\">\n            <FormGroup\n              hasNoPaddingTop\n              className=\"permission-label\"\n              label={t(\"permissionsEnabled\")}\n              fieldId=\"permissionsEnabled\"\n              labelIcon={\n                <HelpItem\n                  helpText=\"clients-help:permissionsEnabled\"\n                  fieldLabelId=\"clients:permissionsEnabled\"\n                />\n              }\n            >\n              <Switch\n                id=\"permissionsEnabled\"\n                data-testid=\"permissionSwitch\"\n                label={t(\"common:on\")}\n                labelOff={t(\"common:off\")}\n                isChecked={permission.enabled}\n                onChange={async (enabled) => {\n                  if (enabled) {\n                    const permission = await togglePermissionEnabled(enabled);\n                    setPermission(permission);\n                  } else {\n                    toggleDisableDialog();\n                  }\n                }}\n                aria-label={t(\"permissionsEnabled\")}\n              />\n            </FormGroup>\n          </Form>\n        </CardBody>\n      </Card>\n      {permission.enabled && (\n        <>\n          <Card isFlat className=\"pf-u-mt-lg\">\n            <CardTitle>{t(\"permissionsList\")}</CardTitle>\n            <CardBody>\n              <Trans i18nKey=\"common:permissionsListIntro\">\n                {\" \"}\n                <strong>\n                  {{\n                    realm:\n                      realm === \"master\" ? \"master-realm\" : \"realm-management\",\n                  }}\n                </strong>\n                .\n              </Trans>\n            </CardBody>\n          </Card>\n          <Card isFlat className=\"keycloak__permission__permission-table\">\n            <CardBody className=\"pf-u-p-0\">\n              <TableComposable\n                aria-label={t(\"permissionsList\")}\n                variant=\"compact\"\n              >\n                <Thead>\n                  <Tr>\n                    <Th id=\"permissionsScopeName\">\n                      {t(\"permissionsScopeName\")}\n                    </Th>\n                    <Th id=\"description\">{t(\"description\")}</Th>\n                  </Tr>\n                </Thead>\n                <Tbody>\n                  {localeSort(\n                    Object.entries(permission.scopePermissions || {}),\n                    ([name]) => name\n                  ).map(([name, id]) => (\n                    <Tr key={id}>\n                      <Td>\n                        <Link\n                          to={toPermissionDetails({\n                            realm,\n                            id: realmId,\n                            permissionType: \"scope\",\n                            permissionId: id,\n                          })}\n                        >\n                          {name}\n                        </Link>\n                      </Td>\n                      <Td>\n                        {t(`scopePermissions.${type}.${name}-description`)}\n                      </Td>\n                      <Td isActionCell>\n                        <ActionsColumn\n                          items={[\n                            {\n                              title: t(\"common:edit\"),\n                              onClick() {\n                                navigate(\n                                  toPermissionDetails({\n                                    realm,\n                                    id: realmId,\n                                    permissionType: \"scope\",\n                                    permissionId: id,\n                                  })\n                                );\n                              },\n                            },\n                          ]}\n                        />\n                      </Td>\n                    </Tr>\n                  ))}\n                </Tbody>\n              </TableComposable>\n            </CardBody>\n          </Card>\n        </>\n      )}\n    </PageSection>\n  );\n};\n"],"names":["PermissionsTab","id","type","t","useTranslation","navigate","useNavigate","adminClient","useAdminClient","realm","useRealm","realmId","setRealmId","useState","permission","setPermission","localeSort","useLocaleSort","togglePermissionEnabled","enabled","clients","updateFineGrainPermission","realms","updateUsersManagementPermissions","groups","updatePermission","roles","identityProviders","alias","useFetch","Promise","all","find","search","clientId","listFineGrainPermissions","getUsersManagementPermissions","listPermissions","toggleDisableDialog","DisableConfirm","useConfirmDialog","titleKey","messageKey","continueButtonLabel","onConfirm","PageSection","_jsx","Card","CardTitle","_jsxs","CardBody","Form","FormGroup","HelpItem","Switch","_Fragment","Trans","TableComposable","Thead","Tr","Th","Tbody","Object","entries","scopePermissions","name","map","Td","Link","toPermissionDetails","permissionType","permissionId","ActionsColumn","title","onClick","KeycloakSpinner"],"mappings":"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"}