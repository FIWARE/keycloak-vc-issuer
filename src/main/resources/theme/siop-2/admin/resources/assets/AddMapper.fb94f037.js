import{u as K,r as T,h,F as L,j as e,aw as m,aA as N,ax as z,l as R,az as G,ad as _,aX as O,cx as V,aZ as $,K as X,P as Z,ao as J,q as w,b3 as Q,aD as W,cz as Y,aC as ee}from"./index.2ecf13ca.js";import{C as A,u as re,F as te}from"./index.esm.68aaf060.js";import{u as ae}from"./ConfirmDialog.b43fd344.js";import{D as ie}from"./DynamicComponents.16b222ec.js";import{F as oe}from"./FormAccess.7ed5d8eb.js";import{K as E}from"./KeycloakTextInput.97e36976.js";import{V as se}from"./ViewHeader.67577dd4.js";import{u as ne,m as de}from"./useLocaleSort.377bcdf5.js";import{u as pe}from"./useParams.921239aa.js";import{H as F}from"./HelpItem.49be9c4e.js";import{a as P,A as le}from"./FormGroup.24d2e56a.js";import{S as D,b as k,a as q}from"./Select.5d6f6214.js";import"./Modal.2c72168d.js";import"./ClientSelect.95a4ec0e.js";import"./FileUpload.005327fa.js";import"./CodeEditor.0b7c4c70.js";import"./copy-icon.06155c15.js";import"./EmptyStateBody.25bf6e38.js";import"./EmptyStateSecondaryActions.3ed74a6a.js";import"./GroupPickerDialog.38947607.js";import"./ListEmptyState.94d606ed.js";import"./TableToolbar.f167c244.js";import"./plus-circle-icon.f1969120.js";import"./DataListItemRow.7402b99a.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.6efe1939.js";import"./ActionListItem.c90af00f.js";import"./FlexItem.2ee8dfc9.js";import"./minus-circle-icon.e9e185f2.js";import"./MultiLineInput.7867bd1a.js";import"./PasswordInput.4caf2dff.js";import"./useToggle.97c716af.js";import"./AddRoleMappingModal.c7175fba.js";import"./KeycloakDataTable.5c9a6c7c.js";import"./Td.ff2a9f66.js";import"./star-icon.648ddb2a.js";import"./check.51c67984.js";import"./Checkbox.56efba4a.js";import"./resource.09062762.js";import"./joinPath.69b856b1.js";import"./filter-icon.f568e30b.js";import"./KeycloakTextArea.2947a089.js";import"./GridItem.a22d8cac.js";import"./Text.441b2f8e.js";const me=({mapperTypes:r,mapperType:c,form:x,id:g,updateMapperType:b})=>{const{t:i}=K("identity-providers"),{control:y,register:I,formState:{errors:S}}=x,[v,l]=T.exports.useState(!1),a=["inherit","import","legacy","force"],[d,o]=T.exports.useState(!1);return h(L,{children:[e(P,{label:i("common:name"),labelIcon:e(F,{helpText:"identity-providers-help:addIdpMapperName",fieldLabelId:"name"}),fieldId:"kc-name",isRequired:!0,validated:S.name?m.error:m.default,helperTextInvalid:i("common:required"),children:e(E,{id:"kc-name",isDisabled:!!g,validated:S.name?m.error:m.default,...I("name",{required:!0})})}),e(P,{label:i("syncModeOverride"),isRequired:!0,labelIcon:e(F,{helpText:"identity-providers-help:syncModeOverride",fieldLabelId:"identity-providers:syncModeOverride"}),fieldId:"syncMode",children:e(A,{name:"config.syncMode",defaultValue:a[0].toUpperCase(),control:y,render:({field:p})=>e(D,{toggleId:"syncMode","datatest-id":"syncmode-select",required:!0,direction:"down",onToggle:()=>o(!d),onSelect:(t,s)=>{p.onChange(s.toString().toUpperCase()),o(!1)},selections:i(`syncModes.${p.value.toLowerCase()}`),variant:k.single,"aria-label":i("syncMode"),isOpen:d,children:a.map(t=>e(q,{selected:t===p.value,"data-testid":t,value:t.toUpperCase(),children:i(`syncModes.${t}`)},t))})})}),e(P,{label:i("mapperType"),labelIcon:e(F,{helpText:c.helpText,fieldLabelId:"identity-providers:mapperType"}),fieldId:"identityProviderMapper",children:e(A,{name:"identityProviderMapper",defaultValue:r[0].id,control:y,render:({field:p})=>e(D,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!g,required:!0,onToggle:()=>l(!v),onSelect:(t,s)=>{const f=s;b(f),p.onChange(f.id),l(!1)},selections:c.name,variant:k.single,"aria-label":i("mapperType"),isOpen:v,children:r.map(t=>e(q,{selected:t===p.value,"datatest-id":t.id,value:t,children:t.name},t.name))})})})]})};function tr(){const{t:r}=K("identity-providers"),c=re(),{handleSubmit:x,register:g,formState:{errors:b}}=c,{addAlert:i,addError:y}=N(),I=z(),S=ne(),{realm:v}=R(),{adminClient:l}=G(),{id:a,providerId:d,alias:o}=pe(),[p,t]=T.exports.useState(),[s,f]=T.exports.useState(),j=async n=>{const C=W(n),M={...C,config:{...C.config},identityProviderAlias:o};if(a)try{await l.identityProviders.updateMapper({id:a,alias:o},{...M,name:s?.name}),i(r("mapperSaveSuccess"),O.success)}catch(u){y(r("mapperSaveError"),u)}else try{const u=await l.identityProviders.createMapper({identityProviderMapper:M,alias:o});i(r("mapperCreateSuccess"),O.success),I(Y({realm:v,alias:o,providerId:d,id:u.id}))}catch(u){y(r("mapperCreateError"),u)}},[B,U]=ae({titleKey:"identity-providers:deleteProviderMapper",messageKey:r("identity-providers:deleteMapperConfirm",{mapper:s?.name}),continueButtonLabel:"common:delete",continueButtonVariant:_.danger,onConfirm:async()=>{try{await l.identityProviders.delMapper({alias:o,id:a}),i(r("deleteMapperSuccess"),O.success),I(V({providerId:d,alias:o,tab:"mappers",realm:v}))}catch(n){y("identity-providers:deleteErrorError",n)}}});$(()=>Promise.all([a?l.identityProviders.findOneMapper({alias:o,id:a}):null,l.identityProviders.findMapperTypes({alias:o})]),([n,C])=>{const M=S(Object.values(C),de("name"));n?(f(M.find(({id:u})=>u===n.identityProviderMapper)),H(n)):f(M[0]),t(M)},[]);const H=n=>{ee(n,c.setValue)};return!p||!s?e(X,{}):h(Z,{variant:"light",children:[e(U,{}),e(se,{className:"kc-add-mapper-title",titleKey:a?r("editIdPMapper",{providerId:d[0].toUpperCase()+d.substring(1)}):r("addIdPMapper",{providerId:d[0].toUpperCase()+d.substring(1)}),dropdownItems:a?[e(J,{onClick:B,children:r("common:delete")},"delete")]:void 0,divider:!0}),h(oe,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:x(j),className:"pf-u-mt-lg",children:[a&&e(P,{label:r("common:id"),fieldId:"kc-name",validated:b.name?m.error:m.default,helperTextInvalid:r("common:required"),children:e(E,{value:s.id,id:"kc-name",isDisabled:!!a,validated:b.name?m.error:m.default,...g("name")})}),s.properties&&h(L,{children:[e(me,{form:c,id:a,mapperTypes:p,updateMapperType:f,mapperType:s}),e(te,{...c,children:e(ie,{properties:s.properties})})]}),h(le,{children:[e(w,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:r("common:save")}),e(w,{"data-testid":"new-mapper-cancel-button",variant:"link",component:n=>e(Q,{...n,to:V({realm:v,providerId:d,alias:o,tab:"mappers"})}),children:r("common:cancel")})]})]})]})}export{tr as default};
//# sourceMappingURL=AddMapper.fb94f037.js.map
