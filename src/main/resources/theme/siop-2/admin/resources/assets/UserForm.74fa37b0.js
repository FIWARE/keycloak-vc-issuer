import{aE as K,l as z,az as W,r as u,aZ as X,j as a,q as L,b3 as pe,d4 as fe,u as w,h as k,ax as he,aA as ge,F as _,cE as ve,aB as Z,af as ke,aX as $}from"./index.2ecf13ca.js";import{a as G,C}from"./index.esm.68aaf060.js";import{F as Ie}from"./FormAccess.7ed5d8eb.js";import{G as be}from"./GroupPickerDialog.38947607.js";import{H as x}from"./HelpItem.49be9c4e.js";import{K as p}from"./KeycloakTextInput.97e36976.js";import{u as ye}from"./useFormatDate.742c67f0.js";import{u as Ae,F as xe}from"./useIsFeatureEnabled.d8b1daf2.js";import{S as Se}from"./ScrollForm.6573b3d3.js";import{u as Te}from"./UserProfileContext.1a5ea02c.js";import{u as qe}from"./useToggle.97c716af.js";import{F as Fe,a as d,A as Le}from"./FormGroup.24d2e56a.js";import{T as Ce}from"./Text.441b2f8e.js";import{S as J,a as N,C as we,c as Ue}from"./Select.5d6f6214.js";const Oe=({user:e})=>{const t=K(),{realm:n}=z(),{adminClient:o}=W(),[l,r]=u.exports.useState();return X(()=>t.hasAccess("view-realm")?o.components.findOne({id:e.federationLink||e.origin}):o.userStorageProvider.name({id:e.federationLink||e.origin}),r,[]),l?a(L,{variant:"link",isDisabled:!t.hasAccess("view-realm"),component:f=>a(pe,{...f,to:fe({id:l.id,realm:n})}),children:l.name}):null},De=["username","firstName","lastName","email"],R=["admin","user"];function Ze(e){return!!e.responseData.errors}function Je(e){return e.responseData.errors?.map(t=>t.errorMessage).join(`
`)||""}const Ee=({roles:e=["admin"]})=>{const{t}=w("realm-settings"),{config:n}=Te();return a(Se,{sections:[{name:""},...n?.groups||[]].map(o=>({title:o.name||t("general"),panel:k(Fe,{children:[o.displayDescription&&a(Ce,{className:"pf-u-pb-lg",children:o.displayDescription}),n?.attributes?.map(l=>a(u.exports.Fragment,{children:(l.group||"")===o.name&&(l.permissions?.view||R).some(r=>e.includes(r))&&a(Ne,{attribute:l,roles:e})},l.name))]})}))})},Ne=({attribute:e,roles:t})=>{const{t:n}=w("users"),{formState:{errors:o},register:l,control:r}=G(),[f,S]=qe(),U=i=>i?.includes("${"),T=i=>i.substring(2,i.length-1),q=i=>Object.hasOwn(i.validations||{},"options"),O=i=>i&&De.includes(i),h=i=>Object.keys(i||{}).length!==0,I=i=>`${O(i.name)?"":"attributes."}${i.name}`;return a(d,{label:(U(e.displayName)?n(T(e.displayName)):e.displayName)||e.name,fieldId:e.name,isRequired:h(e.required),validated:o.username?"error":"default",helperTextInvalid:n("common:required"),children:q(e)?a(C,{name:I(e),defaultValue:"",control:r,render:({field:i})=>a(J,{toggleId:e.name,onToggle:S,onSelect:(c,D)=>{i.onChange(D.toString()),S()},selections:i.value,variant:"single","aria-label":n("common:selectOne"),isOpen:f,isDisabled:!(e.permissions?.edit||R).some(c=>t.includes(c)),children:[a(N,{value:"",children:n("common:choose")},"empty"),...(e.validations?.options).options.map(c=>a(N,{selected:i.value===c,value:c,children:c},c))]})}):a(p,{id:e.name,isDisabled:!(e.permissions?.edit||R).some(i=>t.includes(i)),...l(I(e))})},e.name)},H=()=>{const{t:e}=w("users"),{control:t}=G();return a(d,{label:e("emailVerified"),fieldId:"kc-email-verified",helperTextInvalid:e("common:required"),labelIcon:a(x,{helpText:"users-help:emailVerified",fieldLabelId:"users:emailVerified"}),children:a(C,{name:"emailVerified",defaultValue:!1,control:t,render:({field:n})=>a(Z,{"data-testid":"email-verified-switch",id:"kc-user-email-verified",onChange:o=>n.onChange(o),isChecked:n.value,label:e("common:yes"),labelOff:e("common:no")})})})},Qe=({user:e,bruteForce:{isBruteForceProtected:t,isLocked:n}={isBruteForceProtected:!1,isLocked:!1},save:o,onGroupsUpdate:l})=>{const{t:r}=w("users"),{realm:f}=z(),S=ye(),U=Ae(),[T,q]=u.exports.useState(!1),O=he(),{adminClient:h}=W(),{addAlert:I,addError:i}=ge(),{hasAccess:c}=K(),D=c("manage-users"),{handleSubmit:Q,register:F,watch:Y,control:P,reset:ee,formState:{errors:g}}=G(),ae=Y("username"),[v,j]=u.exports.useState([]),[V,E]=u.exports.useState(!1),[M,re]=u.exports.useState(n),[b,se]=u.exports.useState(),[ie,ne]=u.exports.useState([]);X(()=>Promise.all([h.realms.findOne({realm:f}),h.authenticationManagement.getRequiredActions()]),([s,m])=>{if(!s)throw new Error(r("common:notFound"));se(s),ne(m)},[]);const te=async()=>{try{await h.attackDetection.del({id:e.id}),I(r("unlockSuccess"),$.success)}catch(s){i("users:unlockError",s)}},oe=()=>{q(!1)},le=s=>{j(v.filter(m=>m.name!==s)),l?.(v)},de=async s=>{j([...v,...s]),l?.([...v,...s])},ce=async s=>{s.forEach(async y=>{try{await h.users.addToGroup({id:e.id,groupId:y.id}),I(r("users:addedGroupMembership"),$.success)}catch(A){i("users:addedGroupMembershipError",A)}})},me=()=>{E(!V)},B=U(xe.DeclarativeUserProfile)&&b?.attributes?.userProfileEnabled==="true";return k(Ie,{isHorizontal:!0,onSubmit:Q(o),role:"query-users",fineGrainedAccess:e?.access?.manage,className:"pf-u-mt-lg",children:[V&&a(be,{type:"selectMany",text:{title:"users:selectGroups",ok:"users:join"},canBrowse:D,onConfirm:s=>{e?.id?ce(s||[]):de(s||[]),E(!1)},onClose:()=>E(!1),filterGroups:v}),B&&a(H,{}),e?.id&&k(_,{children:[a(d,{label:r("common:id"),fieldId:"kc-id",isRequired:!0,children:a(p,{id:e.id,"aria-label":r("userID"),value:e.id,type:"text",isReadOnly:!0})}),a(d,{label:r("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:a(p,{value:S(new Date(e.createdTimestamp)),type:"text",id:"kc-created-at","aria-label":r("createdAt"),name:"createdTimestamp",isReadOnly:!0})})]}),a(d,{label:r("requiredUserActions"),fieldId:"kc-required-user-actions",validated:g.requiredActions?"error":"default",helperTextInvalid:r("common:required"),labelIcon:a(x,{helpText:"users-help:requiredUserActions",fieldLabelId:"users:requiredUserActions"}),children:a(C,{name:"requiredActions",defaultValue:[],control:P,render:({field:s})=>a(J,{"data-testid":"required-actions-select",placeholderText:"Select action",toggleId:"kc-required-user-actions",onToggle:()=>q(!T),isOpen:T,selections:s.value,onSelect:(m,y)=>{const A=y;s.value.includes(A)?s.onChange(s.value.filter(ue=>ue!==A)):s.onChange([...s.value,A])},onClear:oe,variant:"typeaheadmulti",children:ie.map(({alias:m,name:y})=>a(N,{value:m,children:y},m))})})}),(e?.federationLink||e?.origin)&&a(d,{label:r("federationLink"),labelIcon:a(x,{helpText:"users-help:federationLink",fieldLabelId:"users:federationLink"}),children:a(Oe,{user:e})}),B?a(Ee,{}):k(_,{children:[!b?.registrationEmailAsUsername&&a(d,{label:r("username"),fieldId:"kc-username",isRequired:!0,validated:g.username?"error":"default",helperTextInvalid:r("common:required"),children:a(p,{id:"kc-username",isReadOnly:!!e?.id&&!b?.editUsernameAllowed&&b?.editUsernameAllowed!==void 0,...F("username")})}),a(d,{label:r("email"),fieldId:"kc-description",validated:g.email?"error":"default",helperTextInvalid:r("users:emailInvalid"),children:a(p,{type:"email",id:"kc-email","data-testid":"email-input",...F("email",{pattern:ve})})}),a(H,{}),a(d,{label:r("firstName"),fieldId:"kc-firstname",validated:g.firstName?"error":"default",helperTextInvalid:r("common:required"),children:a(p,{"data-testid":"firstName-input",id:"kc-firstname",...F("firstName")})}),a(d,{label:r("lastName"),fieldId:"kc-name",validated:g.lastName?"error":"default",children:a(p,{"data-testid":"lastName-input",id:"kc-lastname",...F("lastName")})})]}),t&&a(d,{label:r("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:a(x,{helpText:"users-help:temporaryLocked",fieldLabelId:"users:temporaryLocked"}),children:a(Z,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:s=>{te(),re(s)},isChecked:M,isDisabled:!M,label:r("common:on"),labelOff:r("common:off")})}),!e?.id&&a(d,{label:r("common:groups"),fieldId:"kc-groups",validated:g.requiredActions?"error":"default",helperTextInvalid:r("common:required"),labelIcon:a(x,{helpText:"users-help:groups",fieldLabelId:"groups"}),children:a(C,{name:"groups",defaultValue:[],control:P,render:()=>k(ke,{children:[a(we,{categoryName:" ",children:v.map(s=>a(Ue,{onClick:()=>le(s.name),children:s.path},s.id))}),a(L,{id:"kc-join-groups-button",onClick:me,variant:"secondary","data-testid":"join-groups-button",children:r("users:joinGroups")})]})})}),k(Le,{children:[a(L,{"data-testid":e?.id?"save-user":"create-user",isDisabled:!e?.id&&!ae&&!b?.registrationEmailAsUsername,variant:"primary",type:"submit",children:e?.id?r("common:save"):r("common:create")}),a(L,{"data-testid":"cancel-create-user",onClick:()=>e?.id?ee(e):O(`/${f}/users`),variant:"link",children:e?.id?r("common:revert"):r("common:cancel")})]})]})};export{Oe as F,Qe as U,Ze as i,Je as u};
//# sourceMappingURL=UserForm.74fa37b0.js.map
