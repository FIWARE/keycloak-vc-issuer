import{_ as oe,h as k,F as R,j as e,G as Re,p as A,a4 as Ke,r as N,ah as pe,Q as Oe,a5 as Be,z as he,M as ge,u as O,az as F,aA as q,q as W,ad as ye,aw as se,aX as Z,ct as z,aE as ae,am as ie,al as ce,ao as $,l as ee,ax as we,V as te,cr as Ce,b3 as Y,bE as J,cu as Le,c2 as Fe,P as Ne,cv as Se,ck as Ue,ch as $e,aZ as Ge,af as je,K as qe,a3 as ze,ap as He,an as We,bA as Ze,bB as fe,g as Qe,bu as Xe,bv as Je,bw as Ye,b1 as Pe,bx as et}from"./index.7cbfb18a.js";import{V as tt}from"./ViewHeader.083cd951.js";import{b as ke}from"./resource.2cd5a37e.js";import{K as le,o as st}from"./KeycloakDataTable.ae870e97.js";import{L as de,P as at}from"./ListEmptyState.fef0510e.js";import{u as xe}from"./index.esm.1e7ace95.js";import{K as nt}from"./KeycloakTextInput.9afb01cd.js";import{M as Ie,a as Te}from"./Modal.11970fe7.js";import{F as rt,a as ot}from"./FormGroup.60c77f60.js";import{u as U}from"./useToggle.461e82f2.js";import{C as it}from"./ConfirmDialog.4dc691c5.js";import{c as H}from"./HelpItem.719382e8.js";import{G as ct,a as lt}from"./GroupPickerDialog.174f65c8.js";import{S as dt}from"./TableToolbar.51ae2a5f.js";import{C as _e}from"./Checkbox.7d63c785.js";import{A as ut}from"./AttributeForm.fbcfddd0.js";import{R as mt}from"./AddRoleMappingModal.c8e6830c.js";import{P as pt}from"./PermissionTab.418d47cd.js";import{j as ht}from"./joinPath.69b856b1.js";import{ak as be}from"./Td.1e0c90e7.js";import{D as gt}from"./DrawerHead.cf8f1647.js";import{b as ft,T as Q,a as X}from"./Tabs.fae3d04f.js";import"./Text.28ece842.js";import"./EmptyStateBody.1533f3a6.js";import"./EmptyStateSecondaryActions.511adeb0.js";import"./plus-circle-icon.aa8a939a.js";import"./DataListItemRow.df3ed5f3.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.7e109111.js";import"./check.51c67984.js";import"./FormAccess.3a7ea209.js";import"./copy-icon.dbf95270.js";import"./GridItem.63e5e367.js";import"./KeyValueInput.21e1d12c.js";import"./FlexItem.ae9c1d3c.js";import"./minus-circle-icon.c093f419.js";import"./ActionListItem.65cb5d9a.js";import"./useLocaleSort.b8a659bb.js";import"./filter-icon.a9b0a5f3.js";import"./Trans.a8d0351e.js";import"./Card.37028a42.js";import"./CardTitle.d8222cf8.js";import"./CardBody.4fff68f7.js";import"./star-icon.a6efdd26.js";import"./plus-icon.f70ae4c8.js";import"./MenuList.22670a64.js";const Ee=s=>{var{isNested:t=!1,toolbar:i,children:o}=s,r=oe(s,["isNested","toolbar","children"]);return k(R,{children:[i&&k(R,{children:[i,e(Re,{})]}),e("ul",{...Object.assign({className:A("pf-c-tree-view__list"),role:t?"group":"tree"},r),children:o})]})};Ee.displayName="TreeViewList";const G={badge:"pf-c-badge",modifiers:{compact:"pf-m-compact",guides:"pf-m-guides",expanded:"pf-m-expanded",noBackground:"pf-m-no-background",current:"pf-m-current",read:"pf-m-read",selectable:"pf-m-selectable",truncate:"pf-m-truncate"},themeDark:"pf-theme-dark",treeView:"pf-c-tree-view",treeViewAction:"pf-c-tree-view__action",treeViewContent:"pf-c-tree-view__content",treeViewListItem:"pf-c-tree-view__list-item",treeViewNode:"pf-c-tree-view__node",treeViewNodeCheck:"pf-c-tree-view__node-check",treeViewNodeContainer:"pf-c-tree-view__node-container",treeViewNodeContent:"pf-c-tree-view__node-content",treeViewNodeCount:"pf-c-tree-view__node-count",treeViewNodeIcon:"pf-c-tree-view__node-icon",treeViewNodeText:"pf-c-tree-view__node-text",treeViewNodeTitle:"pf-c-tree-view__node-title",treeViewNodeToggle:"pf-c-tree-view__node-toggle",treeViewNodeToggleIcon:"pf-c-tree-view__node-toggle-icon",treeViewSearch:"pf-c-tree-view__search"},bt=({name:s,title:t,id:i,isExpanded:o,defaultExpanded:r=!1,children:c=null,onSelect:d,onCheck:a,hasCheck:l=!1,checkProps:n={checked:!1},hasBadge:p=!1,customBadgeContent:v,badgeProps:u={isRead:!0},isSelectable:m=!1,isCompact:h,activeItems:S=[],itemData:V,parentItem:M,icon:E,expandedIcon:x,action:b,compareItems:T,useMemo:g})=>{const[f,w]=N.exports.useState(r);N.exports.useEffect(()=>{o!=null?w(o):r!=null&&w(f||r)},[o,r]);let B="button";l?B="label":m&&(B="div");const y=l||m?"button":"span",_=K=>e(y,{...Object.assign({className:A(G.treeViewNodeToggle),onClick:I=>{(m||l)&&w(!f),m&&I.stopPropagation()}},(l||m)&&{"aria-labelledby":`label-${K}`},{tabIndex:-1}),children:e("span",{className:A(G.treeViewNodeToggleIcon),children:e(Be,{"aria-hidden":"true"})})}),D=K=>e("span",{className:A(G.treeViewNodeCheck),children:e("input",{...Object.assign({type:"checkbox",onChange:I=>a&&a(I,V,M),onClick:I=>I.stopPropagation(),ref:I=>I&&(I.indeterminate=n.checked===null)},n,{checked:n.checked===null?!1:n.checked,id:K,tabIndex:-1})})}),j=k("span",{className:A(G.treeViewNodeIcon),children:[!f&&E,f&&(x||E)]}),C=()=>{const K=k(R,{children:[h&&t&&e("span",{className:A(G.treeViewNodeTitle),children:t}),m?e("button",{tabIndex:-1,className:A(G.treeViewNodeText),children:s}):e("span",{className:A(G.treeViewNodeText),children:s})]});return h?e("span",{className:A(G.treeViewNodeContent),children:K}):K},L=k(R,{children:[p&&c&&e("span",{className:A(G.treeViewNodeCount),children:e(pe,{...Object.assign({},u),children:v||c.props.data.length})}),p&&!c&&v!==void 0&&e("span",{className:A(G.treeViewNodeCount),children:e(pe,{...Object.assign({},u),children:v})})]});return k("li",{...Object.assign({id:i,className:A(G.treeViewListItem,f&&G.modifiers.expanded)},f&&{"aria-expanded":"true"},{role:"treeitem",tabIndex:-1}),children:[k("div",{className:A(G.treeViewContent),children:[e(Oe,{prefix:m?"selectable-id":"checkbox-id",children:K=>e(B,{...Object.assign({className:A(G.treeViewNode,c&&(m||l)&&G.modifiers.selectable,(!c||m)&&S&&S.length>0&&S.some(I=>T&&I&&T(I,V))?G.modifiers.current:""),onClick:I=>{l||(d&&d(I,V,M),!m&&c&&I.isDefaultPrevented()!==!0&&w(!f))}},l&&{htmlFor:K},(l||m&&c)&&{id:`label-${K}`}),children:k("span",{className:A(G.treeViewNodeContainer),children:[c&&_(K),l&&D(K),E&&j,C(),L]})})}),b&&e("div",{className:A(G.treeViewAction),children:b})]}),f&&c]})},Ae=Ke.memo(bt,(s,t)=>{if(!t.useMemo)return!1;const i=s.activeItems&&s.activeItems.length>0&&s.activeItems.some(r=>s.compareItems&&r&&s.compareItems(r,s.itemData)),o=t.activeItems&&t.activeItems.length>0&&t.activeItems.some(r=>t.compareItems&&r&&t.compareItems(r,t.itemData));return!(i||o||s.name!==t.name||s.title!==t.title||s.id!==t.id||s.isExpanded!==t.isExpanded||s.defaultExpanded!==t.defaultExpanded||s.onSelect!==t.onSelect||s.onCheck!==t.onCheck||s.hasCheck!==t.hasCheck||s.checkProps!==t.checkProps||s.hasBadge!==t.hasBadge||s.customBadgeContent!==t.customBadgeContent||s.badgeProps!==t.badgeProps||s.isCompact!==t.isCompact||s.icon!==t.icon||s.expandedIcon!==t.expandedIcon||s.action!==t.action||s.parentItem!==t.parentItem||s.itemData!==t.itemData)});Ae.displayName="TreeViewListItem";class vt extends N.exports.Component{constructor(){super(...arguments),this.displayName="TreeViewRoot",this.treeRef=N.exports.createRef(),this.handleKeys=t=>{var i,o,r,c,d,a,l;if(!this.treeRef.current.contains(t.target))return;const n=document.activeElement,p=t.key,v=Array.from((i=this.treeRef.current)===null||i===void 0?void 0:i.getElementsByClassName("pf-c-tree-view__node")).filter(u=>!u.classList.contains("pf-m-disabled"));if(p===he.Space&&(n.click(),t.preventDefault()),be(t,v,u=>n===u,void 0,[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(p)){const u=(r=(o=n?.firstElementChild)===null||o===void 0?void 0:o.firstElementChild)===null||r===void 0?void 0:r.classList.contains("pf-c-tree-view__node-toggle"),m=(c=n?.closest("li"))===null||c===void 0?void 0:c.classList.contains("pf-m-expanded");if(p==="ArrowLeft")if(u&&m)n.click();else{const h=(d=n?.closest("ul"))===null||d===void 0?void 0:d.parentElement;if(h?.tagName!=="DIV"){const S=h?.querySelector("button");n.tabIndex=-1,S&&(S.tabIndex=0,S.focus())}}else if(u&&!m){n.tabIndex=-1,n.click();const h=(l=(a=n?.closest("li"))===null||a===void 0?void 0:a.querySelector("ul > li"))===null||l===void 0?void 0:l.querySelector("button");h&&(h.tabIndex=0,h.focus())}t.preventDefault()}},this.handleKeysCheckbox=t=>{var i,o,r,c,d;if(!this.treeRef.current.contains(t.target))return;const a=document.activeElement,l=t.key;l===he.Space&&(a.click(),t.preventDefault());const n=Array.from((i=this.treeRef.current)===null||i===void 0?void 0:i.getElementsByClassName("pf-c-tree-view__node"));be(t,n,p=>p.contains(a),p=>p.querySelector("button,input"),[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(l)&&(l==="ArrowLeft"?a?.tagName==="INPUT"?!((o=a?.parentElement)===null||o===void 0)&&o.previousSibling&&a.parentElement.previousSibling.focus():a?.previousSibling&&(((r=a.previousElementSibling)===null||r===void 0?void 0:r.tagName)==="SPAN"?a.previousSibling.firstChild.focus():a.previousSibling.focus()):a?.tagName==="INPUT"?!((c=a.parentElement)===null||c===void 0)&&c.nextSibling&&a.parentElement.nextSibling.focus():a?.nextSibling&&(((d=a.nextElementSibling)===null||d===void 0?void 0:d.tagName)==="SPAN"?a.nextSibling.firstChild.focus():a.nextSibling.focus()),t.preventDefault())},this.variantStyleModifiers={default:"",compact:G.modifiers.compact,compactNoBackground:[G.modifiers.compact,G.modifiers.noBackground]}}componentDidMount(){var t;if(ge&&window.addEventListener("keydown",this.props.hasChecks||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys),this.props.hasChecks||this.props.hasSelectableNodes){const i=this.treeRef.current.getElementsByClassName("pf-c-tree-view__node-toggle")[0];if(i&&(i.tabIndex=0),this.props.hasChecks){const o=this.treeRef.current.getElementsByTagName("INPUT")[0];o&&(o.tabIndex=0)}if(this.props.hasSelectableNodes){const o=this.treeRef.current.getElementsByClassName("pf-c-tree-view__node-text")[0];o&&(o.tabIndex=0)}}else((t=this.treeRef.current)===null||t===void 0?void 0:t.getElementsByClassName("pf-c-tree-view__node")[0]).tabIndex=0}componentWillUnmount(){ge&&window.removeEventListener("keydown",this.props.hasChecks||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys)}render(){const t=this.props,{children:i,hasChecks:o,hasGuides:r,variant:c,className:d,hasSelectableNodes:a}=t,l=oe(t,["children","hasChecks","hasGuides","variant","className","hasSelectableNodes"]);return e("div",{...Object.assign({className:A(G.treeView,r&&G.modifiers.guides,this.variantStyleModifiers[c],d),ref:this.treeRef},l),children:i})}}const ue=s=>{var{data:t,isNested:i=!1,hasChecks:o=!1,hasBadges:r=!1,hasGuides:c=!1,hasSelectableNodes:d=!1,variant:a="default",defaultAllExpanded:l=!1,allExpanded:n,icon:p,expandedIcon:v,parentItem:u,onSelect:m,onCheck:h,toolbar:S,activeItems:V,compareItems:M=(g,f)=>g.id===f.id,className:E,useMemo:x}=s,b=oe(s,["data","isNested","hasChecks","hasBadges","hasGuides","hasSelectableNodes","variant","defaultAllExpanded","allExpanded","icon","expandedIcon","parentItem","onSelect","onCheck","toolbar","activeItems","compareItems","className","useMemo"]);const T=e(Ee,{isNested:i,toolbar:S,children:t.map(g=>{var f,w;return e(Ae,{...Object.assign({key:((f=g.id)===null||f===void 0?void 0:f.toString())||((w=g.name)===null||w===void 0?void 0:w.toString()),name:g.name,title:g.title,id:g.id,isExpanded:n,isSelectable:d,defaultExpanded:g.defaultExpanded!==void 0?g.defaultExpanded:l,onSelect:m,onCheck:h,hasCheck:g.hasCheck!==void 0?g.hasCheck:o,checkProps:g.checkProps,hasBadge:g.hasBadge!==void 0?g.hasBadge:r,customBadgeContent:g.customBadgeContent,badgeProps:g.badgeProps,activeItems:V,parentItem:u,itemData:g,icon:g.icon!==void 0?g.icon:p,expandedIcon:g.expandedIcon!==void 0?g.expandedIcon:v,action:g.action,compareItems:M,isCompact:a==="compact"||a==="compactNoBackground",useMemo:x},g.children&&{children:e(ue,{data:g.children,isNested:!0,parentItem:g,hasChecks:o,hasBadges:r,hasGuides:c,hasSelectableNodes:d,variant:a,allExpanded:n,defaultAllExpanded:l,onSelect:m,onCheck:h,activeItems:V,icon:p,expandedIcon:v})})})})});return e(R,{children:u?T:e(vt,{...Object.assign({hasSelectableNodes:d,hasChecks:o,hasGuides:c,variant:a,className:E},b),children:T})})};ue.displayName="TreeView";const P=({id:s,rename:t,handleModalToggle:i,refresh:o})=>{const{t:r}=O("groups"),{adminClient:c}=F(),{addAlert:d,addError:a}=q(),{register:l,handleSubmit:n,formState:{errors:p}}=xe({defaultValues:{name:t}}),v=async u=>{u.name=u.name?.trim();try{s?t?await c.groups.update({id:s},u):await c.groups.setOrCreateChild({id:s},u):await c.groups.create(u),o(t?u:void 0),i(),d(r(t?"groupUpdated":"groupCreated"),Z.success)}catch(m){a("groups:couldNotCreateGroup",m)}};return e(Ie,{variant:Te.small,title:r(t?"renameAGroup":"createAGroup"),isOpen:!0,onClose:i,actions:[e(W,{"data-testid":`${t?"rename":"create"}Group`,variant:"primary",type:"submit",form:"group-form",children:r(t?"rename":"create")},"confirm"),e(W,{id:"modal-cancel","data-testid":"cancel",variant:ye.link,onClick:()=>{i()},children:r("common:cancel")},"cancel")],children:e(rt,{id:"group-form",isHorizontal:!0,onSubmit:n(v),children:e(ot,{name:"create-modal-group",label:r("common:name"),fieldId:"create-group-name",helperTextInvalid:r("common:required"),validated:p.name?se.error:se.default,isRequired:!0,children:e(nt,{"data-testid":"groupNameInput",autoFocus:!0,id:"create-group-name",validated:p.name?se.error:se.default,...l("name",{required:!0})})})})})},Ve=s=>{const t=s.substr(1).split("/");return t.length>1?t.splice(2):void 0},ne=s=>{const t=Ve(s);return t?t[t.length-1]:void 0},me=({selectedRows:s,show:t,toggleDialog:i,refresh:o})=>{const{t:r}=O("groups"),{adminClient:c}=F(),{addAlert:d,addError:a}=q(),l=async()=>{try{for(const n of s)await c.groups.del({id:n.id});o(),d(r("groupDeleted",{count:s.length}))}catch(n){a("groups:groupDeleteError",n)}};return e(it,{titleKey:r("deleteConfirmTitle",{count:s.length}),messageKey:r("deleteConfirm",{count:s.length,groupName:s[0]?.name}),continueButtonLabel:"common:delete",continueButtonVariant:ye.danger,onConfirm:l,open:t,toggleDialog:i})},yt=({toggleCreate:s,toggleDelete:t,kebabDisabled:i})=>{const{t:o}=O("groups"),{currentGroup:r}=z(),{hasAccess:c}=ae(),d=c("manage-users")||r()?.access?.manage,[a,l]=U();return d?k(R,{children:[e(H,{children:e(W,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:s,children:o("createGroup")})}),e(H,{children:e(ie,{toggle:e(ce,{onToggle:l,isDisabled:i}),isOpen:a,isPlain:!0,dropdownItems:[e($,{component:"button",onClick:()=>{t(),l()},children:o("common:delete")},"action")]})})]}):e("div",{})},wt=async(s,t)=>{await s.groups.del({id:t.id});const{id:i}=await s.groups.create({...t,id:void 0});t.subGroups&&await Promise.all(t.subGroups.map(o=>s.groups.setOrCreateChild({id:i},{...o,id:void 0})))},Ct=async(s,t,i)=>{try{await s.groups.setOrCreateChild({id:i.id},t)}catch(o){if(o.response)throw o}},Me=({source:s,onClose:t,refresh:i})=>{const{t:o}=O("groups"),{adminClient:r}=F(),{addAlert:c,addError:d}=q();return e(ct,{type:"selectOne",filterGroups:[s],text:{title:"groups:moveToGroup",ok:"groups:moveHere"},onClose:t,onConfirm:async l=>{try{await(l?Ct(r,s,l[0]):wt(r,s)),i(),c(o("moveGroupSuccess"))}catch(n){d("groups:moveGroupError",n)}}})},ve=({refresh:s})=>{const{t}=O("groups"),{adminClient:i}=F(),{realm:o}=ee(),[r,c]=N.exports.useState([]),[d,a]=N.exports.useState(),[l,n]=U(),[p,v]=U(),[u,m]=N.exports.useState(),{subGroups:h,currentGroup:S,setSubGroups:V}=z(),[M,E]=N.exports.useState(0),x=()=>E(M+1),[b,T]=N.exports.useState(),g=we(),f=te(),w=ne(f.pathname),{hasAccess:B}=ae(),y=B("manage-users")||S()?.access?.manage,_=B("query-groups","view-users")||B("manage-users","query-groups"),D=async(C,L)=>{const K={search:b||"",first:C?.toString()||"",max:L?.toString()||""};let I;if(w){const re=await i.groups.findOne({id:w});if(!re)throw new Error(t("common:notFound"));I=b?re.subGroups?.filter(De=>De.name?.includes(b)):re.subGroups}else I=await ke(i,"ui-ext/groups",{...K,global:"false"});return I||g(Ce({realm:o})),I||[]},j=C=>_?e(Y,{to:`${f.pathname}/${C.id}`,onClick:()=>V([...h,C]),children:C.name},C.id):e("span",{children:C.name});return k(R,{children:[e(me,{show:p,toggleDialog:v,selectedRows:r,refresh:()=>{x(),s(),c([])}}),d&&e(P,{id:d.id,rename:d.name,refresh:()=>{x(),s()},handleModalToggle:()=>a(void 0)}),l&&e(P,{id:r[0]?.id||w,handleModalToggle:n,refresh:()=>{c([]),x(),s()}}),u&&e(Me,{source:u,refresh:()=>{m(void 0),x(),s()},onClose:()=>m(void 0)}),e(le,{onSelect:C=>c([...C]),canSelectAll:!0,loader:D,ariaLabelKey:"groups:groups",isPaginated:!0,isSearching:!!b,toolbarItem:k(R,{children:[e(H,{children:e(dt,{"data-testid":"group-search",placeholder:t("filterGroups"),value:b,onChange:(C,L)=>{T(L)},onSearch:x,onClear:()=>{T(""),x()}})}),e(yt,{toggleCreate:n,toggleDelete:v,kebabDisabled:r.length===0})]}),actions:y?[{title:t("rename"),onRowClick:async C=>(a(C),!1)},{title:t("moveTo"),onRowClick:async C=>(m(C),!1)},{title:t("createChildGroup"),onRowClick:async C=>(c([C]),n(),!1)},{isSeparator:!0},{title:t("common:delete"),onRowClick:async C=>(c([C]),v(),!0)}]:[],columns:[{name:"name",displayKey:"groups:groupName",cellRenderer:j}],emptyState:e(de,{hasIcon:!0,message:t(`noGroupsInThis${w?"SubGroup":"Realm"}`),instructions:t(`noGroupsInThis${w?"SubGroup":"Realm"}Instructions`),primaryActionText:t("createGroup"),onPrimaryAction:n})},`${w}${M}`)]})},Nt=({groupId:s,onClose:t})=>{const{t:i}=O("groups"),{adminClient:o}=F(),{addAlert:r,addError:c}=q(),[d,a]=N.exports.useState([]),l=async(n,p,v)=>{const u=await o.groups.listMembers({id:s}),m={first:n,max:p+u.length,search:v||""};try{const h=await o.users.find({...m});return st(h,u,"id").slice(0,p)}catch(h){return c("groups:noUsersFoundError",h),[]}};return e(Ie,{variant:Te.large,title:i("addMember"),isOpen:!0,onClose:t,actions:[e(W,{"data-testid":"add",variant:"primary",onClick:async()=>{try{await Promise.all(d.map(n=>o.users.addToGroup({id:n.id,groupId:s}))),t(),r(i("usersAdded",{count:d.length}),Z.success)}catch(n){c("groups:usersAddedError",n)}},children:i("common:add")},"confirm"),e(W,{"data-testid":"cancel",variant:"link",onClick:t,children:i("common:cancel")},"cancel")],children:e(le,{loader:l,isPaginated:!0,ariaLabelKey:"users:title",searchPlaceholderKey:"users:searchForUser",canSelectAll:!0,onSelect:n=>a([...n]),emptyState:e(de,{message:i("users:noUsersFound"),instructions:i("users:emptyInstructions")}),columns:[{name:"username",displayKey:"users:username"},{name:"email",displayKey:"users:email"},{name:"lastName",displayKey:"users:lastName",cellFormatters:[J()]},{name:"firstName",displayKey:"users:firstName",cellFormatters:[J()]}]})})},St=()=>{const{t:s}=O("groups"),{adminClient:t}=F(),{realm:i}=ee(),{addAlert:o,addError:r}=q(),c=te(),d=ne(c.pathname),[a,l]=N.exports.useState(!1),{currentGroup:n}=z(),[p,v]=N.exports.useState(!1),[u,m]=N.exports.useState(!1),[h,S]=N.exports.useState([]),{hasAccess:V}=ae(),M=V("manage-users")||n().access.manageMembership,[E,x]=N.exports.useState(0),b=()=>x(new Date().getTime()),T=async y=>await t.users.listGroups({id:y}),g=y=>{let _=[];for(const D of y){_.push(D);const j=g(D.subGroups);_=_.concat(j)}return _},f=async(y,_)=>{let D=await t.groups.listMembers({id:d,first:y,max:_});if(a){const C=g(n()?.subGroups);for(const L of C)D=D.concat(await t.groups.listMembers({id:L.id}));D=Le(D,L=>L.username)}const j=await Promise.all(D.map(C=>T(C.id)));return D.map((C,L)=>({...C,membership:j[L]}))},w=y=>e(R,{children:y.membership.map((_,D)=>k(R,{children:[e(lt,{group:_},_.id),y.membership[D+1]?", ":""]}))}),B=y=>e(Y,{to:Fe({realm:i,id:y.id,tab:"settings"}),children:y.username},y.id);return k(R,{children:[p&&e(Nt,{groupId:d,onClose:()=>{v(!1),b()}}),e(le,{"data-testid":"members-table",loader:f,ariaLabelKey:"groups:members",isPaginated:!0,canSelectAll:!0,onSelect:y=>S([...y]),toolbarItem:M&&k(R,{children:[e(H,{children:e(W,{"data-testid":"addMember",variant:"primary",onClick:()=>v(!0),children:s("addMember")})}),e(H,{children:e(_e,{"data-testid":"includeSubGroupsCheck",label:s("includeSubGroups"),id:"kc-include-sub-groups",isChecked:a,onChange:()=>l(!a)})}),e(H,{children:e(ie,{toggle:e(ce,{onToggle:()=>m(!u),isDisabled:h.length===0}),isOpen:u,isPlain:!0,dropdownItems:[e($,{component:"button",onClick:async()=>{try{await Promise.all(h.map(y=>t.users.delFromGroup({id:y.id,groupId:d}))),m(!1),o(s("usersLeft",{count:h.length}),Z.success)}catch(y){r("groups:usersLeftError",y)}b()},children:s("leave")},"action")]})})]}),actions:M?[{title:s("leave"),onRowClick:async y=>{try{await t.users.delFromGroup({id:y.id,groupId:d}),o(s("usersLeft",{count:1}),Z.success)}catch(_){r("groups:usersLeftError",_)}return!0}}]:[],columns:[{name:"username",displayKey:"common:name",cellRenderer:B},{name:"email",displayKey:"groups:email",cellFormatters:[J()]},{name:"firstName",displayKey:"groups:firstName",cellFormatters:[J()]},{name:"lastName",displayKey:"groups:lastName",cellFormatters:[J()]},{name:"membership",displayKey:"groups:membership",cellRenderer:w}],emptyState:e(de,{message:s("users:noUsersFound"),instructions:M?s("users:emptyInstructions"):void 0,primaryActionText:M?s("addMember"):void 0,onPrimaryAction:()=>v(!0),secondaryActions:[{text:s("includeSubGroups"),onClick:()=>l(!0)}]})},`${d}${E}${a}`)]})},Gt=()=>{const{t:s}=O("groups"),{adminClient:t}=F(),{addAlert:i,addError:o}=q(),r=xe({mode:"onChange"}),c=te(),d=ne(c.pathname),{currentGroup:a,subGroups:l,setSubGroups:n}=z(),p=u=>Ue(u||a()?.attributes);N.exports.useEffect(()=>{r.setValue("attributes",p())},[l]);const v=async u=>{try{const m=a(),h=$e(u.attributes);await t.groups.update({id:d},{...m,attributes:h}),n([...l.slice(0,l.length-1),{...m,attributes:h}]),i(s("groupUpdated"),Z.success)}catch(m){o("groups:groupUpdateError",m)}};return e(Ne,{variant:Se.light,children:e(ut,{form:r,save:v,fineGrainedAccess:a()?.access?.manage,reset:()=>r.reset({attributes:p()})})})},kt=({id:s,name:t})=>{const{t:i}=O("clients"),{adminClient:o}=F(),{addAlert:r,addError:c}=q();return e(mt,{name:t,id:s,type:"groups",save:async a=>{try{const l=a.filter(n=>n.client===void 0).map(n=>n.role).flat();await o.groups.addRealmRoleMappings({id:s,roles:l}),await Promise.all(a.filter(n=>n.client!==void 0).map(n=>o.groups.addClientRoleMappings({id:s,clientUniqueId:n.client.id,roles:[n.role]}))),r(i("roleMappingUpdatedSuccess"),Z.success)}catch(l){c("clients:roleMappingUpdatedError",l)}}})};const xt=({group:s,refresh:t})=>{const{t:i}=O("groups"),[o,r]=U(),[c,d]=U(),[a,l]=U(),[n,p]=U(),[v,u]=U();return k(R,{children:[c&&e(P,{id:s.id,rename:s.name,refresh:()=>{t()},handleModalToggle:d}),a&&e(P,{id:s.id,handleModalToggle:l,refresh:t}),n&&e(Me,{source:s,refresh:t,onClose:p}),e(me,{show:v,toggleDialog:u,selectedRows:[s],refresh:t}),e(ie,{toggle:e(ce,{onToggle:r}),isOpen:o,isPlain:!0,position:He.right,dropdownItems:[e($,{onClick:d,children:i("rename")},"rename"),e($,{onClick:p,children:i("moveTo")},"move"),e($,{onClick:l,children:i("createChildGroup")},"create"),e(We,{},"separator"),e($,{onClick:u,children:i("common:delete")},"delete")]})]})},It=({refresh:s})=>{const{t}=O("groups"),{adminClient:i}=F(),{realm:o}=ee(),[r,c]=N.exports.useState(),{subGroups:d,setSubGroups:a}=z(),[l,n]=N.exports.useState(""),[p,v]=N.exports.useState(20),[u,m]=N.exports.useState(0),[h,S]=N.exports.useState(!1),[V,M]=N.exports.useState(0),E=()=>{M(V+1),s()},x=(b,T,g)=>{const f=[...T,b];return{id:b.id,name:e(ze,{content:b.name,children:e(Y,{to:`/${o}/groups/${ht(...f.map(w=>w.id))}`,onClick:()=>a(f),children:b.name})}),children:b.subGroups&&b.subGroups.length>0?b.subGroups.map(w=>x(w,f,g)):void 0,action:e(xt,{group:b,refresh:g}),defaultExpanded:d.map(w=>w.id).includes(b.id)}};return Ge(()=>ke(i,"ui-ext/groups",Object.assign({first:`${u}`,max:`${p+1}`,exact:`${h}`},l===""?null:{search:l})),b=>c(b.map(T=>x(T,[],E))),[V,u,p,l,h]),r?e(at,{count:r.length||0,first:u,max:p,onNextClick:m,onPreviousClick:m,onPerPageSelect:(b,T)=>{m(b),v(T)},inputGroupName:"searchForGroups",inputGroupPlaceholder:t("groups:searchForGroups"),inputGroupOnEnter:n,toolbarItem:k(je,{className:"pf-u-pt-sm",children:[e(_e,{id:"exact","data-testid":"exact-search",name:"exact",isChecked:h,onChange:b=>S(b)}),e("span",{className:"pf-u-pl-sm",children:t("exactSearch")})]}),children:r.length>0&&e(ue,{data:r,allExpanded:l.length>0,hasGuides:!0,className:"keycloak_groups_treeview"})}):e(qe,{})},Tt=()=>{const{t:s}=O(),{clear:t,remove:i,subGroups:o}=z(),{realm:r}=ee(),c=te();return N.exports.useEffect(()=>{const{pathname:d}=c;(!d.includes("/groups")||d.endsWith("/groups"))&&t()},[c]),o.length!==0?k(Ze,{children:[e(fe,{children:e(Y,{to:`/${r}/groups`,children:s("groups")})},"home"),o.map((d,a)=>{const l=a===o.length-1;return k(fe,{isActive:l,children:[!l&&e(Y,{to:c.pathname.substring(0,c.pathname.indexOf(d.id)+d.id.length),onClick:()=>i(d),children:d.name}),l&&(d.id==="search"?d.name:s("groups:groupDetails"))]},d.id)})]}):null};function Cs(){const{t:s}=O("groups"),[t,i]=N.exports.useState(0),{profileInfo:o}=Qe(),{adminClient:r}=F(),{subGroups:c,setSubGroups:d,currentGroup:a}=z(),{realm:l}=ee(),[n,p]=N.exports.useState(),[v,u]=U(),m=we(),h=te(),S=ne(h.pathname),[V,M]=N.exports.useState(0),E=()=>M(V+1),{hasAccess:x}=ae(),b=!o?.disabledFeatures?.includes("ADMIN_FINE_GRAINED_AUTHZ")&&x("manage-authorization","manage-users","manage-clients"),T=x("manage-users")||a()?.access?.manage,g=x("manage-users");return Ge(async()=>{const f=Ve(h.pathname);if(f&&f.length>c.length){const B=[];for(const y of f){const _=y!=="search"?await r.groups.findOne({id:y}):{name:s("searchGroups"),id:"search"};if(_)B.push(_);else throw new Error(s("common:notFound"))}return B}return[]},f=>{f.length&&d(f)},[S]),k(R,{children:[e(me,{show:v,toggleDialog:u,selectedRows:[a()],refresh:()=>{m(Ce({realm:l})),E()}}),n&&e(P,{id:S,rename:n,refresh:f=>{E(),d([...c.slice(0,c.length-1),f])},handleModalToggle:()=>p(void 0)}),e(Ne,{variant:Se.light,className:"pf-u-p-0",children:e(Xe,{isInline:!0,isExpanded:!0,children:e(Je,{panelContent:e(Ye,{isResizable:!0,defaultSize:"80%",minSize:"500px",children:k(gt,{children:[e(Tt,{}),e(tt,{titleKey:S?a()?.name:"groups:groups",subKey:S?"":"groups:groupsDescription",helpUrl:S?"":Pe.groupsUrl,divider:!S,dropdownItems:S&&T?[e($,{"data-testid":"renameGroupAction",onClick:()=>p(a()?.name),children:s("renameGroup")},"renameGroup"),e($,{"data-testid":"deleteGroup",onClick:u,children:s("deleteGroup")},"deleteGroup")]:void 0}),c.length>0&&k(ft,{inset:{default:"insetNone",md:"insetSm",xl:"insetLg","2xl":"inset2xl"},activeKey:t,onSelect:(f,w)=>i(w),isBox:!0,children:[e(Q,{"data-testid":"groups",eventKey:0,title:e(X,{children:s("childGroups")}),children:e(ve,{refresh:E})}),e(Q,{"data-testid":"members",eventKey:1,title:e(X,{children:s("members")}),children:e(St,{})}),e(Q,{"data-testid":"attributes",eventKey:2,title:e(X,{children:s("common:attributes")}),children:e(Gt,{})}),g&&e(Q,{eventKey:3,"data-testid":"role-mapping-tab",title:e(X,{children:s("roleMapping")}),children:e(kt,{id:S,name:a()?.name})}),b&&e(Q,{eventKey:4,"data-testid":"permissionsTab",title:e(X,{children:s("common:permissions")}),children:e(pt,{id:S,type:"groups"})})]}),c.length===0&&e(ve,{refresh:E})]})}),children:e(et,{children:e(It,{refresh:E})})})},V)})]})}export{Cs as default};
//# sourceMappingURL=GroupsSection.fb2aef26.js.map
