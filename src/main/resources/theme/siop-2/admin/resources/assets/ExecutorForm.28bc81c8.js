import{u as X,ax as Z,aA as _,r as l,g as J,az as Q,aZ as U,h as u,F as W,j as t,P as Y,q as h,b3 as F,cO as P,aX as $}from"./index.2ecf13ca.js";import{u as ee,C as te,F as oe}from"./index.esm.68aaf060.js";import{D as re}from"./DynamicComponents.16b222ec.js";import{F as se}from"./FormAccess.7ed5d8eb.js";import{H as V}from"./HelpItem.49be9c4e.js";import{V as ie}from"./ViewHeader.67577dd4.js";import{u as k}from"./useParams.921239aa.js";import{a as ae,A as ce}from"./FormGroup.24d2e56a.js";import{S as ne,b as le,a as me}from"./Select.5d6f6214.js";import"./ClientSelect.95a4ec0e.js";import"./FileUpload.005327fa.js";import"./CodeEditor.0b7c4c70.js";import"./copy-icon.06155c15.js";import"./EmptyStateBody.25bf6e38.js";import"./EmptyStateSecondaryActions.3ed74a6a.js";import"./GroupPickerDialog.38947607.js";import"./ListEmptyState.94d606ed.js";import"./TableToolbar.f167c244.js";import"./plus-circle-icon.f1969120.js";import"./DataListItemRow.7402b99a.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.6efe1939.js";import"./Modal.2c72168d.js";import"./ActionListItem.c90af00f.js";import"./FlexItem.2ee8dfc9.js";import"./minus-circle-icon.e9e185f2.js";import"./MultiLineInput.7867bd1a.js";import"./PasswordInput.4caf2dff.js";import"./KeycloakTextInput.97e36976.js";import"./useToggle.97c716af.js";import"./AddRoleMappingModal.c7175fba.js";import"./KeycloakDataTable.5c9a6c7c.js";import"./Td.ff2a9f66.js";import"./star-icon.648ddb2a.js";import"./check.51c67984.js";import"./Checkbox.56efba4a.js";import"./useLocaleSort.377bcdf5.js";import"./resource.09062762.js";import"./joinPath.69b856b1.js";import"./filter-icon.f568e30b.js";import"./ConfirmDialog.b43fd344.js";import"./KeycloakTextArea.2947a089.js";import"./GridItem.a22d8cac.js";import"./Text.441b2f8e.js";const A={config:{},executor:""};function tt(){const{t:i}=X("realm-settings"),C=Z(),{realm:p,profileName:c}=k(),{executorName:n}=k(),{addAlert:I,addError:H}=_(),[O,T]=l.exports.useState(!1),N=J(),{adminClient:v}=Q(),d=N.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[x,D]=l.exports.useState([]),[G,j]=l.exports.useState([]),[y,B]=l.exports.useState([]),[L,w]=l.exports.useState([]),f=ee({defaultValues:A}),{control:z,reset:E,handleSubmit:q}=f,r=!!n,b=e=>{const o=e.find(a=>a.name===c)?.executors?.find(a=>a.executor===n);o&&E({config:o.configuration})};U(()=>v.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{B(e.globalProfiles),w(e.profiles),b(e.profiles),b(e.globalProfiles)},[]);const K=async()=>{const e=f.getValues(),s=L.map(o=>{if(o.name!==c)return o;const a=(o.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(r){const m=o.executors.find(R=>R.executor===n);m.configuration={...m.configuration,...e.config}}return r?o:{...o,executors:a}});try{await v.clientPolicies.createProfiles({profiles:s,globalProfiles:y}),I(i(r?"realm-settings:updateExecutorSuccess":"realm-settings:addExecutorSuccess"),$.success),C(P({realm:p,profileName:c}))}catch(o){H(r?"realm-settings:updateExecutorError":"realm-settings:addExecutorError",o)}},g=y.find(e=>e.name===c),S=d?.find(e=>e.id===n),M=S?.properties.map(e=>{const s=r?e.defaultValue:"";return{...e,defaultValue:s}});return u(W,{children:[t(ie,{titleKey:r?n:i("addExecutor"),divider:!0}),u(Y,{variant:"light",children:[u(se,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",isReadOnly:!!g,children:[t(ae,{label:i("executorType"),fieldId:"kc-executorType",labelIcon:x.length>0&&x[0].helpText!==""?t(V,{helpText:x[0].helpText,fieldLabelId:"realm-settings:executorTypeHelpText"}):r?t(V,{helpText:S?.helpText,fieldLabelId:"realm-settings:executorTypeHelpText"}):void 0,children:t(te,{name:"executor",defaultValue:"",control:z,render:({field:e})=>t(ne,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:s=>T(s),onSelect:(s,o)=>{E({...A,executor:o.toString()});const a=d?.filter(m=>m.id===o);D(a??[]),j(a?.[0].properties??[]),T(!1)},selections:r?n:e.value,variant:le.single,"data-testid":"executorType-select","aria-label":i("executorType"),isOpen:O,maxHeight:580,isDisabled:r,children:d?.map(s=>t(me,{selected:s.id===e.value,value:s.id,description:s.helpText},s.id))})})}),t(oe,{...f,children:t(re,{properties:r?M:G})}),!g&&u(ce,{children:[t(h,{variant:"primary",onClick:()=>q(K)(),"data-testid":"addExecutor-saveBtn",children:i(r?"common:save":"common:add")}),t(h,{variant:"link",component:e=>t(F,{...e,to:P({realm:p,profileName:c})}),"data-testid":"addExecutor-cancelBtn",children:i("common:cancel")})]})]}),r&&g&&t("div",{className:"kc-backToProfile",children:t(h,{component:e=>t(F,{...e,to:P({realm:p,profileName:c})}),variant:"primary",children:i("realm-settings:back")})})]})]})}export{tt as default};
//# sourceMappingURL=ExecutorForm.28bc81c8.js.map
