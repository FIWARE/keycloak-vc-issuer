import{u as q,aA as K,ax as L,l as R,r as c,by as X,g as Z,az as _,aZ as J,j as n,P as M,h as v,q as x,cK as b,aX as Q}from"./index.7cbfb18a.js";import{u as U,C as W,F as Y}from"./index.esm.1e7ace95.js";import{D as tt}from"./DynamicComponents.7f569784.js";import{F as it}from"./FormAccess.3a7ea209.js";import{H as ot}from"./HelpItem.719382e8.js";import{F as et}from"./FormPanel.95e4e303.js";import{c as A}from"./camelCase.0b55fcf3.js";import{a as nt,A as rt}from"./FormGroup.60c77f60.js";import{S as st,b as at,a as ct}from"./Select.fbe867d5.js";import"./ClientSelect.2d31aa2e.js";import"./FileUpload.c211f5c1.js";import"./CodeEditor.5b99e2f5.js";import"./copy-icon.dbf95270.js";import"./EmptyStateBody.1533f3a6.js";import"./EmptyStateSecondaryActions.511adeb0.js";import"./GroupPickerDialog.174f65c8.js";import"./ListEmptyState.fef0510e.js";import"./TableToolbar.51ae2a5f.js";import"./plus-circle-icon.aa8a939a.js";import"./DataListItemRow.df3ed5f3.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.7e109111.js";import"./Modal.11970fe7.js";import"./ActionListItem.65cb5d9a.js";import"./FlexItem.ae9c1d3c.js";import"./minus-circle-icon.c093f419.js";import"./MultiLineInput.091fd21a.js";import"./PasswordInput.aa539188.js";import"./KeycloakTextInput.9afb01cd.js";import"./useToggle.461e82f2.js";import"./AddRoleMappingModal.c8e6830c.js";import"./KeycloakDataTable.ae870e97.js";import"./Td.1e0c90e7.js";import"./star-icon.a6efdd26.js";import"./check.51c67984.js";import"./Checkbox.7d63c785.js";import"./useLocaleSort.b8a659bb.js";import"./resource.2cd5a37e.js";import"./joinPath.69b856b1.js";import"./filter-icon.a9b0a5f3.js";import"./ConfirmDialog.4dc691c5.js";import"./KeycloakTextArea.d98120cb.js";import"./GridItem.63e5e367.js";import"./CardHeader.b7b31472.js";import"./Card.37028a42.js";import"./CardTitle.d8222cf8.js";import"./CardBody.4fff68f7.js";import"./capitalize.02f8b152.js";function ei(){const{t:o}=q("realm-settings"),{addAlert:F,addError:I}=K(),f=L(),{realm:C}=R(),[D,g]=c.exports.useState(!1),[N,y]=c.exports.useState([]),[k,w]=c.exports.useState([]),[V,j]=c.exports.useState(),[l,B]=c.exports.useState(""),[h,P]=c.exports.useState([]),{policyName:d,conditionName:i}=X(),E=Z(),m=U(),S=E.componentTypes?.["org.keycloak.services.clientpolicy.condition.ClientPolicyConditionProvider"],{adminClient:T}=_(),H=s=>{m.reset({config:s.configuration||{}})};J(()=>T.clientPolicies.listPolicies(),s=>{if(y(s.policies??[]),i){const r=s.policies?.find(t=>t.name===d)?.conditions?.find(t=>t.condition===i),p=S?.find(t=>t.id===i);j(r),P(p?.properties),H(r)}},[]);const O=async s=>{const e=s.config,r=()=>h.reduce((t,a)=>(t[a.name]=e[a.name],t),{}),p=N.map(t=>{if(t.name!==d)return t;let a=t.conditions??[];if(i){const z={condition:V?.condition,configuration:r()},u=a.findIndex($=>i===$.condition);if(u===-1)return;const G=[...a.slice(0,u),z,...a.slice(u+1)];return{...t,conditions:G}}return a=a.concat({condition:k[0].condition,configuration:r()}),{...t,conditions:a}});try{await T.clientPolicies.updatePolicy({policies:p}),y(p),f(b({realm:C,policyName:d})),F(o(i?"realm-settings:updateClientConditionSuccess":"realm-settings:createClientConditionSuccess"),Q.success)}catch(t){I("realm-settings:createClientConditionError",t)}};return n(M,{variant:"light",children:n(et,{className:"kc-login-screen",title:o(i?"editCondition":"addCondition"),children:v(it,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:m.handleSubmit(O),children:[n(nt,{label:o("conditionType"),fieldId:"conditionType",labelIcon:n(ot,{helpText:l?`realm-settings-help:${A(l.replace(/-/g," "))}`:"realm-settings-help:conditions",fieldLabelId:"realm-settings:conditionType"}),children:n(W,{name:"conditions",defaultValue:"any-client",control:m.control,render:({field:s})=>n(st,{placeholderText:o("selectACondition"),className:"kc-conditionType-select","data-testid":"conditionType-select",toggleId:"provider",isDisabled:!!i,onToggle:e=>g(e),onSelect:(e,r)=>{s.onChange(r),P(r.properties),B(r.id),w([{condition:r.id}]),g(!1)},selections:i||l,variant:at.single,"aria-label":o("conditionType"),isOpen:D,children:S?.map(e=>n(ct,{selected:e.id===s.value,description:o(`realm-settings-help:${A(e.id.replace(/-/g," "))}`),value:e,children:e.id},e.id))})})}),n(Y,{...m,children:n(tt,{properties:h})}),v(rt,{children:[n(x,{variant:"primary",type:"submit","data-testid":"addCondition-saveBtn",isDisabled:l===""&&!i,children:o(i?"common:save":"common:add")}),n(x,{variant:"link","data-testid":"addCondition-cancelBtn",onClick:()=>f(b({realm:C,policyName:d})),children:o("common:cancel")})]})]})})})}export{ei as default};
//# sourceMappingURL=NewClientPolicyCondition.595edf4c.js.map
