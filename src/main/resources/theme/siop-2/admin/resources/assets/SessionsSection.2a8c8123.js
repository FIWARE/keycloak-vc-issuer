import{u as x,aA as D,l as F,az as q,r as S,aZ as T,h as R,j as t,q as p,ad as E,T as I,aw as f,cE as P,aX as r,ao as N,F as V,b1 as K,P as U}from"./index.2ecf13ca.js";import{V as M}from"./ViewHeader.67577dd4.js";import{u as j}from"./index.esm.68aaf060.js";import{K as L}from"./KeycloakTextInput.97e36976.js";import{M as z,a as H}from"./Modal.2c72168d.js";import{F as G,a as X}from"./FormGroup.24d2e56a.js";import{S as Z}from"./SessionsTable.67f1e7d6.js";import{u as $}from"./ConfirmDialog.b43fd344.js";import"./HelpItem.49be9c4e.js";import"./Text.441b2f8e.js";import"./ListEmptyState.94d606ed.js";import"./TableToolbar.f167c244.js";import"./EmptyStateSecondaryActions.3ed74a6a.js";import"./EmptyStateBody.25bf6e38.js";import"./plus-circle-icon.f1969120.js";import"./KeycloakDataTable.5c9a6c7c.js";import"./Td.ff2a9f66.js";import"./star-icon.648ddb2a.js";import"./check.51c67984.js";import"./grip-vertical-icon.6efe1939.js";import"./Checkbox.56efba4a.js";import"./useFormatDate.742c67f0.js";import"./ListItem.e829200f.js";const J=({handleModalToggle:a,save:h})=>{const{t:e}=x("sessions"),{addAlert:o}=D(),{realm:n}=F(),{adminClient:i}=q(),{register:g,handleSubmit:v,formState:{errors:m}}=j(),[c,w]=S.exports.useState(),[y,C]=S.exports.useState(0),d=()=>{C(new Date().getTime())};T(()=>i.realms.findOne({realm:n}),s=>{w(s)},[y]);const l=(s,B)=>{const O=s.successRequests?.length||0,A=s.failedRequests?.length||0;O===0&&A===0?o(e("clients:noAdminUrlSet"),r.warning):A>0?(o(e("clients:"+B+"Success",{successNodes:s.successRequests}),r.success),o(e("clients:"+B+"Fail",{failedNodes:s.failedRequests}),r.danger)):o(e("clients:"+B+"Success",{successNodes:s.successRequests}),r.success)},u=async()=>{try{await i.realms.update({realm:n},{realm:n,notBefore:Date.now()/1e3}),o(e("notBeforeSuccess"),r.success)}catch(s){o(e("setToNowError",{error:s}),r.danger)}},b=async()=>{try{await i.realms.update({realm:n},{realm:n,notBefore:0}),o(e("notBeforeClearedSuccess"),r.success),d()}catch(s){o(e("notBeforeError",{error:s}),r.danger)}},k=async()=>{const s=await i.realms.pushRevocation({realm:n});l(s,"notBeforePush"),d()};return R(z,{variant:H.small,title:e("revocation"),isOpen:!0,onClose:a,actions:[t(p,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{u(),a()},form:"revocation-modal-form",children:e("setToNow")},"set-to-now"),t(p,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{b(),a()},form:"revocation-modal-form",children:e("clear")},"clear"),t(p,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{k(),a()},form:"revocation-modal-form",children:e("push")},"push"),t(p,{id:"modal-cancel","data-testid":"cancel",variant:E.link,onClick:()=>{a()},children:e("common:cancel")},"cancel")],children:[t(I,{className:"kc-revocation-description-text",children:e("revocationDescription")}),t(G,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:v(h),children:t(X,{className:"kc-revocation-modal-form-group",label:e("notBefore"),name:"notBefore",fieldId:"not-before",validated:m.email?f.error:f.default,children:t(L,{"data-testid":"not-before-input",autoFocus:!0,isReadOnly:!0,value:c?.notBefore===0?e("none"):new Date(c?.notBefore*1e3).toString(),type:"text",id:"not-before",...g("notBefore",{required:!0,pattern:P}),validated:m.email?f.error:f.default})})})]})};function we(){const{t:a}=x("sessions"),{keycloak:h,adminClient:e}=q(),{addError:o}=D(),{realm:n}=F(),[i,g]=S.exports.useState(!1),[v,m]=S.exports.useState(!1),c=()=>{g(!i)},w=async()=>{const l=await e.sessions.find(),u=(await Promise.all(l.map(s=>e.clients.listSessions({id:s.id})))).flat();m(u.length===0);const b=Array.from(new Set(u.map(s=>s.userId)));return(await Promise.all(b.map(s=>e.users.listSessions({id:s})))).flat()},[y,C]=$({titleKey:"sessions:logoutAllSessions",messageKey:"sessions:logoutAllDescription",continueButtonLabel:"common:confirm",onConfirm:async()=>{try{await e.realms.logoutAll({realm:n}),h.logout({redirectUri:""})}catch(l){o("sessions:logoutAllSessionsError",l)}}}),d=[t(N,{"data-testid":"revocation",component:"button",onClick:()=>c(),children:a("revocation")},"toggle-modal"),t(N,{"data-testid":"logout-all",component:"button",isDisabled:v,onClick:y,children:a("signOutAllActiveSessions")},"delete-role")];return R(V,{children:[t(C,{}),t(M,{dropdownItems:d,titleKey:"sessions:title",subKey:"sessions:sessionExplain",helpUrl:K.sessionsUrl}),R(U,{variant:"light",className:"pf-u-p-0",children:[i&&t(J,{handleModalToggle:c,save:()=>{c()}}),t(Z,{loader:w})]})]})}export{we as default};
//# sourceMappingURL=SessionsSection.2a8c8123.js.map
