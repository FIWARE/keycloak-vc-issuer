{"version":3,"file":"VC.js","names":["React","Select","SelectOption","Button","Text","PageSectionVariants","PageSection","ActionList","ActionListItem","TextVariants","List","ListItem","QRCodeSVG","ContentPage","AccountServiceContext","VC","Component","constructor","props","context","console","log","state","dropdownItems","credential","vcUrl","isOpen","isDisabled","vcQRVisible","urlQRVisible","selected","fetchAvailableTypes","accountURL","URL","accountUrl","keycloakContext","kcSvc","keycloakAuth","vcTypes","protocol","host","realm","token","options","method","headers","fetch","then","response","json","data","setState","generateVCUrl","vcIssue","requestVC","text","render","light","e","s","map","option","index","h5"],"sources":["../../../src/app/content/vc/VC.tsx"],"sourcesContent":["/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from 'react';\n\nimport {\n    Select,\n    SelectOption,\n    Button,\n    Text,\n    PageSectionVariants,\n    PageSection,\n    ActionList,\n    ActionListItem,\n    TextVariants,\n    List,\n    ListItem,\n    SelectOptionObject\n} from '@patternfly/react-core';\nimport { QRCodeSVG, QRCodeCanvas } from './QRCode';\n\n \nimport { ContentPage } from \"../ContentPage\"\nimport { ContentAlert } from \"../ContentAlter\"\nimport { AccountServiceContext } from \"../../account-service/AccountServiceContext\"\n\ninterface VCProps {\n}\n\ninterface VCState {\n  dropdownItems: string[],\n  credential: string,\n  vcUrl: string,\n  isOpen: boolean,\n  isDisabled: boolean,\n  vcQRVisible: boolean,\n  urlQRVisible: boolean,\n  selected: string | SelectOptionObject\n}\n\nexport class VC extends React.Component<VCProps, VCState> {\n  static contextType = AccountServiceContext;\n\n  constructor(props: VCProps, context:  React.ContextType<typeof AccountServiceContext>){\n\n    console.log(\"Received context\")\n    console.log(context)\n    super(props, context)\n    this.state = {\n      dropdownItems: [],\n      credential: \"\",\n      vcUrl: \"\",\n      isOpen: false,\n      isDisabled: true,\n      vcQRVisible: false,\n      urlQRVisible: false,\n      selected:\"\"\n    }\n    this.fetchAvailableTypes()\n  }\n\n\n  private fetchAvailableTypes() {\n      const accountURL = new URL(this.context.accountUrl)\n      const keycloakContext = this.context.kcSvc.keycloakAuth;\n      const vcTypes = accountURL.protocol + \"//\" + accountURL.host + \"/realms/\" + keycloakContext.realm + \"/verifiable-credential/types\";\n      const token = keycloakContext.token\n\n      var options = {  \n          method: 'GET',\n          headers: {\n          'Authorization': 'Bearer ' + token\n          }\n      }\n      fetch(vcTypes, options)\n          .then(response => response.json())\n          .then(data =>  this.setState({ ...{dropdownItems: data}}));\n    }\n  \n  \n  private generateVCUrl() {\n    const accountURL = new URL(this.context.accountUrl)\n    const keycloakContext = this.context.kcSvc.keycloakAuth;\n    const vcIssue = accountURL.protocol + \"//\" + accountURL.host + \"/realms/\" + keycloakContext.realm + \"/verifiable-credential?type=\"+ this.state.selected + \"&token=\" + keycloakContext.token;\n\n    this.setState({ ...{\n      vcUrl: vcIssue,\n      vcQRVisible: false,\n      urlQRVisible: true}});\n  }\n\n  private requestVC() {\n      const accountURL = new URL(this.context.accountUrl)\n      const keycloakContext = this.context.kcSvc.keycloakAuth;\n      const vcIssue = accountURL.protocol + \"//\" + accountURL.host + \"/realms/\" + keycloakContext.realm + \"/verifiable-credential?type=\"+ this.state.selected;\n      const token = keycloakContext.token\n  \n      var options = {  \n        method: 'GET',\n        headers: {\n          'Authorization': 'Bearer ' + token\n        }\n      }\n      fetch(vcIssue, options)\n        .then(response => response.text())\n        .then(data => this.setState({ ...{\n            credential: data,\n            vcQRVisible: true,\n            urlQRVisible: false}})\n        );\n    }\n\n    public render(): React.ReactNode {\n          \n    const { isOpen, selected, dropdownItems, isDisabled, credential, vcQRVisible, urlQRVisible, vcUrl} = this.state;\n\n    return (\n      <ContentPage title='Issue VCs' introMessage='Request a VC of the selected type or generate the request for importing it into your wallet.'>\n        <PageSection isFilled variant={PageSectionVariants.light}>     \n          <List isPlain>    \n            <ListItem>   \n              <Select\n                placeholderText=\"Select an option\"\n                aria-label=\"Select Input with descriptions\"\n                onToggle={isOpen => {\n                  this.setState({\n                    isOpen\n                  });\n                }}\n                onSelect={(e,s) => this.setState({ ...{\n                  selected: s,\n                  isOpen: false,\n                  isDisabled: false\n                }})}\n                selections={selected}\n                isOpen={isOpen}\n              >\n                {dropdownItems.map((option, index) => (\n                  <SelectOption\n                    key={index}\n                    value={option}\n                  />\n                ))}\n              </Select>     \n            </ListItem>     \n            <ListItem>         \n              <ActionList>\n                <ActionListItem>\n                  <Button \n                    onClick={() => this.requestVC()} \n                    isDisabled={isDisabled}>\n                    Request VerifiableCredential\n                  </Button>\n                </ActionListItem>\n                <ActionListItem>\n                  <Button \n                    onClick={() => this.generateVCUrl()} \n                    isDisabled={isDisabled}>\n                    Generate VerifiableCredential-Request\n                  </Button>\n                </ActionListItem>\n              </ActionList>\n            </ListItem>           \n            \n              <ListItem>\n            <ActionList>  \n            { vcQRVisible &&\n                <ActionListItem>\n              <QRCodeSVG \n                value={credential}\n                bgColor={\"#ffffff\"}\n                fgColor={\"#000000\"}\n                level={\"L\"}\n                includeMargin={false}\n                size={512}/> \n                </ActionListItem>\n            }\n            { urlQRVisible &&\n                <ActionListItem>\n              <QRCodeSVG \n                value={vcUrl}\n                bgColor={\"#ffffff\"}\n                fgColor={\"#000000\"}\n                level={\"L\"}\n                includeMargin={false}\n                size={512}/> \n                </ActionListItem>\n            }   \n              </ActionList>\n            </ListItem>\n\n            <ListItem>         \n              { vcQRVisible &&\n              <Text component={TextVariants.h5}>\n              {credential}\n              </Text> \n              }\n              { urlQRVisible &&\n              <Text component={TextVariants.h5}>\n              {vcUrl}\n              </Text>           \n              }\n            </ListItem>      \n          </List>       \n        </PageSection>   \n      </ContentPage>\n      );\n    }\n};"],"mappings":"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"}